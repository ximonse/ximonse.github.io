{"version":3,"mappings":"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","names":["db","Dexie","async","initStorage","open","console","log","cards","count","welcomeCard","text","tags","created","Date","now","modified","position","x","y","add","createWelcomeCard","error","getAllCards","toArray","getCard","id","get","version","stores","changelog","cardCounter","lastTimestamp","createCard","cardData","metadata","card","uniqueId","timestamp","getTime","String","getFullYear","slice","getMonth","padStart","getDate","getHours","getMinutes","getSeconds","getMilliseconds","fromCharCode","generateCardId","createdAt","toISOString","logChange","updateCard","updates","updated","update","deleteCard","delete","operation","cardId","data","copyExifWithoutOrientation","e","t","Promise","r","i","o","getApp1Segment","then","Blob","type","FileReader","addEventListener","target","result","DataView","getUint16","a","s","getUint32","f","l","c","setUint16","readAsArrayBuffer","UZIP","exports","parse","bin","readUshort","readUint","Uint8Array","length","u","h","d","A","g","p","m","_readLocal","readUTF8","size","csize","buffer","inflateRaw","F","inflate","byteOffset","deflate","level","Math","floor","deflateRaw","adler","encode","writeUint","writeUshort","_noNeed","crc","cpr","usize","file","sizeUTF8","push","_writeHeader","split","pop","toLowerCase","indexOf","writeUTF8","set","table","Uint32Array","min","readASCII","writeASCII","charCodeAt","pad","toString","decodeURIComponent","U","_goodIndex","_hash","_putsE","_","_copyExact","lits","strt","prev","w","v","b","E","_writeBlock","_bestMatch","B","of0","lhst","C","df0","dhst","exb","dxb","_howLong","saved","_putsF","getTrees","contSize","fltree","fdtree","ltree","dtree","itree","ihst","I","makeCodes","revCodes","Q","ordr","_codeTiny","M","S","R","T","_writeLit","O","P","H","L","_hufTree","_lenCodes","getSecond","nonZero","lit","sort","setDepth","restrictDepth","max","_bitsF","_bitsE","_decodeTiny","codes2map","_get17","_check","flmap","fdmap","imap","lmap","dmap","ttree","_copyOut","ldef","ddef","bl_count","next_code","rev15","_get25","Uint16Array","pushV","__proto__","default","forEach","Array","isArray","Object","keys","getOwnPropertyDescriptor","defineProperty","enumerable","freeze","UPNG","nextZero","readBytes","decodeImage","_getBPP","ceil","ctype","depth","tabs","tRNS","PLTE","_decompress","interlace","CgBI","_inflate","_filterZero","width","height","N","n","Z","W","J","X","V","D","q","j","K","z","$","Y","k","_paeth","_IHDR","compress","filter","_copyTile","decode","frames","num_frames","num_plays","rect","delay","round","dispose","blend","toRGBA8","acTL","_bin","addErr","dither","Int16Array","_main","sRGB","pHYs","iCCP","pako","plte","cimg","loop","compressPNG","bpl","img","bpp","_prepareDiff","_updateFrame","quantize","byteLength","est","rgba","inds","abuf","_filterLine","getKDtree","getNearest","ind","left","planeDst","right","i0","i1","bst","tdst","stats","estats","splitPixels","eMq255","eMq","vecDot","random","multVec","sqrt","dot","sml","abs","Cov","encodeLL","toArrayBuffer","getContext","getImageData","ArrayBuffer","set16","set32","setUint32","seek","convert","setTimeout","_dly","toBlob","this","CHROME","FIREFOX","DESKTOP_SAFARI","IE","IOS","ETC","window","WorkerGlobalScope","self","cordova","require","CustomFile","getOriginalSymbol","File","CustomFileReader","getFilefromDataUrl","match","globalThis","atob","name","lastModified","getDataUrlFromFile","onload","onerror","readAsDataURL","loadImage","Image","src","getBrowserName","cachedResult","userAgent","navigator","test","document","documentMode","approximateBelowMaximumCanvasSizeOfBrowser","getNewCanvasAndCtx","OffscreenCanvas","Error","createElement","drawImageInCanvas","fillStyle","fillRect","drawImage","isIOS","includes","platform","drawFileInCanvas","$Try_2_Post","fileType","$Try_2_Catch","$Try_3_Catch","MOBILE_SAFARI","createImageBitmap","canvasToFile","$If_4","call","$If_5","bind","$If_6","convertToBlob","quality","toDataURL","cleanupCanvasMemory","isAutoOrientationInBrowser","getExifOrientation","handleMaxWidthOrHeight","maxWidthOrHeight","isFinite","followExifOrientation","transform","incProgress","signal","aborted","reason","onProgress","setProgress","maxIteration","maxSizeMB","exifOrientation","$If_2","initialQuality","$Loop_3","$Loop_3_exit","alwaysKeepResolution","imageCompression","Number","POSITIVE_INFINITY","useWebWorker","Worker","$Try_1_Catch","libURL","URL","createObjectURL","terminate","progress","postMessage","imageCompressionLibUrl","options","compressOnWebWorker","preserveExif","QUALITY_PRESETS","low","normal","high","extractExifData","dimensions","resolve","reject","url","revokeObjectURL","naturalWidth","naturalHeight","getImageDimensions","fileName","fileSize","processImage","compressed","toFixed","compressImage","base64","reader","fileToBase64","originalSize","compressedSize","compressionRatio","getGoogleAIAPIKey","apiKey","localStorage","getItem","overlay","style","cssText","dialog","innerHTML","appendChild","body","input","getElementById","focus","closeDialog","key","remove","onclick","value","trim","setItem","alert","click","readImageWithGemini","find","image","statusIndicator","textContent","response","imageData","payload","contents","parts","inline_data","mime_type","fetch","method","headers","JSON","stringify","ok","errorData","json","message","status","callGeminiAPI","candidates","content","rawText","parsedData","jsonMatch","jsonText","parseError","warn","hashtags","hashtagText","map","tag","startsWith","join","newBackText","description","existingTags","newTags","replace","backText","Set","geminiMetadata","reloadCanvas","arrangeVertical","centerPos","positions","totalHeight","index","currentY","arrangeHorizontal","totalWidth","currentX","arrangeCluster","angle","PI","cos","sin","arrangeGridVertical","cols","cardsPerCol","startY","cardIndex","col","row","standardWidth","arrangeGridHorizontal","rows","rowHeights","reduce","sum","rowIndex","rowWidth","arrangeGridTopAligned","stage","layer","isPanning","cardGroups","Map","selectionRectangle","selectionStartPos","isSelecting","undoStack","redoStack","MAX_UNDO_STACK","clipboard","getCardColor","cardColor","green","orange","pink","red","yellow","purple","blue","gray","grey","white","initCanvas","container","Konva","Stage","clientWidth","clientHeight","draggable","Layer","Rect","fill","stroke","strokeWidth","visible","loadCards","on","evt","preventDefault","oldScale","scaleX","pointer","getPointerPosition","mousePointTo","scaleBy","newScale","deltaY","clampedScale","scale","newPos","batchDraw","button","ctrlKey","cursor","pos","currentPos","setAttrs","selBox","getClientRect","isEink","classList","contains","isDark","group","background","findOne","removeName","getChildren","node","getAttr","groupBox","Util","haveIntersection","addName","updateSelection","parent","flipCard","openEditDialog","stageTouchHasMoved","createNewCard","stageTouchTimer","stageTouchStartPos","lastCenter","lastDist","isTouchPanning","getDistance","p1","p2","pow","getCenter","touch1","touches","touch2","clientX","clientY","menu","querySelectorAll","item","cleanup","parentNode","removeChild","read","pasteImageFromClipboard","importImage","once","showTouchPasteMenu","clearTimeout","newCenter","newDist","pointTo","dx","dy","gKeyHeld","tagName","undo","redo","copySelectedCards","shiftKey","pasteCards","exportCanvas","importCanvas","downloadBtn","dispatchEvent","CustomEvent","searchInput","select","showCommandPalette","pasteCardsWithArrangement","applyArrangement","togglePinSelectedCards","selectedNodes","handleDeleteCard","setupCanvasEvents","setupImageDragDrop","title","boxShadow","fitAllCards","createFitAllButton","createCommandPaletteButton","onPressStart","onPressEnd","existingMenu","icon","label","desc","action","menuItem","escHandler","removeEventListener","showAddMenu","isPressed","createAddButton","renderCard","Group","imageObj","isFlipped","flipped","substring","displayMaxWidth","displayMaxHeight","displayWidth","displayHeight","ratio","setAttr","cornerRadius","shadowColor","shadowBlur","shadowOpacity","shadowOffset","Text","fontSize","fontFamily","wrap","align","verticalAlign","scaleY","konvaImage","tooltip","updateTooltip","top","handler","off","renderImageCard","fillColor","renderTextCard","locked","isSelected","hasName","showContextMenu","touchTimer","touchStartPos","hasMoved","showTouchBulkMenu","createInlineEditor","dragStartPositions","startPos","delta","originalPos","newPosition","pushUndo","oldData","newData","currentText","isImageBack","currentTags","currentColor","textarea","tagsInput","saveBtn","cancelBtn","selectedColor","colorDots","dataset","color","border","save","newText","readWithAIBtn","createBulkEditor","cardIds","selectedCards","addTags","selectedIds","showQuickColorPicker","adder","mergedTags","showQuickTagAdder","picker","colorInfo","selectedGroups","newFlipped","destroy","clear","shift","__vitePreload","storage","__VITE_PRELOAD__","pastePosition","firstCard","offsetX","offsetY","cleanData","pastedData","copied","copiedAt","copiedFrom","originalCardId","arrangementFunc","arrangementName","newCardIds","newId","exportData","exportedAt","viewport","blob","href","download","accept","onchange","files","cardWithoutId","imported","importedAt","importedFrom","importBatchIndex","multiple","capture","from","showQualityDialog","processed","offset","clipboardItems","imageFound","clipboardItem","types","getType","source","commands","allCards","imageCardIds","palette","renderCommands","filteredCommands","commandList","querySelector","cmd","idx","originalIndex","originalIdx","parseInt","borderColor","commandsWithIndex","query","filtered","handleEsc","fileCount","btn","stopPropagation","dataTransfer","minX","Infinity","minY","maxX","maxY","box","contentWidth","contentHeight","paddedWidth","padding","paddedHeight","contentCenterX","contentCenterY","matchWithWildcard","term","searchableText","regexPattern","RegExp","checkProximity","proximityMatch","term1","distance","term2","words","positions1","positions2","word","pos1","pos2","evaluateBooleanQuery","parenMatch","innerResult","orParts","some","part","notIndex","beforeNot","afterNot","beforeMatches","afterMatches","every","endsWith","phrase","matches","searchCards","allGroups","opacity","lowerQuery","matchingCards","isMatch","has","isBulkOperation","isLocked","menuItems","confirm","renderMenuItems","newLockedState","updateLockIndicator","toggleLockCard","closeMenu","items","isBulk","contextMenu","existingLock","pinIcon","listening","anyPinned","newState","arrangeFn","arrangeName","newPositions","all","needsStandardWidth","to","duration","easing","Easings","EaseOut","currentWidth","currentHeight","clearClipboard","deselectAllCards","cardDataMap","state","currentView","deviceMode","ua","innerWidth","detectDeviceMode","theme","uiMode","init","savedTheme","applySavedTheme","viewToggle","toggleView","themeBtn","toggleTheme","uiModeToggle","toggleUIMode","importBtn","handleImport","handleDownloadBackup","func","wait","timeout","args","later","debounce","handleSearch","blur","applyUIMode","floatingHeader","infoOverlay","infoClose","setupEventListeners","renderColumnView","boardView","columnView","toggleBtn","searchQuery","cardList","canvas","combinedText","sortedCards","timeA","cardElement","className","imageSrc","display","errorText","insertBefore","firstChild","isImageCard","editorContainer","imageHTML","deleteBtn","colorPicker","saveEdit","tagString","cancelEdit","deleteCard2","keyHandler","showColumnInlineEdit","touchStartY","showColumnEditDialog","currentTheme","themes","currentIndex","nextTheme","setAttribute","themeTitles","light","dark","eink","updateCardShadows","updateCardFills","updateCardStrokes","modes","nextIndex","toolbar","toolbarActions","commandPaletteBtn","addBtn","fitAllBtn","uiToggleBtn","zIndex","children","child","JSZip","__vite_default__","import","zip","jsonData","exportDate","imagesFolder","folder","imageCount","base64Data","filename","generateAsync","date","event","readyState"],"ignoreList":[1],"sources":["../../src/lib/storage.js","../../node_modules/browser-image-compression/dist/browser-image-compression.mjs","../../src/utils/image-processing.js","../../src/lib/gemini.js","../../src/lib/arrangement.js","../../src/lib/canvas.js","../../src/main.js"],"sourcesContent":["/**\n * Storage module using IndexedDB (Dexie.js)\n */\n\nimport Dexie from 'dexie';\n\n// Initialize database\nconst db = new Dexie('SpatialViewDB');\n\n// Define schema\ndb.version(1).stores({\n  cards: '++id, created, modified, *tags',\n  changelog: '++id, timestamp, cardId'\n});\n\n/**\n * Initialize storage\n */\nexport async function initStorage() {\n  try {\n    await db.open();\n    console.log('IndexedDB initialized');\n    \n    // Check if this is first run\n    const count = await db.cards.count();\n    if (count === 0) {\n      console.log('First run - database is empty');\n      await createWelcomeCard();\n    }\n    \n    return db;\n  } catch (error) {\n    console.error('Failed to initialize storage:', error);\n    throw error;\n  }\n}\n\n/**\n * Create welcome card on first run\n */\nasync function createWelcomeCard() {\n  const welcomeCard = {\n    text: 'Vlkommen till Spatial View!\\n\\nDetta r din visuella second brain fr handskrivna anteckningar.',\n    tags: ['vlkommen'],\n    created: Date.now(),\n    modified: Date.now(),\n    position: { x: 100, y: 100 }\n  };\n  \n  await db.cards.add(welcomeCard);\n  console.log('Welcome card created');\n}\n\n/**\n * Get all cards\n */\nexport async function getAllCards() {\n  return await db.cards.toArray();\n}\n\n/**\n * Get card by ID\n */\nexport async function getCard(id) {\n  return await db.cards.get(id);\n}\n\n// Counter for cards created in the same millisecond\nlet cardCounter = 0;\nlet lastTimestamp = 0;\n\n/**\n * Generate unique card ID in format: yymmdd_hh_mm_ss_ms_a\n */\nfunction generateCardId() {\n  const now = new Date();\n  const timestamp = now.getTime();\n\n  // Reset counter if we're in a new millisecond\n  if (timestamp !== lastTimestamp) {\n    cardCounter = 0;\n    lastTimestamp = timestamp;\n  } else {\n    cardCounter++;\n  }\n\n  // Format: yymmdd_hh_mm_ss_ms_a\n  const yy = String(now.getFullYear()).slice(-2);\n  const mm = String(now.getMonth() + 1).padStart(2, '0');\n  const dd = String(now.getDate()).padStart(2, '0');\n  const hh = String(now.getHours()).padStart(2, '0');\n  const min = String(now.getMinutes()).padStart(2, '0');\n  const ss = String(now.getSeconds()).padStart(2, '0');\n  const ms = String(now.getMilliseconds()).padStart(3, '0');\n\n  // Letter suffix: a, b, c, etc.\n  const suffix = String.fromCharCode(97 + cardCounter); // 97 = 'a'\n\n  return `${yy}${mm}${dd}_${hh}_${min}_${ss}_${ms}_${suffix}`;\n}\n\n/**\n * Create new card\n */\nexport async function createCard(cardData, metadata = {}) {\n  const uniqueId = generateCardId();\n\n  const card = {\n    ...cardData,\n    uniqueId,\n    created: Date.now(),\n    modified: Date.now(),\n    metadata: {\n      ...metadata,\n      createdAt: new Date().toISOString()\n    }\n  };\n\n  const id = await db.cards.add(card);\n\n  // Log to changelog\n  await logChange('create', id, card);\n\n  return id;\n}\n\n/**\n * Update existing card\n */\nexport async function updateCard(id, updates) {\n  const updated = {\n    ...updates,\n    modified: Date.now()\n  };\n  \n  await db.cards.update(id, updated);\n  \n  // Log to changelog\n  await logChange('update', id, updated);\n}\n\n/**\n * Delete card\n */\nexport async function deleteCard(id) {\n  await db.cards.delete(id);\n  \n  // Log to changelog\n  await logChange('delete', id, null);\n}\n\n/**\n * Search cards\n */\nexport async function searchCards(query) {\n  const allCards = await db.cards.toArray();\n  \n  return allCards.filter(card => {\n    const tagsStr = card.tags ? card.tags.join(' ') : '';\n    const searchText = (card.text + ' ' + tagsStr).toLowerCase();\n    return searchText.includes(query.toLowerCase());\n  });\n}\n\n/**\n * Log change to changelog for delta sync\n */\nasync function logChange(operation, cardId, data) {\n  await db.changelog.add({\n    timestamp: Date.now(),\n    cardId,\n    operation,\n    data\n  });\n}\n\n/**\n * Export all cards (full backup)\n */\nexport async function exportFull() {\n  const cards = await db.cards.toArray();\n  \n  return {\n    type: 'full',\n    version: '1.0',\n    exportedAt: Date.now(),\n    cards\n  };\n}\n\n/**\n * Export delta (changes since timestamp)\n */\nexport async function exportDelta(sinceTimestamp = 0) {\n  const changes = await db.changelog\n    .where('timestamp')\n    .above(sinceTimestamp)\n    .toArray();\n  \n  return {\n    type: 'delta',\n    version: '1.0',\n    sinceTimestamp,\n    exportedAt: Date.now(),\n    changes\n  };\n}\n\n/**\n * Import cards from JSON\n */\nexport async function importData(jsonData) {\n  if (jsonData.type === 'full') {\n    // Full import - add all cards\n    await db.cards.bulkAdd(jsonData.cards);\n  } else if (jsonData.type === 'delta') {\n    // Delta import - merge changes\n    for (const change of jsonData.changes) {\n      if (change.operation === 'create') {\n        await db.cards.add(change.data);\n      } else if (change.operation === 'update') {\n        await db.cards.put(change.data);\n      } else if (change.operation === 'delete') {\n        await db.cards.delete(change.cardId);\n      }\n    }\n  }\n}\n\n// Export db for advanced usage\nexport { db };\n","/**\n * Browser Image Compression\n * v2.0.2\n * by Donald <donaldcwl@gmail.com>\n * https://github.com/Donaldcwl/browser-image-compression\n */\n\nfunction _mergeNamespaces(e,t){return t.forEach((function(t){t&&\"string\"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if(\"default\"!==r&&!(r in e)){var i=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}function copyExifWithoutOrientation(e,t){return new Promise((function(r,i){let o;return getApp1Segment(e).then((function(e){try{return o=e,r(new Blob([t.slice(0,2),o,t.slice(2)],{type:\"image/jpeg\"}))}catch(e){return i(e)}}),i)}))}const getApp1Segment=e=>new Promise(((t,r)=>{const i=new FileReader;i.addEventListener(\"load\",(({target:{result:e}})=>{const i=new DataView(e);let o=0;if(65496!==i.getUint16(o))return r(\"not a valid JPEG\");for(o+=2;;){const a=i.getUint16(o);if(65498===a)break;const s=i.getUint16(o+2);if(65505===a&&1165519206===i.getUint32(o+4)){const a=o+10;let f;switch(i.getUint16(a)){case 18761:f=!0;break;case 19789:f=!1;break;default:return r(\"TIFF header contains invalid endian\")}if(42!==i.getUint16(a+2,f))return r(\"TIFF header contains invalid version\");const l=i.getUint32(a+4,f),c=a+l+2+12*i.getUint16(a+l,f);for(let e=a+l+2;e<c;e+=12){if(274==i.getUint16(e,f)){if(3!==i.getUint16(e+2,f))return r(\"Orientation data type is invalid\");if(1!==i.getUint32(e+4,f))return r(\"Orientation data count is invalid\");i.setUint16(e+8,1,f);break}}return t(e.slice(o,o+2+s))}o+=2+s}return t(new Blob)})),i.readAsArrayBuffer(e)}));var e={},t={get exports(){return e},set exports(t){e=t}};!function(e){var r,i,UZIP={};t.exports=UZIP,UZIP.parse=function(e,t){for(var r=UZIP.bin.readUshort,i=UZIP.bin.readUint,o=0,a={},s=new Uint8Array(e),f=s.length-4;101010256!=i(s,f);)f--;o=f;o+=4;var l=r(s,o+=4);r(s,o+=2);var c=i(s,o+=2),u=i(s,o+=4);o+=4,o=u;for(var h=0;h<l;h++){i(s,o),o+=4,o+=4,o+=4,i(s,o+=4);c=i(s,o+=4);var d=i(s,o+=4),A=r(s,o+=4),g=r(s,o+2),p=r(s,o+4);o+=6;var m=i(s,o+=8);o+=4,o+=A+g+p,UZIP._readLocal(s,m,a,c,d,t)}return a},UZIP._readLocal=function(e,t,r,i,o,a){var s=UZIP.bin.readUshort,f=UZIP.bin.readUint;f(e,t),s(e,t+=4),s(e,t+=2);var l=s(e,t+=2);f(e,t+=2),f(e,t+=4),t+=4;var c=s(e,t+=8),u=s(e,t+=2);t+=2;var h=UZIP.bin.readUTF8(e,t,c);if(t+=c,t+=u,a)r[h]={size:o,csize:i};else{var d=new Uint8Array(e.buffer,t);if(0==l)r[h]=new Uint8Array(d.buffer.slice(t,t+i));else{if(8!=l)throw\"unknown compression method: \"+l;var A=new Uint8Array(o);UZIP.inflateRaw(d,A),r[h]=A}}},UZIP.inflateRaw=function(e,t){return UZIP.F.inflate(e,t)},UZIP.inflate=function(e,t){return e[0],e[1],UZIP.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},UZIP.deflate=function(e,t){null==t&&(t={level:6});var r=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[r]=120,i[r+1]=156,r+=2,r=UZIP.F.deflateRaw(e,i,r,t.level);var o=UZIP.adler(e,0,e.length);return i[r+0]=o>>>24&255,i[r+1]=o>>>16&255,i[r+2]=o>>>8&255,i[r+3]=o>>>0&255,new Uint8Array(i.buffer,0,r+4)},UZIP.deflateRaw=function(e,t){null==t&&(t={level:6});var r=new Uint8Array(50+Math.floor(1.1*e.length)),i=UZIP.F.deflateRaw(e,r,i,t.level);return new Uint8Array(r.buffer,0,i)},UZIP.encode=function(e,t){null==t&&(t=!1);var r=0,i=UZIP.bin.writeUint,o=UZIP.bin.writeUshort,a={};for(var s in e){var f=!UZIP._noNeed(s)&&!t,l=e[s],c=UZIP.crc.crc(l,0,l.length);a[s]={cpr:f,usize:l.length,crc:c,file:f?UZIP.deflateRaw(l):l}}for(var s in a)r+=a[s].file.length+30+46+2*UZIP.bin.sizeUTF8(s);r+=22;var u=new Uint8Array(r),h=0,d=[];for(var s in a){var A=a[s];d.push(h),h=UZIP._writeHeader(u,h,s,A,0)}var g=0,p=h;for(var s in a){A=a[s];d.push(h),h=UZIP._writeHeader(u,h,s,A,1,d[g++])}var m=h-p;return i(u,h,101010256),h+=4,o(u,h+=4,g),o(u,h+=2,g),i(u,h+=2,m),i(u,h+=4,p),h+=4,h+=2,u.buffer},UZIP._noNeed=function(e){var t=e.split(\".\").pop().toLowerCase();return-1!=\"png,jpg,jpeg,zip\".indexOf(t)},UZIP._writeHeader=function(e,t,r,i,o,a){var s=UZIP.bin.writeUint,f=UZIP.bin.writeUshort,l=i.file;return s(e,t,0==o?67324752:33639248),t+=4,1==o&&(t+=2),f(e,t,20),f(e,t+=2,0),f(e,t+=2,i.cpr?8:0),s(e,t+=2,0),s(e,t+=4,i.crc),s(e,t+=4,l.length),s(e,t+=4,i.usize),f(e,t+=4,UZIP.bin.sizeUTF8(r)),f(e,t+=2,0),t+=2,1==o&&(t+=2,t+=2,s(e,t+=6,a),t+=4),t+=UZIP.bin.writeUTF8(e,t,r),0==o&&(e.set(l,t),t+=l.length),t},UZIP.crc={table:function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var r=t,i=0;i<8;i++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update:function(e,t,r,i){for(var o=0;o<i;o++)e=UZIP.crc.table[255&(e^t[r+o])]^e>>>8;return e},crc:function(e,t,r){return 4294967295^UZIP.crc.update(4294967295,e,t,r)}},UZIP.adler=function(e,t,r){for(var i=1,o=0,a=t,s=t+r;a<s;){for(var f=Math.min(a+5552,s);a<f;)o+=i+=e[a++];i%=65521,o%=65521}return o<<16|i},UZIP.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,r){e[t]=255&r,e[t+1]=r>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,r){e[t]=255&r,e[t+1]=r>>8&255,e[t+2]=r>>16&255,e[t+3]=r>>24&255},readASCII:function(e,t,r){for(var i=\"\",o=0;o<r;o++)i+=String.fromCharCode(e[t+o]);return i},writeASCII:function(e,t,r){for(var i=0;i<r.length;i++)e[t+i]=r.charCodeAt(i)},pad:function(e){return e.length<2?\"0\"+e:e},readUTF8:function(e,t,r){for(var i,o=\"\",a=0;a<r;a++)o+=\"%\"+UZIP.bin.pad(e[t+a].toString(16));try{i=decodeURIComponent(o)}catch(i){return UZIP.bin.readASCII(e,t,r)}return i},writeUTF8:function(e,t,r){for(var i=r.length,o=0,a=0;a<i;a++){var s=r.charCodeAt(a);if(0==(4294967168&s))e[t+o]=s,o++;else if(0==(4294965248&s))e[t+o]=192|s>>6,e[t+o+1]=128|s>>0&63,o+=2;else if(0==(4294901760&s))e[t+o]=224|s>>12,e[t+o+1]=128|s>>6&63,e[t+o+2]=128|s>>0&63,o+=3;else{if(0!=(4292870144&s))throw\"e\";e[t+o]=240|s>>18,e[t+o+1]=128|s>>12&63,e[t+o+2]=128|s>>6&63,e[t+o+3]=128|s>>0&63,o+=4}}return o},sizeUTF8:function(e){for(var t=e.length,r=0,i=0;i<t;i++){var o=e.charCodeAt(i);if(0==(4294967168&o))r++;else if(0==(4294965248&o))r+=2;else if(0==(4294901760&o))r+=3;else{if(0!=(4292870144&o))throw\"e\";r+=4}}return r}},UZIP.F={},UZIP.F.deflateRaw=function(e,t,r,i){var o=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],a=UZIP.F.U,s=UZIP.F._goodIndex;UZIP.F._hash;var f=UZIP.F._putsE,l=0,c=r<<3,u=0,h=e.length;if(0==i){for(;l<h;){f(t,c,l+(_=Math.min(65535,h-l))==h?1:0),c=UZIP.F._copyExact(e,l,_,t,c+8),l+=_}return c>>>3}var d=a.lits,A=a.strt,g=a.prev,p=0,m=0,w=0,v=0,b=0,y=0;for(h>2&&(A[y=UZIP.F._hash(e,0)]=0),l=0;l<h;l++){if(b=y,l+1<h-2){y=UZIP.F._hash(e,l+1);var E=l+1&32767;g[E]=A[y],A[y]=E}if(u<=l){(p>14e3||m>26697)&&h-l>100&&(u<l&&(d[p]=l-u,p+=2,u=l),c=UZIP.F._writeBlock(l==h-1||u==h?1:0,d,p,v,e,w,l-w,t,c),p=m=v=0,w=l);var F=0;l<h-2&&(F=UZIP.F._bestMatch(e,l,g,b,Math.min(o[2],h-l),o[3]));var _=F>>>16,B=65535&F;if(0!=F){B=65535&F;var U=s(_=F>>>16,a.of0);a.lhst[257+U]++;var C=s(B,a.df0);a.dhst[C]++,v+=a.exb[U]+a.dxb[C],d[p]=_<<23|l-u,d[p+1]=B<<16|U<<8|C,p+=2,u=l+_}else a.lhst[e[l]]++;m++}}for(w==l&&0!=e.length||(u<l&&(d[p]=l-u,p+=2,u=l),c=UZIP.F._writeBlock(1,d,p,v,e,w,l-w,t,c),p=0,m=0,p=m=v=0,w=l);0!=(7&c);)c++;return c>>>3},UZIP.F._bestMatch=function(e,t,r,i,o,a){var s=32767&t,f=r[s],l=s-f+32768&32767;if(f==s||i!=UZIP.F._hash(e,t-l))return 0;for(var c=0,u=0,h=Math.min(32767,t);l<=h&&0!=--a&&f!=s;){if(0==c||e[t+c]==e[t+c-l]){var d=UZIP.F._howLong(e,t,l);if(d>c){if(u=l,(c=d)>=o)break;l+2<d&&(d=l+2);for(var A=0,g=0;g<d-2;g++){var p=t-l+g+32768&32767,m=p-r[p]+32768&32767;m>A&&(A=m,f=p)}}}l+=(s=f)-(f=r[s])+32768&32767}return c<<16|u},UZIP.F._howLong=function(e,t,r){if(e[t]!=e[t-r]||e[t+1]!=e[t+1-r]||e[t+2]!=e[t+2-r])return 0;var i=t,o=Math.min(e.length,t+258);for(t+=3;t<o&&e[t]==e[t-r];)t++;return t-i},UZIP.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},UZIP.saved=0,UZIP.F._writeBlock=function(e,t,r,i,o,a,s,f,l){var c,u,h,d,A,g,p,m,w,v=UZIP.F.U,b=UZIP.F._putsF,y=UZIP.F._putsE;v.lhst[256]++,u=(c=UZIP.F.getTrees())[0],h=c[1],d=c[2],A=c[3],g=c[4],p=c[5],m=c[6],w=c[7];var E=32+(0==(l+3&7)?0:8-(l+3&7))+(s<<3),F=i+UZIP.F.contSize(v.fltree,v.lhst)+UZIP.F.contSize(v.fdtree,v.dhst),_=i+UZIP.F.contSize(v.ltree,v.lhst)+UZIP.F.contSize(v.dtree,v.dhst);_+=14+3*p+UZIP.F.contSize(v.itree,v.ihst)+(2*v.ihst[16]+3*v.ihst[17]+7*v.ihst[18]);for(var B=0;B<286;B++)v.lhst[B]=0;for(B=0;B<30;B++)v.dhst[B]=0;for(B=0;B<19;B++)v.ihst[B]=0;var U=E<F&&E<_?0:F<_?1:2;if(b(f,l,e),b(f,l+1,U),l+=3,0==U){for(;0!=(7&l);)l++;l=UZIP.F._copyExact(o,a,s,f,l)}else{var C,I;if(1==U&&(C=v.fltree,I=v.fdtree),2==U){UZIP.F.makeCodes(v.ltree,u),UZIP.F.revCodes(v.ltree,u),UZIP.F.makeCodes(v.dtree,h),UZIP.F.revCodes(v.dtree,h),UZIP.F.makeCodes(v.itree,d),UZIP.F.revCodes(v.itree,d),C=v.ltree,I=v.dtree,y(f,l,A-257),y(f,l+=5,g-1),y(f,l+=5,p-4),l+=4;for(var Q=0;Q<p;Q++)y(f,l+3*Q,v.itree[1+(v.ordr[Q]<<1)]);l+=3*p,l=UZIP.F._codeTiny(m,v.itree,f,l),l=UZIP.F._codeTiny(w,v.itree,f,l)}for(var M=a,x=0;x<r;x+=2){for(var S=t[x],R=S>>>23,T=M+(8388607&S);M<T;)l=UZIP.F._writeLit(o[M++],C,f,l);if(0!=R){var O=t[x+1],P=O>>16,H=O>>8&255,L=255&O;y(f,l=UZIP.F._writeLit(257+H,C,f,l),R-v.of0[H]),l+=v.exb[H],b(f,l=UZIP.F._writeLit(L,I,f,l),P-v.df0[L]),l+=v.dxb[L],M+=R}}l=UZIP.F._writeLit(256,C,f,l)}return l},UZIP.F._copyExact=function(e,t,r,i,o){var a=o>>>3;return i[a]=r,i[a+1]=r>>>8,i[a+2]=255-i[a],i[a+3]=255-i[a+1],a+=4,i.set(new Uint8Array(e.buffer,t,r),a),o+(r+4<<3)},UZIP.F.getTrees=function(){for(var e=UZIP.F.U,t=UZIP.F._hufTree(e.lhst,e.ltree,15),r=UZIP.F._hufTree(e.dhst,e.dtree,15),i=[],o=UZIP.F._lenCodes(e.ltree,i),a=[],s=UZIP.F._lenCodes(e.dtree,a),f=0;f<i.length;f+=2)e.ihst[i[f]]++;for(f=0;f<a.length;f+=2)e.ihst[a[f]]++;for(var l=UZIP.F._hufTree(e.ihst,e.itree,7),c=19;c>4&&0==e.itree[1+(e.ordr[c-1]<<1)];)c--;return[t,r,l,o,s,c,i,a]},UZIP.F.getSecond=function(e){for(var t=[],r=0;r<e.length;r+=2)t.push(e[r+1]);return t},UZIP.F.nonZero=function(e){for(var t=\"\",r=0;r<e.length;r+=2)0!=e[r+1]&&(t+=(r>>1)+\",\");return t},UZIP.F.contSize=function(e,t){for(var r=0,i=0;i<t.length;i++)r+=t[i]*e[1+(i<<1)];return r},UZIP.F._codeTiny=function(e,t,r,i){for(var o=0;o<e.length;o+=2){var a=e[o],s=e[o+1];i=UZIP.F._writeLit(a,t,r,i);var f=16==a?2:17==a?3:7;a>15&&(UZIP.F._putsE(r,i,s,f),i+=f)}return i},UZIP.F._lenCodes=function(e,t){for(var r=e.length;2!=r&&0==e[r-1];)r-=2;for(var i=0;i<r;i+=2){var o=e[i+1],a=i+3<r?e[i+3]:-1,s=i+5<r?e[i+5]:-1,f=0==i?-1:e[i-1];if(0==o&&a==o&&s==o){for(var l=i+5;l+2<r&&e[l+2]==o;)l+=2;(c=Math.min(l+1-i>>>1,138))<11?t.push(17,c-3):t.push(18,c-11),i+=2*c-2}else if(o==f&&a==o&&s==o){for(l=i+5;l+2<r&&e[l+2]==o;)l+=2;var c=Math.min(l+1-i>>>1,6);t.push(16,c-3),i+=2*c-2}else t.push(o,0)}return r>>>1},UZIP.F._hufTree=function(e,t,r){var i=[],o=e.length,a=t.length,s=0;for(s=0;s<a;s+=2)t[s]=0,t[s+1]=0;for(s=0;s<o;s++)0!=e[s]&&i.push({lit:s,f:e[s]});var f=i.length,l=i.slice(0);if(0==f)return 0;if(1==f){var c=i[0].lit;l=0==c?1:0;return t[1+(c<<1)]=1,t[1+(l<<1)]=1,1}i.sort((function(e,t){return e.f-t.f}));var u=i[0],h=i[1],d=0,A=1,g=2;for(i[0]={lit:-1,f:u.f+h.f,l:u,r:h,d:0};A!=f-1;)u=d!=A&&(g==f||i[d].f<i[g].f)?i[d++]:i[g++],h=d!=A&&(g==f||i[d].f<i[g].f)?i[d++]:i[g++],i[A++]={lit:-1,f:u.f+h.f,l:u,r:h};var p=UZIP.F.setDepth(i[A-1],0);for(p>r&&(UZIP.F.restrictDepth(l,r,p),p=r),s=0;s<f;s++)t[1+(l[s].lit<<1)]=l[s].d;return p},UZIP.F.setDepth=function(e,t){return-1!=e.lit?(e.d=t,t):Math.max(UZIP.F.setDepth(e.l,t+1),UZIP.F.setDepth(e.r,t+1))},UZIP.F.restrictDepth=function(e,t,r){var i=0,o=1<<r-t,a=0;for(e.sort((function(e,t){return t.d==e.d?e.f-t.f:t.d-e.d})),i=0;i<e.length&&e[i].d>t;i++){var s=e[i].d;e[i].d=t,a+=o-(1<<r-s)}for(a>>>=r-t;a>0;){(s=e[i].d)<t?(e[i].d++,a-=1<<t-s-1):i++}for(;i>=0;i--)e[i].d==t&&a<0&&(e[i].d--,a++);0!=a&&console.log(\"debt left\")},UZIP.F._goodIndex=function(e,t){var r=0;return t[16|r]<=e&&(r|=16),t[8|r]<=e&&(r|=8),t[4|r]<=e&&(r|=4),t[2|r]<=e&&(r|=2),t[1|r]<=e&&(r|=1),r},UZIP.F._writeLit=function(e,t,r,i){return UZIP.F._putsF(r,i,t[e<<1]),i+t[1+(e<<1)]},UZIP.F.inflate=function(e,t){var r=Uint8Array;if(3==e[0]&&0==e[1])return t||new r(0);var i=UZIP.F,o=i._bitsF,a=i._bitsE,s=i._decodeTiny,f=i.makeCodes,l=i.codes2map,c=i._get17,u=i.U,h=null==t;h&&(t=new r(e.length>>>2<<3));for(var d,A,g=0,p=0,m=0,w=0,v=0,b=0,y=0,E=0,F=0;0==g;)if(g=o(e,F,1),p=o(e,F+1,2),F+=3,0!=p){if(h&&(t=UZIP.F._check(t,E+(1<<17))),1==p&&(d=u.flmap,A=u.fdmap,b=511,y=31),2==p){m=a(e,F,5)+257,w=a(e,F+5,5)+1,v=a(e,F+10,4)+4,F+=14;for(var _=0;_<38;_+=2)u.itree[_]=0,u.itree[_+1]=0;var B=1;for(_=0;_<v;_++){var U=a(e,F+3*_,3);u.itree[1+(u.ordr[_]<<1)]=U,U>B&&(B=U)}F+=3*v,f(u.itree,B),l(u.itree,B,u.imap),d=u.lmap,A=u.dmap,F=s(u.imap,(1<<B)-1,m+w,e,F,u.ttree);var C=i._copyOut(u.ttree,0,m,u.ltree);b=(1<<C)-1;var I=i._copyOut(u.ttree,m,w,u.dtree);y=(1<<I)-1,f(u.ltree,C),l(u.ltree,C,d),f(u.dtree,I),l(u.dtree,I,A)}for(;;){var Q=d[c(e,F)&b];F+=15&Q;var M=Q>>>4;if(M>>>8==0)t[E++]=M;else{if(256==M)break;var x=E+M-254;if(M>264){var S=u.ldef[M-257];x=E+(S>>>3)+a(e,F,7&S),F+=7&S}var R=A[c(e,F)&y];F+=15&R;var T=R>>>4,O=u.ddef[T],P=(O>>>4)+o(e,F,15&O);for(F+=15&O,h&&(t=UZIP.F._check(t,E+(1<<17)));E<x;)t[E]=t[E++-P],t[E]=t[E++-P],t[E]=t[E++-P],t[E]=t[E++-P];E=x}}}else{0!=(7&F)&&(F+=8-(7&F));var H=4+(F>>>3),L=e[H-4]|e[H-3]<<8;h&&(t=UZIP.F._check(t,E+L)),t.set(new r(e.buffer,e.byteOffset+H,L),E),F=H+L<<3,E+=L}return t.length==E?t:t.slice(0,E)},UZIP.F._check=function(e,t){var r=e.length;if(t<=r)return e;var i=new Uint8Array(Math.max(r<<1,t));return i.set(e,0),i},UZIP.F._decodeTiny=function(e,t,r,i,o,a){for(var s=UZIP.F._bitsE,f=UZIP.F._get17,l=0;l<r;){var c=e[f(i,o)&t];o+=15&c;var u=c>>>4;if(u<=15)a[l]=u,l++;else{var h=0,d=0;16==u?(d=3+s(i,o,2),o+=2,h=a[l-1]):17==u?(d=3+s(i,o,3),o+=3):18==u&&(d=11+s(i,o,7),o+=7);for(var A=l+d;l<A;)a[l]=h,l++}}return o},UZIP.F._copyOut=function(e,t,r,i){for(var o=0,a=0,s=i.length>>>1;a<r;){var f=e[a+t];i[a<<1]=0,i[1+(a<<1)]=f,f>o&&(o=f),a++}for(;a<s;)i[a<<1]=0,i[1+(a<<1)]=0,a++;return o},UZIP.F.makeCodes=function(e,t){for(var r,i,o,a,s=UZIP.F.U,f=e.length,l=s.bl_count,c=0;c<=t;c++)l[c]=0;for(c=1;c<f;c+=2)l[e[c]]++;var u=s.next_code;for(r=0,l[0]=0,i=1;i<=t;i++)r=r+l[i-1]<<1,u[i]=r;for(o=0;o<f;o+=2)0!=(a=e[o+1])&&(e[o]=u[a],u[a]++)},UZIP.F.codes2map=function(e,t,r){for(var i=e.length,o=UZIP.F.U.rev15,a=0;a<i;a+=2)if(0!=e[a+1])for(var s=a>>1,f=e[a+1],l=s<<4|f,c=t-f,u=e[a]<<c,h=u+(1<<c);u!=h;){r[o[u]>>>15-t]=l,u++}},UZIP.F.revCodes=function(e,t){for(var r=UZIP.F.U.rev15,i=15-t,o=0;o<e.length;o+=2){var a=e[o]<<t-e[o+1];e[o]=r[a]>>>i}},UZIP.F._putsE=function(e,t,r){r<<=7&t;var i=t>>>3;e[i]|=r,e[i+1]|=r>>>8},UZIP.F._putsF=function(e,t,r){r<<=7&t;var i=t>>>3;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},UZIP.F._bitsE=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},UZIP.F._bitsF=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},UZIP.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},UZIP.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},UZIP.F.U=(r=Uint16Array,i=Uint32Array,{next_code:new r(16),bl_count:new r(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new r(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new i(32),flmap:new r(512),fltree:[],fdmap:new r(32),fdtree:[],lmap:new r(32768),ltree:[],ttree:[],dmap:new r(32768),dtree:[],imap:new r(512),itree:[],rev15:new r(32768),lhst:new i(286),dhst:new i(30),ihst:new i(19),lits:new i(15e3),strt:new r(65536),prev:new r(32768)}),function(){for(var e=UZIP.F.U,t=0;t<32768;t++){var r=t;r=(4278255360&(r=(4042322160&(r=(3435973836&(r=(2863311530&r)>>>1|(1431655765&r)<<1))>>>2|(858993459&r)<<2))>>>4|(252645135&r)<<4))>>>8|(16711935&r)<<8,e.rev15[t]=(r>>>16|r<<16)>>>17}function pushV(e,t,r){for(;0!=t--;)e.push(0,r)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];pushV(e.fltree,144,8),pushV(e.fltree,112,9),pushV(e.fltree,24,7),pushV(e.fltree,8,8),UZIP.F.makeCodes(e.fltree,9),UZIP.F.codes2map(e.fltree,9,e.flmap),UZIP.F.revCodes(e.fltree,9),pushV(e.fdtree,32,5),UZIP.F.makeCodes(e.fdtree,5),UZIP.F.codes2map(e.fdtree,5,e.fdmap),UZIP.F.revCodes(e.fdtree,5),pushV(e.itree,19,0),pushV(e.ltree,286,0),pushV(e.dtree,30,0),pushV(e.ttree,320,0)}()}();var UZIP=_mergeNamespaces({__proto__:null,default:e},[e]);const UPNG=function(){var e={nextZero(e,t){for(;0!=e[t];)t++;return t},readUshort:(e,t)=>e[t]<<8|e[t+1],writeUshort(e,t,r){e[t]=r>>8&255,e[t+1]=255&r},readUint:(e,t)=>16777216*e[t]+(e[t+1]<<16|e[t+2]<<8|e[t+3]),writeUint(e,t,r){e[t]=r>>24&255,e[t+1]=r>>16&255,e[t+2]=r>>8&255,e[t+3]=255&r},readASCII(e,t,r){let i=\"\";for(let o=0;o<r;o++)i+=String.fromCharCode(e[t+o]);return i},writeASCII(e,t,r){for(let i=0;i<r.length;i++)e[t+i]=r.charCodeAt(i)},readBytes(e,t,r){const i=[];for(let o=0;o<r;o++)i.push(e[t+o]);return i},pad:e=>e.length<2?`0${e}`:e,readUTF8(t,r,i){let o,a=\"\";for(let o=0;o<i;o++)a+=`%${e.pad(t[r+o].toString(16))}`;try{o=decodeURIComponent(a)}catch(o){return e.readASCII(t,r,i)}return o}};function decodeImage(t,r,i,o){const a=r*i,s=_getBPP(o),f=Math.ceil(r*s/8),l=new Uint8Array(4*a),c=new Uint32Array(l.buffer),{ctype:u}=o,{depth:h}=o,d=e.readUshort;if(6==u){const e=a<<2;if(8==h)for(var A=0;A<e;A+=4)l[A]=t[A],l[A+1]=t[A+1],l[A+2]=t[A+2],l[A+3]=t[A+3];if(16==h)for(A=0;A<e;A++)l[A]=t[A<<1]}else if(2==u){const e=o.tabs.tRNS;if(null==e){if(8==h)for(A=0;A<a;A++){var g=3*A;c[A]=255<<24|t[g+2]<<16|t[g+1]<<8|t[g]}if(16==h)for(A=0;A<a;A++){g=6*A;c[A]=255<<24|t[g+4]<<16|t[g+2]<<8|t[g]}}else{var p=e[0];const r=e[1],i=e[2];if(8==h)for(A=0;A<a;A++){var m=A<<2;g=3*A;c[A]=255<<24|t[g+2]<<16|t[g+1]<<8|t[g],t[g]==p&&t[g+1]==r&&t[g+2]==i&&(l[m+3]=0)}if(16==h)for(A=0;A<a;A++){m=A<<2,g=6*A;c[A]=255<<24|t[g+4]<<16|t[g+2]<<8|t[g],d(t,g)==p&&d(t,g+2)==r&&d(t,g+4)==i&&(l[m+3]=0)}}}else if(3==u){const e=o.tabs.PLTE,s=o.tabs.tRNS,c=s?s.length:0;if(1==h)for(var w=0;w<i;w++){var v=w*f,b=w*r;for(A=0;A<r;A++){m=b+A<<2;var y=3*(E=t[v+(A>>3)]>>7-((7&A)<<0)&1);l[m]=e[y],l[m+1]=e[y+1],l[m+2]=e[y+2],l[m+3]=E<c?s[E]:255}}if(2==h)for(w=0;w<i;w++)for(v=w*f,b=w*r,A=0;A<r;A++){m=b+A<<2,y=3*(E=t[v+(A>>2)]>>6-((3&A)<<1)&3);l[m]=e[y],l[m+1]=e[y+1],l[m+2]=e[y+2],l[m+3]=E<c?s[E]:255}if(4==h)for(w=0;w<i;w++)for(v=w*f,b=w*r,A=0;A<r;A++){m=b+A<<2,y=3*(E=t[v+(A>>1)]>>4-((1&A)<<2)&15);l[m]=e[y],l[m+1]=e[y+1],l[m+2]=e[y+2],l[m+3]=E<c?s[E]:255}if(8==h)for(A=0;A<a;A++){var E;m=A<<2,y=3*(E=t[A]);l[m]=e[y],l[m+1]=e[y+1],l[m+2]=e[y+2],l[m+3]=E<c?s[E]:255}}else if(4==u){if(8==h)for(A=0;A<a;A++){m=A<<2;var F=t[_=A<<1];l[m]=F,l[m+1]=F,l[m+2]=F,l[m+3]=t[_+1]}if(16==h)for(A=0;A<a;A++){var _;m=A<<2,F=t[_=A<<2];l[m]=F,l[m+1]=F,l[m+2]=F,l[m+3]=t[_+2]}}else if(0==u)for(p=o.tabs.tRNS?o.tabs.tRNS:-1,w=0;w<i;w++){const e=w*f,i=w*r;if(1==h)for(var B=0;B<r;B++){var U=(F=255*(t[e+(B>>>3)]>>>7-(7&B)&1))==255*p?0:255;c[i+B]=U<<24|F<<16|F<<8|F}else if(2==h)for(B=0;B<r;B++){U=(F=85*(t[e+(B>>>2)]>>>6-((3&B)<<1)&3))==85*p?0:255;c[i+B]=U<<24|F<<16|F<<8|F}else if(4==h)for(B=0;B<r;B++){U=(F=17*(t[e+(B>>>1)]>>>4-((1&B)<<2)&15))==17*p?0:255;c[i+B]=U<<24|F<<16|F<<8|F}else if(8==h)for(B=0;B<r;B++){U=(F=t[e+B])==p?0:255;c[i+B]=U<<24|F<<16|F<<8|F}else if(16==h)for(B=0;B<r;B++){F=t[e+(B<<1)],U=d(t,e+(B<<1))==p?0:255;c[i+B]=U<<24|F<<16|F<<8|F}}return l}function _decompress(e,r,i,o){const a=_getBPP(e),s=Math.ceil(i*a/8),f=new Uint8Array((s+1+e.interlace)*o);return r=e.tabs.CgBI?t(r,f):_inflate(r,f),0==e.interlace?r=_filterZero(r,e,0,i,o):1==e.interlace&&(r=function _readInterlace(e,t){const r=t.width,i=t.height,o=_getBPP(t),a=o>>3,s=Math.ceil(r*o/8),f=new Uint8Array(i*s);let l=0;const c=[0,0,4,0,2,0,1],u=[0,4,0,2,0,1,0],h=[8,8,8,4,4,2,2],d=[8,8,4,4,2,2,1];let A=0;for(;A<7;){const p=h[A],m=d[A];let w=0,v=0,b=c[A];for(;b<i;)b+=p,v++;let y=u[A];for(;y<r;)y+=m,w++;const E=Math.ceil(w*o/8);_filterZero(e,t,l,w,v);let F=0,_=c[A];for(;_<i;){let t=u[A],i=l+F*E<<3;for(;t<r;){var g;if(1==o)g=(g=e[i>>3])>>7-(7&i)&1,f[_*s+(t>>3)]|=g<<7-((7&t)<<0);if(2==o)g=(g=e[i>>3])>>6-(7&i)&3,f[_*s+(t>>2)]|=g<<6-((3&t)<<1);if(4==o)g=(g=e[i>>3])>>4-(7&i)&15,f[_*s+(t>>1)]|=g<<4-((1&t)<<2);if(o>=8){const r=_*s+t*a;for(let t=0;t<a;t++)f[r+t]=e[(i>>3)+t]}i+=o,t+=m}F++,_+=p}w*v!=0&&(l+=v*(1+E)),A+=1}return f}(r,e)),r}function _inflate(e,r){return t(new Uint8Array(e.buffer,2,e.length-6),r)}var t=function(){const e={H:{}};return e.H.N=function(t,r){const i=Uint8Array;let o,a,s=0,f=0,l=0,c=0,u=0,h=0,d=0,A=0,g=0;if(3==t[0]&&0==t[1])return r||new i(0);const p=e.H,m=p.b,w=p.e,v=p.R,b=p.n,y=p.A,E=p.Z,F=p.m,_=null==r;for(_&&(r=new i(t.length>>>2<<5));0==s;)if(s=m(t,g,1),f=m(t,g+1,2),g+=3,0!=f){if(_&&(r=e.H.W(r,A+(1<<17))),1==f&&(o=F.J,a=F.h,h=511,d=31),2==f){l=w(t,g,5)+257,c=w(t,g+5,5)+1,u=w(t,g+10,4)+4,g+=14;let e=1;for(var B=0;B<38;B+=2)F.Q[B]=0,F.Q[B+1]=0;for(B=0;B<u;B++){const r=w(t,g+3*B,3);F.Q[1+(F.X[B]<<1)]=r,r>e&&(e=r)}g+=3*u,b(F.Q,e),y(F.Q,e,F.u),o=F.w,a=F.d,g=v(F.u,(1<<e)-1,l+c,t,g,F.v);const r=p.V(F.v,0,l,F.C);h=(1<<r)-1;const i=p.V(F.v,l,c,F.D);d=(1<<i)-1,b(F.C,r),y(F.C,r,o),b(F.D,i),y(F.D,i,a)}for(;;){const e=o[E(t,g)&h];g+=15&e;const i=e>>>4;if(i>>>8==0)r[A++]=i;else{if(256==i)break;{let e=A+i-254;if(i>264){const r=F.q[i-257];e=A+(r>>>3)+w(t,g,7&r),g+=7&r}const o=a[E(t,g)&d];g+=15&o;const s=o>>>4,f=F.c[s],l=(f>>>4)+m(t,g,15&f);for(g+=15&f;A<e;)r[A]=r[A++-l],r[A]=r[A++-l],r[A]=r[A++-l],r[A]=r[A++-l];A=e}}}}else{0!=(7&g)&&(g+=8-(7&g));const o=4+(g>>>3),a=t[o-4]|t[o-3]<<8;_&&(r=e.H.W(r,A+a)),r.set(new i(t.buffer,t.byteOffset+o,a),A),g=o+a<<3,A+=a}return r.length==A?r:r.slice(0,A)},e.H.W=function(e,t){const r=e.length;if(t<=r)return e;const i=new Uint8Array(r<<1);return i.set(e,0),i},e.H.R=function(t,r,i,o,a,s){const f=e.H.e,l=e.H.Z;let c=0;for(;c<i;){const e=t[l(o,a)&r];a+=15&e;const i=e>>>4;if(i<=15)s[c]=i,c++;else{let e=0,t=0;16==i?(t=3+f(o,a,2),a+=2,e=s[c-1]):17==i?(t=3+f(o,a,3),a+=3):18==i&&(t=11+f(o,a,7),a+=7);const r=c+t;for(;c<r;)s[c]=e,c++}}return a},e.H.V=function(e,t,r,i){let o=0,a=0;const s=i.length>>>1;for(;a<r;){const r=e[a+t];i[a<<1]=0,i[1+(a<<1)]=r,r>o&&(o=r),a++}for(;a<s;)i[a<<1]=0,i[1+(a<<1)]=0,a++;return o},e.H.n=function(t,r){const i=e.H.m,o=t.length;let a,s,f;let l;const c=i.j;for(var u=0;u<=r;u++)c[u]=0;for(u=1;u<o;u+=2)c[t[u]]++;const h=i.K;for(a=0,c[0]=0,s=1;s<=r;s++)a=a+c[s-1]<<1,h[s]=a;for(f=0;f<o;f+=2)l=t[f+1],0!=l&&(t[f]=h[l],h[l]++)},e.H.A=function(t,r,i){const o=t.length,a=e.H.m.r;for(let e=0;e<o;e+=2)if(0!=t[e+1]){const o=e>>1,s=t[e+1],f=o<<4|s,l=r-s;let c=t[e]<<l;const u=c+(1<<l);for(;c!=u;){i[a[c]>>>15-r]=f,c++}}},e.H.l=function(t,r){const i=e.H.m.r,o=15-r;for(let e=0;e<t.length;e+=2){const a=t[e]<<r-t[e+1];t[e]=i[a]>>>o}},e.H.M=function(e,t,r){r<<=7&t;const i=t>>>3;e[i]|=r,e[i+1]|=r>>>8},e.H.I=function(e,t,r){r<<=7&t;const i=t>>>3;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},e.H.e=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<r)-1},e.H.b=function(e,t,r){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<r)-1},e.H.Z=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},e.H.i=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},e.H.m=function(){const e=Uint16Array,t=Uint32Array;return{K:new e(16),j:new e(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new e(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new t(32),J:new e(512),_:[],h:new e(32),$:[],w:new e(32768),C:[],v:[],d:new e(32768),D:[],u:new e(512),Q:[],r:new e(32768),s:new t(286),Y:new t(30),a:new t(19),t:new t(15e3),k:new e(65536),g:new e(32768)}}(),function(){const t=e.H.m;for(var r=0;r<32768;r++){let e=r;e=(2863311530&e)>>>1|(1431655765&e)<<1,e=(3435973836&e)>>>2|(858993459&e)<<2,e=(4042322160&e)>>>4|(252645135&e)<<4,e=(4278255360&e)>>>8|(16711935&e)<<8,t.r[r]=(e>>>16|e<<16)>>>17}function n(e,t,r){for(;0!=t--;)e.push(0,r)}for(r=0;r<32;r++)t.q[r]=t.S[r]<<3|t.T[r],t.c[r]=t.p[r]<<4|t.z[r];n(t._,144,8),n(t._,112,9),n(t._,24,7),n(t._,8,8),e.H.n(t._,9),e.H.A(t._,9,t.J),e.H.l(t._,9),n(t.$,32,5),e.H.n(t.$,5),e.H.A(t.$,5,t.h),e.H.l(t.$,5),n(t.Q,19,0),n(t.C,286,0),n(t.D,30,0),n(t.v,320,0)}(),e.H.N}();function _getBPP(e){return[1,null,3,1,2,null,4][e.ctype]*e.depth}function _filterZero(e,t,r,i,o){let a=_getBPP(t);const s=Math.ceil(i*a/8);let f,l;a=Math.ceil(a/8);let c=e[r],u=0;if(c>1&&(e[r]=[0,0,1][c-2]),3==c)for(u=a;u<s;u++)e[u+1]=e[u+1]+(e[u+1-a]>>>1)&255;for(let t=0;t<o;t++)if(f=r+t*s,l=f+t+1,c=e[l-1],u=0,0==c)for(;u<s;u++)e[f+u]=e[l+u];else if(1==c){for(;u<a;u++)e[f+u]=e[l+u];for(;u<s;u++)e[f+u]=e[l+u]+e[f+u-a]}else if(2==c)for(;u<s;u++)e[f+u]=e[l+u]+e[f+u-s];else if(3==c){for(;u<a;u++)e[f+u]=e[l+u]+(e[f+u-s]>>>1);for(;u<s;u++)e[f+u]=e[l+u]+(e[f+u-s]+e[f+u-a]>>>1)}else{for(;u<a;u++)e[f+u]=e[l+u]+_paeth(0,e[f+u-s],0);for(;u<s;u++)e[f+u]=e[l+u]+_paeth(e[f+u-a],e[f+u-s],e[f+u-a-s])}return e}function _paeth(e,t,r){const i=e+t-r,o=i-e,a=i-t,s=i-r;return o*o<=a*a&&o*o<=s*s?e:a*a<=s*s?t:r}function _IHDR(t,r,i){i.width=e.readUint(t,r),r+=4,i.height=e.readUint(t,r),r+=4,i.depth=t[r],r++,i.ctype=t[r],r++,i.compress=t[r],r++,i.filter=t[r],r++,i.interlace=t[r],r++}function _copyTile(e,t,r,i,o,a,s,f,l){const c=Math.min(t,o),u=Math.min(r,a);let h=0,d=0;for(let r=0;r<u;r++)for(let a=0;a<c;a++)if(s>=0&&f>=0?(h=r*t+a<<2,d=(f+r)*o+s+a<<2):(h=(-f+r)*t-s+a<<2,d=r*o+a<<2),0==l)i[d]=e[h],i[d+1]=e[h+1],i[d+2]=e[h+2],i[d+3]=e[h+3];else if(1==l){var A=e[h+3]*(1/255),g=e[h]*A,p=e[h+1]*A,m=e[h+2]*A,w=i[d+3]*(1/255),v=i[d]*w,b=i[d+1]*w,y=i[d+2]*w;const t=1-A,r=A+w*t,o=0==r?0:1/r;i[d+3]=255*r,i[d+0]=(g+v*t)*o,i[d+1]=(p+b*t)*o,i[d+2]=(m+y*t)*o}else if(2==l){A=e[h+3],g=e[h],p=e[h+1],m=e[h+2],w=i[d+3],v=i[d],b=i[d+1],y=i[d+2];A==w&&g==v&&p==b&&m==y?(i[d]=0,i[d+1]=0,i[d+2]=0,i[d+3]=0):(i[d]=g,i[d+1]=p,i[d+2]=m,i[d+3]=A)}else if(3==l){A=e[h+3],g=e[h],p=e[h+1],m=e[h+2],w=i[d+3],v=i[d],b=i[d+1],y=i[d+2];if(A==w&&g==v&&p==b&&m==y)continue;if(A<220&&w>20)return!1}return!0}return{decode:function decode(r){const i=new Uint8Array(r);let o=8;const a=e,s=a.readUshort,f=a.readUint,l={tabs:{},frames:[]},c=new Uint8Array(i.length);let u,h=0,d=0;const A=[137,80,78,71,13,10,26,10];for(var g=0;g<8;g++)if(i[g]!=A[g])throw\"The input is not a PNG file!\";for(;o<i.length;){const e=a.readUint(i,o);o+=4;const r=a.readASCII(i,o,4);if(o+=4,\"IHDR\"==r)_IHDR(i,o,l);else if(\"iCCP\"==r){for(var p=o;0!=i[p];)p++;a.readASCII(i,o,p-o),i[p+1];const s=i.slice(p+2,o+e);let f=null;try{f=_inflate(s)}catch(e){f=t(s)}l.tabs[r]=f}else if(\"CgBI\"==r)l.tabs[r]=i.slice(o,o+4);else if(\"IDAT\"==r){for(g=0;g<e;g++)c[h+g]=i[o+g];h+=e}else if(\"acTL\"==r)l.tabs[r]={num_frames:f(i,o),num_plays:f(i,o+4)},u=new Uint8Array(i.length);else if(\"fcTL\"==r){if(0!=d)(E=l.frames[l.frames.length-1]).data=_decompress(l,u.slice(0,d),E.rect.width,E.rect.height),d=0;const e={x:f(i,o+12),y:f(i,o+16),width:f(i,o+4),height:f(i,o+8)};let t=s(i,o+22);t=s(i,o+20)/(0==t?100:t);const r={rect:e,delay:Math.round(1e3*t),dispose:i[o+24],blend:i[o+25]};l.frames.push(r)}else if(\"fdAT\"==r){for(g=0;g<e-4;g++)u[d+g]=i[o+g+4];d+=e-4}else if(\"pHYs\"==r)l.tabs[r]=[a.readUint(i,o),a.readUint(i,o+4),i[o+8]];else if(\"cHRM\"==r){l.tabs[r]=[];for(g=0;g<8;g++)l.tabs[r].push(a.readUint(i,o+4*g))}else if(\"tEXt\"==r||\"zTXt\"==r){null==l.tabs[r]&&(l.tabs[r]={});var m=a.nextZero(i,o),w=a.readASCII(i,o,m-o),v=o+e-m-1;if(\"tEXt\"==r)y=a.readASCII(i,m+1,v);else{var b=_inflate(i.slice(m+2,m+2+v));y=a.readUTF8(b,0,b.length)}l.tabs[r][w]=y}else if(\"iTXt\"==r){null==l.tabs[r]&&(l.tabs[r]={});m=0,p=o;m=a.nextZero(i,p);w=a.readASCII(i,p,m-p);const t=i[p=m+1];var y;i[p+1],p+=2,m=a.nextZero(i,p),a.readASCII(i,p,m-p),p=m+1,m=a.nextZero(i,p),a.readUTF8(i,p,m-p);v=e-((p=m+1)-o);if(0==t)y=a.readUTF8(i,p,v);else{b=_inflate(i.slice(p,p+v));y=a.readUTF8(b,0,b.length)}l.tabs[r][w]=y}else if(\"PLTE\"==r)l.tabs[r]=a.readBytes(i,o,e);else if(\"hIST\"==r){const e=l.tabs.PLTE.length/3;l.tabs[r]=[];for(g=0;g<e;g++)l.tabs[r].push(s(i,o+2*g))}else if(\"tRNS\"==r)3==l.ctype?l.tabs[r]=a.readBytes(i,o,e):0==l.ctype?l.tabs[r]=s(i,o):2==l.ctype&&(l.tabs[r]=[s(i,o),s(i,o+2),s(i,o+4)]);else if(\"gAMA\"==r)l.tabs[r]=a.readUint(i,o)/1e5;else if(\"sRGB\"==r)l.tabs[r]=i[o];else if(\"bKGD\"==r)0==l.ctype||4==l.ctype?l.tabs[r]=[s(i,o)]:2==l.ctype||6==l.ctype?l.tabs[r]=[s(i,o),s(i,o+2),s(i,o+4)]:3==l.ctype&&(l.tabs[r]=i[o]);else if(\"IEND\"==r)break;o+=e,a.readUint(i,o),o+=4}var E;return 0!=d&&((E=l.frames[l.frames.length-1]).data=_decompress(l,u.slice(0,d),E.rect.width,E.rect.height)),l.data=_decompress(l,c,l.width,l.height),delete l.compress,delete l.interlace,delete l.filter,l},toRGBA8:function toRGBA8(e){const t=e.width,r=e.height;if(null==e.tabs.acTL)return[decodeImage(e.data,t,r,e).buffer];const i=[];null==e.frames[0].data&&(e.frames[0].data=e.data);const o=t*r*4,a=new Uint8Array(o),s=new Uint8Array(o),f=new Uint8Array(o);for(let c=0;c<e.frames.length;c++){const u=e.frames[c],h=u.rect.x,d=u.rect.y,A=u.rect.width,g=u.rect.height,p=decodeImage(u.data,A,g,e);if(0!=c)for(var l=0;l<o;l++)f[l]=a[l];if(0==u.blend?_copyTile(p,A,g,a,t,r,h,d,0):1==u.blend&&_copyTile(p,A,g,a,t,r,h,d,1),i.push(a.buffer.slice(0)),0==u.dispose);else if(1==u.dispose)_copyTile(s,A,g,a,t,r,h,d,0);else if(2==u.dispose)for(l=0;l<o;l++)a[l]=f[l]}return i},_paeth:_paeth,_copyTile:_copyTile,_bin:e}}();!function(){const{_copyTile:e}=UPNG,{_bin:t}=UPNG,r=UPNG._paeth;var i={table:function(){const e=new Uint32Array(256);for(let t=0;t<256;t++){let r=t;for(let e=0;e<8;e++)1&r?r=3988292384^r>>>1:r>>>=1;e[t]=r}return e}(),update(e,t,r,o){for(let a=0;a<o;a++)e=i.table[255&(e^t[r+a])]^e>>>8;return e},crc:(e,t,r)=>4294967295^i.update(4294967295,e,t,r)};function addErr(e,t,r,i){t[r]+=e[0]*i>>4,t[r+1]+=e[1]*i>>4,t[r+2]+=e[2]*i>>4,t[r+3]+=e[3]*i>>4}function N(e){return Math.max(0,Math.min(255,e))}function D(e,t){const r=e[0]-t[0],i=e[1]-t[1],o=e[2]-t[2],a=e[3]-t[3];return r*r+i*i+o*o+a*a}function dither(e,t,r,i,o,a,s){null==s&&(s=1);const f=i.length,l=[];for(var c=0;c<f;c++){const e=i[c];l.push([e>>>0&255,e>>>8&255,e>>>16&255,e>>>24&255])}for(c=0;c<f;c++){let e=4294967295;for(var u=0,h=0;h<f;h++){var d=D(l[c],l[h]);h!=c&&d<e&&(e=d,u=h)}}const A=new Uint32Array(o.buffer),g=new Int16Array(t*r*4),p=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(c=0;c<p.length;c++)p[c]=255*((p[c]+.5)/16-.5);for(let o=0;o<r;o++)for(let w=0;w<t;w++){var m;c=4*(o*t+w);if(2!=s)m=[N(e[c]+g[c]),N(e[c+1]+g[c+1]),N(e[c+2]+g[c+2]),N(e[c+3]+g[c+3])];else{d=p[4*(3&o)+(3&w)];m=[N(e[c]+d),N(e[c+1]+d),N(e[c+2]+d),N(e[c+3]+d)]}u=0;let v=16777215;for(h=0;h<f;h++){const e=D(m,l[h]);e<v&&(v=e,u=h)}const b=l[u],y=[m[0]-b[0],m[1]-b[1],m[2]-b[2],m[3]-b[3]];1==s&&(w!=t-1&&addErr(y,g,c+4,7),o!=r-1&&(0!=w&&addErr(y,g,c+4*t-4,3),addErr(y,g,c+4*t,5),w!=t-1&&addErr(y,g,c+4*t+4,1))),a[c>>2]=u,A[c>>2]=i[u]}}function _main(e,r,o,a,s){null==s&&(s={});const{crc:f}=i,l=t.writeUint,c=t.writeUshort,u=t.writeASCII;let h=8;const d=e.frames.length>1;let A,g=!1,p=33+(d?20:0);if(null!=s.sRGB&&(p+=13),null!=s.pHYs&&(p+=21),null!=s.iCCP&&(A=pako.deflate(s.iCCP),p+=21+A.length+4),3==e.ctype){for(var m=e.plte.length,w=0;w<m;w++)e.plte[w]>>>24!=255&&(g=!0);p+=8+3*m+4+(g?8+1*m+4:0)}for(var v=0;v<e.frames.length;v++){d&&(p+=38),p+=(F=e.frames[v]).cimg.length+12,0!=v&&(p+=4)}p+=12;const b=new Uint8Array(p),y=[137,80,78,71,13,10,26,10];for(w=0;w<8;w++)b[w]=y[w];if(l(b,h,13),h+=4,u(b,h,\"IHDR\"),h+=4,l(b,h,r),h+=4,l(b,h,o),h+=4,b[h]=e.depth,h++,b[h]=e.ctype,h++,b[h]=0,h++,b[h]=0,h++,b[h]=0,h++,l(b,h,f(b,h-17,17)),h+=4,null!=s.sRGB&&(l(b,h,1),h+=4,u(b,h,\"sRGB\"),h+=4,b[h]=s.sRGB,h++,l(b,h,f(b,h-5,5)),h+=4),null!=s.iCCP){const e=13+A.length;l(b,h,e),h+=4,u(b,h,\"iCCP\"),h+=4,u(b,h,\"ICC profile\"),h+=11,h+=2,b.set(A,h),h+=A.length,l(b,h,f(b,h-(e+4),e+4)),h+=4}if(null!=s.pHYs&&(l(b,h,9),h+=4,u(b,h,\"pHYs\"),h+=4,l(b,h,s.pHYs[0]),h+=4,l(b,h,s.pHYs[1]),h+=4,b[h]=s.pHYs[2],h++,l(b,h,f(b,h-13,13)),h+=4),d&&(l(b,h,8),h+=4,u(b,h,\"acTL\"),h+=4,l(b,h,e.frames.length),h+=4,l(b,h,null!=s.loop?s.loop:0),h+=4,l(b,h,f(b,h-12,12)),h+=4),3==e.ctype){l(b,h,3*(m=e.plte.length)),h+=4,u(b,h,\"PLTE\"),h+=4;for(w=0;w<m;w++){const t=3*w,r=e.plte[w],i=255&r,o=r>>>8&255,a=r>>>16&255;b[h+t+0]=i,b[h+t+1]=o,b[h+t+2]=a}if(h+=3*m,l(b,h,f(b,h-3*m-4,3*m+4)),h+=4,g){l(b,h,m),h+=4,u(b,h,\"tRNS\"),h+=4;for(w=0;w<m;w++)b[h+w]=e.plte[w]>>>24&255;h+=m,l(b,h,f(b,h-m-4,m+4)),h+=4}}let E=0;for(v=0;v<e.frames.length;v++){var F=e.frames[v];d&&(l(b,h,26),h+=4,u(b,h,\"fcTL\"),h+=4,l(b,h,E++),h+=4,l(b,h,F.rect.width),h+=4,l(b,h,F.rect.height),h+=4,l(b,h,F.rect.x),h+=4,l(b,h,F.rect.y),h+=4,c(b,h,a[v]),h+=2,c(b,h,1e3),h+=2,b[h]=F.dispose,h++,b[h]=F.blend,h++,l(b,h,f(b,h-30,30)),h+=4);const t=F.cimg;l(b,h,(m=t.length)+(0==v?0:4)),h+=4;const r=h;u(b,h,0==v?\"IDAT\":\"fdAT\"),h+=4,0!=v&&(l(b,h,E++),h+=4),b.set(t,h),h+=m,l(b,h,f(b,r,h-r)),h+=4}return l(b,h,0),h+=4,u(b,h,\"IEND\"),h+=4,l(b,h,f(b,h-4,4)),h+=4,b.buffer}function compressPNG(e,t,r){for(let i=0;i<e.frames.length;i++){const o=e.frames[i];o.rect.width;const a=o.rect.height,s=new Uint8Array(a*o.bpl+a);o.cimg=_filterZero(o.img,a,o.bpp,o.bpl,s,t,r)}}function compress(t,r,i,o,a){const s=a[0],f=a[1],l=a[2],c=a[3],u=a[4],h=a[5];let d=6,A=8,g=255;for(var p=0;p<t.length;p++){const e=new Uint8Array(t[p]);for(var m=e.length,w=0;w<m;w+=4)g&=e[w+3]}const v=255!=g,b=function framize(t,r,i,o,a,s){const f=[];for(var l=0;l<t.length;l++){const h=new Uint8Array(t[l]),A=new Uint32Array(h.buffer);var c;let g=0,p=0,m=r,w=i,v=o?1:0;if(0!=l){const b=s||o||1==l||0!=f[l-2].dispose?1:2;let y=0,E=1e9;for(let e=0;e<b;e++){var u=new Uint8Array(t[l-1-e]);const o=new Uint32Array(t[l-1-e]);let s=r,f=i,c=-1,h=-1;for(let e=0;e<i;e++)for(let t=0;t<r;t++){A[d=e*r+t]!=o[d]&&(t<s&&(s=t),t>c&&(c=t),e<f&&(f=e),e>h&&(h=e))}-1==c&&(s=f=c=h=0),a&&(1==(1&s)&&s--,1==(1&f)&&f--);const v=(c-s+1)*(h-f+1);v<E&&(E=v,y=e,g=s,p=f,m=c-s+1,w=h-f+1)}u=new Uint8Array(t[l-1-y]);1==y&&(f[l-1].dispose=2),c=new Uint8Array(m*w*4),e(u,r,i,c,m,w,-g,-p,0),v=e(h,r,i,c,m,w,-g,-p,3)?1:0,1==v?_prepareDiff(h,r,i,c,{x:g,y:p,width:m,height:w}):e(h,r,i,c,m,w,-g,-p,0)}else c=h.slice(0);f.push({rect:{x:g,y:p,width:m,height:w},img:c,blend:v,dispose:0})}if(o)for(l=0;l<f.length;l++){if(1==(A=f[l]).blend)continue;const e=A.rect,o=f[l-1].rect,s=Math.min(e.x,o.x),c=Math.min(e.y,o.y),u={x:s,y:c,width:Math.max(e.x+e.width,o.x+o.width)-s,height:Math.max(e.y+e.height,o.y+o.height)-c};f[l-1].dispose=1,l-1!=0&&_updateFrame(t,r,i,f,l-1,u,a),_updateFrame(t,r,i,f,l,u,a)}let h=0;if(1!=t.length)for(var d=0;d<f.length;d++){var A;h+=(A=f[d]).rect.width*A.rect.height}return f}(t,r,i,s,f,l),y={},E=[],F=[];if(0!=o){const e=[];for(w=0;w<b.length;w++)e.push(b[w].img.buffer);const t=function concatRGBA(e){let t=0;for(var r=0;r<e.length;r++)t+=e[r].byteLength;const i=new Uint8Array(t);let o=0;for(r=0;r<e.length;r++){const t=new Uint8Array(e[r]),a=t.length;for(let e=0;e<a;e+=4){let r=t[e],a=t[e+1],s=t[e+2];const f=t[e+3];0==f&&(r=a=s=0),i[o+e]=r,i[o+e+1]=a,i[o+e+2]=s,i[o+e+3]=f}o+=a}return i.buffer}(e),r=quantize(t,o);for(w=0;w<r.plte.length;w++)E.push(r.plte[w].est.rgba);let i=0;for(w=0;w<b.length;w++){const e=(B=b[w]).img.length;var _=new Uint8Array(r.inds.buffer,i>>2,e>>2);F.push(_);const t=new Uint8Array(r.abuf,i,e);h&&dither(B.img,B.rect.width,B.rect.height,E,t,_),B.img.set(t),i+=e}}else for(p=0;p<b.length;p++){var B=b[p];const e=new Uint32Array(B.img.buffer);var U=B.rect.width;m=e.length,_=new Uint8Array(m);F.push(_);for(w=0;w<m;w++){const t=e[w];if(0!=w&&t==e[w-1])_[w]=_[w-1];else if(w>U&&t==e[w-U])_[w]=_[w-U];else{let e=y[t];if(null==e&&(y[t]=e=E.length,E.push(t),E.length>=300))break;_[w]=e}}}const C=E.length;C<=256&&0==u&&(A=C<=2?1:C<=4?2:C<=16?4:8,A=Math.max(A,c));for(p=0;p<b.length;p++){(B=b[p]).rect.x,B.rect.y;U=B.rect.width;const e=B.rect.height;let t=B.img;new Uint32Array(t.buffer);let r=4*U,i=4;if(C<=256&&0==u){r=Math.ceil(A*U/8);var I=new Uint8Array(r*e);const o=F[p];for(let t=0;t<e;t++){w=t*r;const e=t*U;if(8==A)for(var Q=0;Q<U;Q++)I[w+Q]=o[e+Q];else if(4==A)for(Q=0;Q<U;Q++)I[w+(Q>>1)]|=o[e+Q]<<4-4*(1&Q);else if(2==A)for(Q=0;Q<U;Q++)I[w+(Q>>2)]|=o[e+Q]<<6-2*(3&Q);else if(1==A)for(Q=0;Q<U;Q++)I[w+(Q>>3)]|=o[e+Q]<<7-1*(7&Q)}t=I,d=3,i=1}else if(0==v&&1==b.length){I=new Uint8Array(U*e*3);const o=U*e;for(w=0;w<o;w++){const e=3*w,r=4*w;I[e]=t[r],I[e+1]=t[r+1],I[e+2]=t[r+2]}t=I,d=2,i=3,r=3*U}B.img=t,B.bpl=r,B.bpp=i}return{ctype:d,depth:A,plte:E,frames:b}}function _updateFrame(t,r,i,o,a,s,f){const l=Uint8Array,c=Uint32Array,u=new l(t[a-1]),h=new c(t[a-1]),d=a+1<t.length?new l(t[a+1]):null,A=new l(t[a]),g=new c(A.buffer);let p=r,m=i,w=-1,v=-1;for(let e=0;e<s.height;e++)for(let t=0;t<s.width;t++){const i=s.x+t,f=s.y+e,l=f*r+i,c=g[l];0==c||0==o[a-1].dispose&&h[l]==c&&(null==d||0!=d[4*l+3])||(i<p&&(p=i),i>w&&(w=i),f<m&&(m=f),f>v&&(v=f))}-1==w&&(p=m=w=v=0),f&&(1==(1&p)&&p--,1==(1&m)&&m--),s={x:p,y:m,width:w-p+1,height:v-m+1};const b=o[a];b.rect=s,b.blend=1,b.img=new Uint8Array(s.width*s.height*4),0==o[a-1].dispose?(e(u,r,i,b.img,s.width,s.height,-s.x,-s.y,0),_prepareDiff(A,r,i,b.img,s)):e(A,r,i,b.img,s.width,s.height,-s.x,-s.y,0)}function _prepareDiff(t,r,i,o,a){e(t,r,i,o,a.width,a.height,-a.x,-a.y,2)}function _filterZero(e,t,r,i,o,a,s){const f=[];let l,c=[0,1,2,3,4];-1!=a?c=[a]:(t*i>5e5||1==r)&&(c=[0]),s&&(l={level:0});const u=UZIP;for(var h=0;h<c.length;h++){for(let a=0;a<t;a++)_filterLine(o,e,a,i,r,c[h]);f.push(u.deflate(o,l))}let d,A=1e9;for(h=0;h<f.length;h++)f[h].length<A&&(d=h,A=f[h].length);return f[d]}function _filterLine(e,t,i,o,a,s){const f=i*o;let l=f+i;if(e[l]=s,l++,0==s)if(o<500)for(var c=0;c<o;c++)e[l+c]=t[f+c];else e.set(new Uint8Array(t.buffer,f,o),l);else if(1==s){for(c=0;c<a;c++)e[l+c]=t[f+c];for(c=a;c<o;c++)e[l+c]=t[f+c]-t[f+c-a]+256&255}else if(0==i){for(c=0;c<a;c++)e[l+c]=t[f+c];if(2==s)for(c=a;c<o;c++)e[l+c]=t[f+c];if(3==s)for(c=a;c<o;c++)e[l+c]=t[f+c]-(t[f+c-a]>>1)+256&255;if(4==s)for(c=a;c<o;c++)e[l+c]=t[f+c]-r(t[f+c-a],0,0)+256&255}else{if(2==s)for(c=0;c<o;c++)e[l+c]=t[f+c]+256-t[f+c-o]&255;if(3==s){for(c=0;c<a;c++)e[l+c]=t[f+c]+256-(t[f+c-o]>>1)&255;for(c=a;c<o;c++)e[l+c]=t[f+c]+256-(t[f+c-o]+t[f+c-a]>>1)&255}if(4==s){for(c=0;c<a;c++)e[l+c]=t[f+c]+256-r(0,t[f+c-o],0)&255;for(c=a;c<o;c++)e[l+c]=t[f+c]+256-r(t[f+c-a],t[f+c-o],t[f+c-a-o])&255}}}function quantize(e,t){const r=new Uint8Array(e),i=r.slice(0),o=new Uint32Array(i.buffer),a=getKDtree(i,t),s=a[0],f=a[1],l=r.length,c=new Uint8Array(l>>2);let u;if(r.length<2e7)for(var h=0;h<l;h+=4){u=getNearest(s,d=r[h]*(1/255),A=r[h+1]*(1/255),g=r[h+2]*(1/255),p=r[h+3]*(1/255)),c[h>>2]=u.ind,o[h>>2]=u.est.rgba}else for(h=0;h<l;h+=4){var d=r[h]*(1/255),A=r[h+1]*(1/255),g=r[h+2]*(1/255),p=r[h+3]*(1/255);for(u=s;u.left;)u=planeDst(u.est,d,A,g,p)<=0?u.left:u.right;c[h>>2]=u.ind,o[h>>2]=u.est.rgba}return{abuf:i.buffer,inds:c,plte:f}}function getKDtree(e,t,r){null==r&&(r=1e-4);const i=new Uint32Array(e.buffer),o={i0:0,i1:e.length,bst:null,est:null,tdst:0,left:null,right:null};o.bst=stats(e,o.i0,o.i1),o.est=estats(o.bst);const a=[o];for(;a.length<t;){let t=0,o=0;for(var s=0;s<a.length;s++)a[s].est.L>t&&(t=a[s].est.L,o=s);if(t<r)break;const f=a[o],l=splitPixels(e,i,f.i0,f.i1,f.est.e,f.est.eMq255);if(f.i0>=l||f.i1<=l){f.est.L=0;continue}const c={i0:f.i0,i1:l,bst:null,est:null,tdst:0,left:null,right:null};c.bst=stats(e,c.i0,c.i1),c.est=estats(c.bst);const u={i0:l,i1:f.i1,bst:null,est:null,tdst:0,left:null,right:null};u.bst={R:[],m:[],N:f.bst.N-c.bst.N};for(s=0;s<16;s++)u.bst.R[s]=f.bst.R[s]-c.bst.R[s];for(s=0;s<4;s++)u.bst.m[s]=f.bst.m[s]-c.bst.m[s];u.est=estats(u.bst),f.left=c,f.right=u,a[o]=c,a.push(u)}a.sort(((e,t)=>t.bst.N-e.bst.N));for(s=0;s<a.length;s++)a[s].ind=s;return[o,a]}function getNearest(e,t,r,i,o){if(null==e.left)return e.tdst=function dist(e,t,r,i,o){const a=t-e[0],s=r-e[1],f=i-e[2],l=o-e[3];return a*a+s*s+f*f+l*l}(e.est.q,t,r,i,o),e;const a=planeDst(e.est,t,r,i,o);let s=e.left,f=e.right;a>0&&(s=e.right,f=e.left);const l=getNearest(s,t,r,i,o);if(l.tdst<=a*a)return l;const c=getNearest(f,t,r,i,o);return c.tdst<l.tdst?c:l}function planeDst(e,t,r,i,o){const{e:a}=e;return a[0]*t+a[1]*r+a[2]*i+a[3]*o-e.eMq}function splitPixels(e,t,r,i,o,a){for(i-=4;r<i;){for(;vecDot(e,r,o)<=a;)r+=4;for(;vecDot(e,i,o)>a;)i-=4;if(r>=i)break;const s=t[r>>2];t[r>>2]=t[i>>2],t[i>>2]=s,r+=4,i-=4}for(;vecDot(e,r,o)>a;)r-=4;return r+4}function vecDot(e,t,r){return e[t]*r[0]+e[t+1]*r[1]+e[t+2]*r[2]+e[t+3]*r[3]}function stats(e,t,r){const i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=[0,0,0,0],a=r-t>>2;for(let a=t;a<r;a+=4){const t=e[a]*(1/255),r=e[a+1]*(1/255),s=e[a+2]*(1/255),f=e[a+3]*(1/255);o[0]+=t,o[1]+=r,o[2]+=s,o[3]+=f,i[0]+=t*t,i[1]+=t*r,i[2]+=t*s,i[3]+=t*f,i[5]+=r*r,i[6]+=r*s,i[7]+=r*f,i[10]+=s*s,i[11]+=s*f,i[15]+=f*f}return i[4]=i[1],i[8]=i[2],i[9]=i[6],i[12]=i[3],i[13]=i[7],i[14]=i[11],{R:i,m:o,N:a}}function estats(e){const{R:t}=e,{m:r}=e,{N:i}=e,a=r[0],s=r[1],f=r[2],l=r[3],c=0==i?0:1/i,u=[t[0]-a*a*c,t[1]-a*s*c,t[2]-a*f*c,t[3]-a*l*c,t[4]-s*a*c,t[5]-s*s*c,t[6]-s*f*c,t[7]-s*l*c,t[8]-f*a*c,t[9]-f*s*c,t[10]-f*f*c,t[11]-f*l*c,t[12]-l*a*c,t[13]-l*s*c,t[14]-l*f*c,t[15]-l*l*c],h=u,d=o;let A=[Math.random(),Math.random(),Math.random(),Math.random()],g=0,p=0;if(0!=i)for(let e=0;e<16&&(A=d.multVec(h,A),p=Math.sqrt(d.dot(A,A)),A=d.sml(1/p,A),!(0!=e&&Math.abs(p-g)<1e-9));e++)g=p;const m=[a*c,s*c,f*c,l*c];return{Cov:u,q:m,e:A,L:g,eMq255:d.dot(d.sml(255,m),A),eMq:d.dot(A,m),rgba:(Math.round(255*m[3])<<24|Math.round(255*m[2])<<16|Math.round(255*m[1])<<8|Math.round(255*m[0])<<0)>>>0}}var o={multVec:(e,t)=>[e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],e[4]*t[0]+e[5]*t[1]+e[6]*t[2]+e[7]*t[3],e[8]*t[0]+e[9]*t[1]+e[10]*t[2]+e[11]*t[3],e[12]*t[0]+e[13]*t[1]+e[14]*t[2]+e[15]*t[3]],dot:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],sml:(e,t)=>[e*t[0],e*t[1],e*t[2],e*t[3]]};UPNG.encode=function encode(e,t,r,i,o,a,s){null==i&&(i=0),null==s&&(s=!1);const f=compress(e,t,r,i,[!1,!1,!1,0,s,!1]);return compressPNG(f,-1),_main(f,t,r,o,a)},UPNG.encodeLL=function encodeLL(e,t,r,i,o,a,s,f){const l={ctype:0+(1==i?0:2)+(0==o?0:4),depth:a,frames:[]},c=(i+o)*a,u=c*t;for(let i=0;i<e.length;i++)l.frames.push({rect:{x:0,y:0,width:t,height:r},img:new Uint8Array(e[i]),blend:0,dispose:1,bpp:Math.ceil(c/8),bpl:Math.ceil(u/8)});return compressPNG(l,0,!0),_main(l,t,r,s,f)},UPNG.encode.compress=compress,UPNG.encode.dither=dither,UPNG.quantize=quantize,UPNG.quantize.getKDtree=getKDtree,UPNG.quantize.getNearest=getNearest}();const r={toArrayBuffer(e,t){const i=e.width,o=e.height,a=i<<2,s=e.getContext(\"2d\").getImageData(0,0,i,o),f=new Uint32Array(s.data.buffer),l=(32*i+31)/32<<2,c=l*o,u=122+c,h=new ArrayBuffer(u),d=new DataView(h),A=1<<20;let g,p,m,w,v=A,b=0,y=0,E=0;function set16(e){d.setUint16(y,e,!0),y+=2}function set32(e){d.setUint32(y,e,!0),y+=4}function seek(e){y+=e}set16(19778),set32(u),seek(4),set32(122),set32(108),set32(i),set32(-o>>>0),set16(1),set16(32),set32(3),set32(c),set32(2835),set32(2835),seek(8),set32(16711680),set32(65280),set32(255),set32(4278190080),set32(1466527264),function convert(){for(;b<o&&v>0;){for(w=122+b*l,g=0;g<a;)v--,p=f[E++],m=p>>>24,d.setUint32(w+g,p<<8|m),g+=4;b++}E<f.length?(v=A,setTimeout(convert,r._dly)):t(h)}()},toBlob(e,t){this.toArrayBuffer(e,(e=>{t(new Blob([e],{type:\"image/bmp\"}))}))},_dly:9};var i={CHROME:\"CHROME\",FIREFOX:\"FIREFOX\",DESKTOP_SAFARI:\"DESKTOP_SAFARI\",IE:\"IE\",IOS:\"IOS\",ETC:\"ETC\"},o={[i.CHROME]:16384,[i.FIREFOX]:11180,[i.DESKTOP_SAFARI]:16384,[i.IE]:8192,[i.IOS]:4096,[i.ETC]:8192};const a=\"undefined\"!=typeof window,s=\"undefined\"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,f=a&&window.cordova&&window.cordova.require&&window.cordova.require(\"cordova/modulemapper\"),CustomFile=(a||s)&&(f&&f.getOriginalSymbol(window,\"File\")||\"undefined\"!=typeof File&&File),CustomFileReader=(a||s)&&(f&&f.getOriginalSymbol(window,\"FileReader\")||\"undefined\"!=typeof FileReader&&FileReader);function getFilefromDataUrl(e,t,r=Date.now()){return new Promise((i=>{const o=e.split(\",\"),a=o[0].match(/:(.*?);/)[1],s=globalThis.atob(o[1]);let f=s.length;const l=new Uint8Array(f);for(;f--;)l[f]=s.charCodeAt(f);const c=new Blob([l],{type:a});c.name=t,c.lastModified=r,i(c)}))}function getDataUrlFromFile(e){return new Promise(((t,r)=>{const i=new CustomFileReader;i.onload=()=>t(i.result),i.onerror=e=>r(e),i.readAsDataURL(e)}))}function loadImage(e){return new Promise(((t,r)=>{const i=new Image;i.onload=()=>t(i),i.onerror=e=>r(e),i.src=e}))}function getBrowserName(){if(void 0!==getBrowserName.cachedResult)return getBrowserName.cachedResult;let e=i.ETC;const{userAgent:t}=navigator;return/Chrom(e|ium)/i.test(t)?e=i.CHROME:/iP(ad|od|hone)/i.test(t)&&/WebKit/i.test(t)?e=i.IOS:/Safari/i.test(t)?e=i.DESKTOP_SAFARI:/Firefox/i.test(t)?e=i.FIREFOX:(/MSIE/i.test(t)||!0==!!document.documentMode)&&(e=i.IE),getBrowserName.cachedResult=e,getBrowserName.cachedResult}function approximateBelowMaximumCanvasSizeOfBrowser(e,t){const r=getBrowserName(),i=o[r];let a=e,s=t,f=a*s;const l=a>s?s/a:a/s;for(;f>i*i;){const e=(i+a)/2,t=(i+s)/2;e<t?(s=t,a=t*l):(s=e*l,a=e),f=a*s}return{width:a,height:s}}function getNewCanvasAndCtx(e,t){let r,i;try{if(r=new OffscreenCanvas(e,t),i=r.getContext(\"2d\"),null===i)throw new Error(\"getContext of OffscreenCanvas returns null\")}catch(e){r=document.createElement(\"canvas\"),i=r.getContext(\"2d\")}return r.width=e,r.height=t,[r,i]}function drawImageInCanvas(e,t){const{width:r,height:i}=approximateBelowMaximumCanvasSizeOfBrowser(e.width,e.height),[o,a]=getNewCanvasAndCtx(r,i);return t&&/jpe?g/.test(t)&&(a.fillStyle=\"white\",a.fillRect(0,0,o.width,o.height)),a.drawImage(e,0,0,o.width,o.height),o}function isIOS(){return void 0!==isIOS.cachedResult||(isIOS.cachedResult=[\"iPad Simulator\",\"iPhone Simulator\",\"iPod Simulator\",\"iPad\",\"iPhone\",\"iPod\"].includes(navigator.platform)||navigator.userAgent.includes(\"Mac\")&&\"undefined\"!=typeof document&&\"ontouchend\"in document),isIOS.cachedResult}function drawFileInCanvas(e,t={}){return new Promise((function(r,o){let a,s;var $Try_2_Post=function(){try{return s=drawImageInCanvas(a,t.fileType||e.type),r([a,s])}catch(e){return o(e)}},$Try_2_Catch=function(t){try{0;var $Try_3_Catch=function(e){try{throw e}catch(e){return o(e)}};try{let t;return getDataUrlFromFile(e).then((function(e){try{return t=e,loadImage(t).then((function(e){try{return a=e,function(){try{return $Try_2_Post()}catch(e){return o(e)}}()}catch(e){return $Try_3_Catch(e)}}),$Try_3_Catch)}catch(e){return $Try_3_Catch(e)}}),$Try_3_Catch)}catch(e){$Try_3_Catch(e)}}catch(e){return o(e)}};try{if(isIOS()||[i.DESKTOP_SAFARI,i.MOBILE_SAFARI].includes(getBrowserName()))throw new Error(\"Skip createImageBitmap on IOS and Safari\");return createImageBitmap(e).then((function(e){try{return a=e,$Try_2_Post()}catch(e){return $Try_2_Catch()}}),$Try_2_Catch)}catch(e){$Try_2_Catch()}}))}function canvasToFile(e,t,i,o,a=1){return new Promise((function(s,f){let l;if(\"image/png\"===t){let c,u,h;return c=e.getContext(\"2d\"),({data:u}=c.getImageData(0,0,e.width,e.height)),h=UPNG.encode([u.buffer],e.width,e.height,4096*a),l=new Blob([h],{type:t}),l.name=i,l.lastModified=o,$If_4.call(this)}{if(\"image/bmp\"===t)return new Promise((t=>r.toBlob(e,t))).then(function(e){try{return l=e,l.name=i,l.lastModified=o,$If_5.call(this)}catch(e){return f(e)}}.bind(this),f);{if(\"function\"==typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return e.convertToBlob({type:t,quality:a}).then(function(e){try{return l=e,l.name=i,l.lastModified=o,$If_6.call(this)}catch(e){return f(e)}}.bind(this),f);{let d;return d=e.toDataURL(t,a),getFilefromDataUrl(d,i,o).then(function(e){try{return l=e,$If_6.call(this)}catch(e){return f(e)}}.bind(this),f)}function $If_6(){return $If_5.call(this)}}function $If_5(){return $If_4.call(this)}}function $If_4(){return s(l)}}))}function cleanupCanvasMemory(e){e.width=0,e.height=0}function isAutoOrientationInBrowser(){return new Promise((function(e,t){let r,i,o,a,s;return void 0!==isAutoOrientationInBrowser.cachedResult?e(isAutoOrientationInBrowser.cachedResult):(r=\"data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==\",getFilefromDataUrl(\"data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==\",\"test.jpg\",Date.now()).then((function(r){try{return i=r,drawFileInCanvas(i).then((function(r){try{return o=r[1],canvasToFile(o,i.type,i.name,i.lastModified).then((function(r){try{return a=r,cleanupCanvasMemory(o),drawFileInCanvas(a).then((function(r){try{return s=r[0],isAutoOrientationInBrowser.cachedResult=1===s.width&&2===s.height,e(isAutoOrientationInBrowser.cachedResult)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t)}catch(e){return t(e)}}),t))}))}function getExifOrientation(e){return new Promise(((t,r)=>{const i=new CustomFileReader;i.onload=e=>{const r=new DataView(e.target.result);if(65496!=r.getUint16(0,!1))return t(-2);const i=r.byteLength;let o=2;for(;o<i;){if(r.getUint16(o+2,!1)<=8)return t(-1);const e=r.getUint16(o,!1);if(o+=2,65505==e){if(1165519206!=r.getUint32(o+=2,!1))return t(-1);const e=18761==r.getUint16(o+=6,!1);o+=r.getUint32(o+4,e);const i=r.getUint16(o,e);o+=2;for(let a=0;a<i;a++)if(274==r.getUint16(o+12*a,e))return t(r.getUint16(o+12*a+8,e))}else{if(65280!=(65280&e))break;o+=r.getUint16(o,!1)}}return t(-1)},i.onerror=e=>r(e),i.readAsArrayBuffer(e)}))}function handleMaxWidthOrHeight(e,t){const{width:r}=e,{height:i}=e,{maxWidthOrHeight:o}=t;let a,s=e;return isFinite(o)&&(r>o||i>o)&&([s,a]=getNewCanvasAndCtx(r,i),r>i?(s.width=o,s.height=i/r*o):(s.width=r/i*o,s.height=o),a.drawImage(e,0,0,s.width,s.height),cleanupCanvasMemory(e)),s}function followExifOrientation(e,t){const{width:r}=e,{height:i}=e,[o,a]=getNewCanvasAndCtx(r,i);switch(t>4&&t<9?(o.width=i,o.height=r):(o.width=r,o.height=i),t){case 2:a.transform(-1,0,0,1,r,0);break;case 3:a.transform(-1,0,0,-1,r,i);break;case 4:a.transform(1,0,0,-1,0,i);break;case 5:a.transform(0,1,1,0,0,0);break;case 6:a.transform(0,1,-1,0,i,0);break;case 7:a.transform(0,-1,-1,0,i,r);break;case 8:a.transform(0,-1,1,0,0,r)}return a.drawImage(e,0,0,r,i),cleanupCanvasMemory(e),o}function compress(e,t,r=0){return new Promise((function(i,o){let a,s,f,l,c,u,h,d,A,g,p,m,w,v,b,y,E,F,_,B;function incProgress(e=5){if(t.signal&&t.signal.aborted)throw t.signal.reason;a+=e,t.onProgress(Math.min(a,100))}function setProgress(e){if(t.signal&&t.signal.aborted)throw t.signal.reason;a=Math.min(Math.max(e,a),100),t.onProgress(a)}return a=r,s=t.maxIteration||10,f=1024*t.maxSizeMB*1024,incProgress(),drawFileInCanvas(e,t).then(function(r){try{return[,l]=r,incProgress(),c=handleMaxWidthOrHeight(l,t),incProgress(),new Promise((function(r,i){var o;if(!(o=t.exifOrientation))return getExifOrientation(e).then(function(e){try{return o=e,$If_2.call(this)}catch(e){return i(e)}}.bind(this),i);function $If_2(){return r(o)}return $If_2.call(this)})).then(function(r){try{return u=r,incProgress(),isAutoOrientationInBrowser().then(function(r){try{return h=r?c:followExifOrientation(c,u),incProgress(),d=t.initialQuality||1,A=t.fileType||e.type,canvasToFile(h,A,e.name,e.lastModified,d).then(function(r){try{{if(g=r,incProgress(),p=g.size>f,m=g.size>e.size,!p&&!m)return setProgress(100),i(g);var a;function $Loop_3(){if(s--&&(b>f||b>w)){let t,r;return t=B?.95*_.width:_.width,r=B?.95*_.height:_.height,[E,F]=getNewCanvasAndCtx(t,r),F.drawImage(_,0,0,t,r),d*=\"image/png\"===A?.85:.95,canvasToFile(E,A,e.name,e.lastModified,d).then((function(e){try{return y=e,cleanupCanvasMemory(_),_=E,b=y.size,setProgress(Math.min(99,Math.floor((v-b)/(v-f)*100))),$Loop_3}catch(e){return o(e)}}),o)}return[1]}return w=e.size,v=g.size,b=v,_=h,B=!t.alwaysKeepResolution&&p,(a=function(e){for(;e;){if(e.then)return void e.then(a,o);try{if(e.pop){if(e.length)return e.pop()?$Loop_3_exit.call(this):e;e=$Loop_3}else e=e.call(this)}catch(e){return o(e)}}}.bind(this))($Loop_3);function $Loop_3_exit(){return cleanupCanvasMemory(_),cleanupCanvasMemory(E),cleanupCanvasMemory(c),cleanupCanvasMemory(h),cleanupCanvasMemory(l),setProgress(100),i(y)}}}catch(u){return o(u)}}.bind(this),o)}catch(e){return o(e)}}.bind(this),o)}catch(e){return o(e)}}.bind(this),o)}catch(e){return o(e)}}.bind(this),o)}))}const l=\"\\nlet scriptImported = false\\nself.addEventListener('message', async (e) => {\\n  const { file, id, imageCompressionLibUrl, options } = e.data\\n  options.onProgress = (progress) => self.postMessage({ progress, id })\\n  try {\\n    if (!scriptImported) {\\n      // console.log('[worker] importScripts', imageCompressionLibUrl)\\n      self.importScripts(imageCompressionLibUrl)\\n      scriptImported = true\\n    }\\n    // console.log('[worker] self', self)\\n    const compressedFile = await imageCompression(file, options)\\n    self.postMessage({ file: compressedFile, id })\\n  } catch (e) {\\n    // console.error('[worker] error', e)\\n    self.postMessage({ error: e.message + '\\\\n' + e.stack, id })\\n  }\\n})\\n\";let c;function compressOnWebWorker(e,t){return new Promise(((r,i)=>{c||(c=function createWorkerScriptURL(e){const t=[];return\"function\"==typeof e?t.push(`(${e})()`):t.push(e),URL.createObjectURL(new Blob(t))}(l));const o=new Worker(c);o.addEventListener(\"message\",(function handler(e){if(t.signal&&t.signal.aborted)o.terminate();else if(void 0===e.data.progress){if(e.data.error)return i(new Error(e.data.error)),void o.terminate();r(e.data.file),o.terminate()}else t.onProgress(e.data.progress)})),o.addEventListener(\"error\",i),t.signal&&t.signal.addEventListener(\"abort\",(()=>{i(t.signal.reason),o.terminate()})),o.postMessage({file:e,imageCompressionLibUrl:t.libURL,options:{...t,onProgress:void 0,signal:void 0}})}))}function imageCompression(e,t){return new Promise((function(r,i){let o,a,s,f,l,c;if(o={...t},s=0,({onProgress:f}=o),o.maxSizeMB=o.maxSizeMB||Number.POSITIVE_INFINITY,l=\"boolean\"!=typeof o.useWebWorker||o.useWebWorker,delete o.useWebWorker,o.onProgress=e=>{s=e,\"function\"==typeof f&&f(s)},!(e instanceof Blob||e instanceof CustomFile))return i(new Error(\"The file given is not an instance of Blob or File\"));if(!/^image/.test(e.type))return i(new Error(\"The file given is not an image\"));if(c=\"undefined\"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,!l||\"function\"!=typeof Worker||c)return compress(e,o).then(function(e){try{return a=e,$If_4.call(this)}catch(e){return i(e)}}.bind(this),i);var u=function(){try{return $If_4.call(this)}catch(e){return i(e)}}.bind(this),$Try_1_Catch=function(t){try{return compress(e,o).then((function(e){try{return a=e,u()}catch(e){return i(e)}}),i)}catch(e){return i(e)}};try{return o.libURL=o.libURL||\"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js\",compressOnWebWorker(e,o).then((function(e){try{return a=e,u()}catch(e){return $Try_1_Catch()}}),$Try_1_Catch)}catch(e){$Try_1_Catch()}function $If_4(){try{a.name=e.name,a.lastModified=e.lastModified}catch(e){}try{o.preserveExif&&\"image/jpeg\"===e.type&&(!o.fileType||o.fileType&&o.fileType===e.type)&&(a=copyExifWithoutOrientation(e,a))}catch(e){}return r(a)}}))}imageCompression.getDataUrlFromFile=getDataUrlFromFile,imageCompression.getFilefromDataUrl=getFilefromDataUrl,imageCompression.loadImage=loadImage,imageCompression.drawImageInCanvas=drawImageInCanvas,imageCompression.drawFileInCanvas=drawFileInCanvas,imageCompression.canvasToFile=canvasToFile,imageCompression.getExifOrientation=getExifOrientation,imageCompression.handleMaxWidthOrHeight=handleMaxWidthOrHeight,imageCompression.followExifOrientation=followExifOrientation,imageCompression.cleanupCanvasMemory=cleanupCanvasMemory,imageCompression.isAutoOrientationInBrowser=isAutoOrientationInBrowser,imageCompression.approximateBelowMaximumCanvasSizeOfBrowser=approximateBelowMaximumCanvasSizeOfBrowser,imageCompression.copyExifWithoutOrientation=copyExifWithoutOrientation,imageCompression.getBrowserName=getBrowserName,imageCompression.version=\"2.0.2\";export{imageCompression as default};\n//# sourceMappingURL=browser-image-compression.mjs.map\n","/**\n * Image processing utilities\n */\n\nimport imageCompression from 'browser-image-compression';\n\n/**\n * Quality presets\n * Optimized for A7 cards (74x105mm) with handwritten notes\n */\nconst QUALITY_PRESETS = {\n  low: {\n    maxWidthOrHeight: 600,\n    quality: 0.75,\n    useWebWorker: true\n  },\n  normal: {\n    maxWidthOrHeight: 900,\n    quality: 0.85,\n    useWebWorker: true\n  },\n  high: {\n    maxWidthOrHeight: 1200,\n    quality: 0.92,\n    useWebWorker: true\n  }\n};\n\n/**\n * Compress image with quality preset\n */\nexport async function compressImage(file, quality = 'normal') {\n  try {\n    const options = QUALITY_PRESETS[quality] || QUALITY_PRESETS.normal;\n    const compressed = await imageCompression(file, options);\n\n    console.log(`Image compressed: ${(file.size / 1024).toFixed(1)}KB  ${(compressed.size / 1024).toFixed(1)}KB (${quality})`);\n\n    return compressed;\n  } catch (error) {\n    console.error('Image compression failed:', error);\n    return file; // Return original on error\n  }\n}\n\n/**\n * Convert File/Blob to base64 for storage\n */\nexport async function fileToBase64(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = reject;\n    reader.readAsDataURL(file);\n  });\n}\n\n/**\n * Convert base64 to Blob\n */\nexport function base64ToBlob(base64) {\n  const parts = base64.split(';base64,');\n  const contentType = parts[0].split(':')[1];\n  const raw = window.atob(parts[1]);\n  const rawLength = raw.length;\n  const uInt8Array = new Uint8Array(rawLength);\n\n  for (let i = 0; i < rawLength; ++i) {\n    uInt8Array[i] = raw.charCodeAt(i);\n  }\n\n  return new Blob([uInt8Array], { type: contentType });\n}\n\n/**\n * Get image dimensions\n */\nexport async function getImageDimensions(file) {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    const url = URL.createObjectURL(file);\n\n    img.onload = () => {\n      URL.revokeObjectURL(url);\n      resolve({\n        width: img.naturalWidth,\n        height: img.naturalHeight\n      });\n    };\n\n    img.onerror = () => {\n      URL.revokeObjectURL(url);\n      reject(new Error('Failed to load image'));\n    };\n\n    img.src = url;\n  });\n}\n\n/**\n * Extract EXIF metadata from image\n * Note: browser-image-compression preserves EXIF data\n */\nexport async function extractExifData(file) {\n  // For now, just extract basic file metadata\n  // Full EXIF extraction would require exif-js library\n  const dimensions = await getImageDimensions(file);\n\n  return {\n    fileName: file.name,\n    fileSize: file.size,\n    fileType: file.type,\n    lastModified: file.lastModified,\n    width: dimensions.width,\n    height: dimensions.height,\n    // Future: camera model, GPS, date taken, etc.\n  };\n}\n\n/**\n * Process uploaded image\n * Returns processed image data ready for storage\n */\nexport async function processImage(file, quality = 'normal') {\n  try {\n    // If quality is 'original', skip compression\n    const compressed = quality === 'original' ? file : await compressImage(file, quality);\n\n    // Extract metadata\n    const metadata = await extractExifData(file);\n\n    // Convert to base64 for IndexedDB storage\n    const base64 = await fileToBase64(compressed);\n\n    return {\n      base64,\n      metadata: {\n        ...metadata,\n        quality,\n        originalSize: file.size,\n        compressedSize: compressed.size,\n        compressionRatio: (compressed.size / file.size).toFixed(2)\n      }\n    };\n  } catch (error) {\n    console.error('Image processing failed:', error);\n    throw error;\n  }\n}\n","// Gemini AI Integration for Spatial View\n\nimport { updateCard, getAllCards } from './storage.js';\nimport { reloadCanvas } from './canvas.js';\n\n/**\n * Prompts the user for their Google AI API key and saves it to localStorage.\n * @returns {Promise<string|null>} The API key, or null if the user cancels.\n */\nfunction showGoogleAIAPIKeyDialog() {\n    return new Promise((resolve) => {\n        const overlay = document.createElement('div');\n        overlay.style.cssText = `\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100vw;\n            height: 100vh;\n            background: rgba(0, 0, 0, 0.7);\n            z-index: 10000;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        `;\n\n        const dialog = document.createElement('div');\n        dialog.style.cssText = `\n            background: var(--bg-primary);\n            color: var(--text-primary);\n            border-radius: 12px;\n            padding: 30px;\n            width: 90%;\n            max-width: 500px;\n            box-shadow: 0 4px 20px rgba(0,0,0,0.3);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n        `;\n\n        dialog.innerHTML = `\n            <h2 style=\"margin: 0 0 20px 0; color: var(--text-primary);\"> Gemini AI Assistent</h2>\n            <p style=\"margin: 0 0 20px 0; color: var(--text-secondary); line-height: 1.6;\">\n                Fr att anvnda bildigenknning med Gemini behver du en Google AI API-nyckel.\n            </p>\n            <p style=\"margin: 0 0 15px 0; color: var(--text-secondary); line-height: 1.6;\">\n                <strong>S hr skaffar du en nyckel:</strong><br>\n                1. G till <a href=\"https://makersuite.google.com/app/apikey\" target=\"_blank\" style=\"color: var(--accent-color);\">Google AI Studio</a><br>\n                2. Skapa ett konto eller logga in<br>\n                3. Klicka p \"Create API key\"<br>\n                4. Klistra in nyckeln hr nedan\n            </p>\n            <p style=\"margin: 0 0 15px 0; color: #e67e22; font-size: 13px;\">\n                 Din API-nyckel sparas endast lokalt i din webblsare.\n            </p>\n            <input type=\"password\" id=\"googleAiApiKeyInput\" placeholder=\"Din Google AI API-nyckel...\" style=\"\n                width: 100%;\n                padding: 12px;\n                border: 1px solid var(--border-color);\n                border-radius: 6px;\n                font-family: monospace;\n                font-size: 14px;\n                box-sizing: border-box;\n                margin-bottom: 20px;\n                background: var(--bg-secondary);\n                color: var(--text-primary);\n            \">\n            <div style=\"display: flex; gap: 10px; justify-content: flex-end;\">\n                <button id=\"cancelApiKey\" style=\"\n                    padding: 10px 20px;\n                    border: 1px solid var(--border-color);\n                    background: var(--bg-secondary);\n                    color: var(--text-primary);\n                    border-radius: 6px;\n                    cursor: pointer;\n                    font-size: 14px;\n                \">Avbryt</button>\n                <button id=\"saveApiKey\" style=\"\n                    padding: 10px 20px;\n                    border: none;\n                    background: var(--accent-color);\n                    color: white;\n                    border-radius: 6px;\n                    cursor: pointer;\n                    font-size: 14px;\n                \">Spara och fortstt</button>\n            </div>\n        `;\n\n        overlay.appendChild(dialog);\n        document.body.appendChild(overlay);\n\n        const input = document.getElementById('googleAiApiKeyInput');\n        input.focus();\n\n        const closeDialog = (key = null) => {\n            overlay.remove();\n            resolve(key);\n        };\n\n        document.getElementById('cancelApiKey').onclick = () => closeDialog();\n\n        document.getElementById('saveApiKey').onclick = () => {\n            const apiKey = input.value.trim();\n            if (apiKey) {\n                localStorage.setItem('googleAiApiKey', apiKey);\n                closeDialog(apiKey);\n            } else {\n                alert('Vnligen ange en giltig API-nyckel.');\n            }\n        };\n\n        input.addEventListener('keydown', (e) => {\n            if (e.key === 'Enter') {\n                document.getElementById('saveApiKey').click();\n            }\n        });\n\n        overlay.addEventListener('keydown', (e) => {\n            if (e.key === 'Escape') {\n                closeDialog();\n            }\n        });\n    });\n}\n\n/**\n * Retrieves the Google AI API key from localStorage or prompts the user for it.\n * @returns {Promise<string|null>} The API key or null.\n */\nasync function getGoogleAIAPIKey() {\n    let apiKey = localStorage.getItem('googleAiApiKey');\n    if (!apiKey) {\n        apiKey = await showGoogleAIAPIKeyDialog();\n    }\n    return apiKey;\n}\n\n/**\n * Calls the Gemini API with the provided image data and a complex prompt.\n * @param {string} apiKey - The Google AI API key.\n * @param {string} imageData - The base64 encoded image data.\n * @returns {Promise<Object>} The JSON response from the API.\n */\nasync function callGeminiAPI(apiKey, imageData) {\n    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${apiKey}`;\n\n    const payload = {\n        contents: [\n            {\n                parts: [\n                    {\n                        text: `Transkribera texten frn bilden exakt som den r skriven och extrahera metadata.\n\nOM BILDEN INTE HAR NGON TEXT: Beskriv kort vad bilden visar (1-2 meningar).\n\nVIKTIGT: Svara ENDAST med en JSON-struktur enligt detta format:\n\n{\n  \"text\": \"[transkriberad text hr, eller tom strng om ingen text]\",\n  \"description\": \"[kort bildbeskrivning om ingen text finns, annars null]\",\n  \"metadata\": {\n    \"extractedDate\": \"YYYY-MM-DD eller null\",\n    \"extractedTime\": \"HH:MM eller null\",\n    \"extractedDateTime\": \"YYYY-MM-DDTHH:MM eller null (kombinera datum+tid)\",\n    \"extractedPeople\": [\"person1\", \"person2\"] eller [],\n    \"extractedPlaces\": [\"plats1\", \"plats2\"] eller []\n  },\n  \"hashtags\": [\"tag1\", \"tag2\", \"tag3\"]\n}\n\nHASHTAG-REGLER:\n1. Datumtaggar: Om datum hittas, skapa #YYMMDD (ex: #250819 fr 2025-08-19)\n2. Veckotaggar: Om datum knt, skapa #YYvVV (ex: #25v44 fr vecka 44, 2025)\n3. Kategoritaggar: #mte #anteckning #todo #faktura #kontrakt #brev #kvitto #foto etc\n4. Namntaggar: Personer som nmns, normaliserade (ex: #smith #jones)\n5. Platstaggar: Platser som nmns (ex: #stockholm #kontoret)\n\nMETADATA-INSTRUKTIONER:\n- extractedDate: Extrahera datum frn SYNLIG text i bilden (YYYY-MM-DD format)\n- extractedTime: Extrahera tid frn SYNLIG text (HH:MM format)\n- extractedDateTime: Om bde datum OCH tid finns, kombinera till ISO-format (YYYY-MM-DDTHH:MM)\n- extractedPeople: Lista alla personnamn som nmns i texten\n- extractedPlaces: Lista alla platser/adresser som nmns\n\nBESKRIVNING-INSTRUKTIONER:\n- Om bilden INTE har ngon lsbar text: Beskriv kort vad som visas (ex: \"En solnedgng ver havet\", \"En katt p en soffa\")\n- Om bilden HAR text: Stt description till null\n- Hll beskrivningen kort och koncis (max 2 meningar)\n\nOBS: Vi kommer senare ven lgga till EXIF-metadata frn filen (GPS, filskapare, originaldatum etc), s hll strukturen ren.`\n                    },\n                    {\n                        inline_data: {\n                            mime_type: \"image/jpeg\", // Assuming JPEG, adjust if needed\n                            data: imageData.split(',')[1]\n                        }\n                    }\n                ]\n            }\n        ]\n    };\n\n    const response = await fetch(url, {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload)\n    });\n\n    if (!response.ok) {\n        const errorData = await response.json();\n        throw new Error(errorData.error.message || `API request failed with status ${response.status}`);\n    }\n\n    return response.json();\n}\n\n/**\n * Main function to read an image card with Gemini, process the result, and update the card.\n * @param {number} cardId - The ID of the card to process.\n */\nexport async function readImageWithGemini(cardId) {\n    const apiKey = await getGoogleAIAPIKey();\n    if (!apiKey) {\n        console.log('Gemini OCR cancelled: No API key provided.');\n        return;\n    }\n\n    const allCards = await getAllCards();\n    const card = allCards.find(c => c.id === cardId);\n\n    if (!card || !card.image || !card.image.base64) {\n        alert('Ingen bilddata hittades fr detta kort.');\n        return;\n    }\n\n    // Simple loading indicator\n    const statusIndicator = document.createElement('div');\n    statusIndicator.textContent = ' Lser bild med Gemini...';\n    statusIndicator.style.cssText = `\n        position: fixed;\n        bottom: 20px;\n        left: 50%;\n        transform: translateX(-50%);\n        background: #333;\n        color: white;\n        padding: 12px 24px;\n        border-radius: 8px;\n        z-index: 10001;\n        font-family: sans-serif;\n    `;\n    document.body.appendChild(statusIndicator);\n\n    try {\n        const response = await callGeminiAPI(apiKey, card.image.base64);\n\n        if (!response || !response.candidates || !response.candidates[0].content || !response.candidates[0].content.parts) {\n            throw new Error('Invalid response structure from Gemini API.');\n        }\n\n        const rawText = response.candidates[0].content.parts[0].text;\n        \n        let parsedData;\n        try {\n            const jsonMatch = rawText.match(/```json\\s*([\\s\\S]*?)\\s*```/) || rawText.match(/```\\s*([\\s\\S]*?)\\s*```/);\n            const jsonText = jsonMatch ? jsonMatch[1] : rawText;\n            parsedData = JSON.parse(jsonText.trim());\n        } catch (parseError) {\n            console.warn('Failed to parse JSON, falling back to raw text:', parseError);\n            parsedData = { text: rawText, hashtags: [] };\n        }\n\n        const hashtagText = (parsedData.hashtags || []).map(tag => tag.startsWith('#') ? tag : '#' + tag).join(' ');\n        const mainContent = parsedData.text || parsedData.description || '';\n        const newBackText = (mainContent + '\\n\\n' + hashtagText).trim();\n\n        const existingTags = card.tags || [];\n        const newTags = (parsedData.hashtags || []).map(tag => tag.replace('#', ''));\n        const mergedTags = [...new Set([...existingTags, ...newTags])];\n\n        const updates = {\n            backText: newBackText,\n            tags: mergedTags,\n            geminiMetadata: parsedData.metadata || {} // Store metadata\n        };\n\n        await updateCard(cardId, updates);\n        await reloadCanvas();\n\n        statusIndicator.textContent = ' Bilden r analyserad!';\n    } catch (error) {\n        console.error('Error reading image with Gemini:', error);\n        statusIndicator.textContent = ` Fel: ${error.message}`;\n    } finally {\n        setTimeout(() => {\n            statusIndicator.remove();\n        }, 3000);\n    }\n}","/**\r\n * Card arrangement utilities\r\n * Adapted from spatial-notes-v2 for Konva.js\r\n */\r\n\r\n/**\r\n * Arrange cards in vertical column\r\n * Based on v2's arrangeSelectedInColumn\r\n */\r\nexport function arrangeVertical(cards, centerPos) {\r\n  const gap = 60; // 20% of 300px card width\r\n  const positions = [];\r\n\r\n  // Calculate total height needed\r\n  let totalHeight = 0;\r\n  cards.forEach((card, index) => {\r\n    const height = card.height || 150;\r\n    totalHeight += height;\r\n    if (index < cards.length - 1) totalHeight += gap;\r\n  });\r\n\r\n  // Start from top, centered vertically around centerPos\r\n  let currentY = centerPos.y - totalHeight / 2;\r\n\r\n  cards.forEach(card => {\r\n    const height = card.height || 150;\r\n    const width = card.width || 200;\r\n\r\n    positions.push({\r\n      id: card.id,\r\n      x: centerPos.x - width / 2, // Center horizontally\r\n      y: currentY\r\n    });\r\n\r\n    currentY += height + gap;\r\n  });\r\n\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Arrange cards in horizontal row\r\n * Based on v2's arrangeSelectedInRow\r\n */\r\nexport function arrangeHorizontal(cards, centerPos) {\r\n  const gap = 60; // 20% spacing\r\n  const positions = [];\r\n\r\n  // Calculate total width needed\r\n  let totalWidth = 0;\r\n  cards.forEach((card, index) => {\r\n    const width = card.width || 200;\r\n    totalWidth += width;\r\n    if (index < cards.length - 1) totalWidth += gap;\r\n  });\r\n\r\n  // Start from left, centered horizontally around centerPos\r\n  let currentX = centerPos.x - totalWidth / 2;\r\n\r\n  cards.forEach(card => {\r\n    const width = card.width || 200;\r\n\r\n    positions.push({\r\n      id: card.id,\r\n      x: currentX,\r\n      y: centerPos.y // Top-aligned\r\n    });\r\n\r\n    currentX += width + gap;\r\n  });\r\n\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Arrange cards in grid\r\n * Based on v2's arrangeSelectedInGrid\r\n */\r\nexport function arrangeGrid(cards, centerPos) {\r\n  const spacing = 180; // Both horizontal and vertical\r\n  const positions = [];\r\n\r\n  // Calculate grid dimensions\r\n  const cols = Math.ceil(Math.sqrt(cards.length));\r\n  const rows = Math.ceil(cards.length / cols);\r\n\r\n  const gridWidth = cols * spacing;\r\n  const gridHeight = rows * spacing;\r\n\r\n  // Start position (top-left of grid, centered around centerPos)\r\n  const startX = centerPos.x - gridWidth / 2;\r\n  const startY = centerPos.y - gridHeight / 2;\r\n\r\n  cards.forEach((card, index) => {\r\n    const col = index % cols;\r\n    const row = Math.floor(index / cols);\r\n\r\n    positions.push({\r\n      id: card.id,\r\n      x: startX + col * spacing,\r\n      y: startY + row * spacing\r\n    });\r\n  });\r\n\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Arrange cards in cluster (circle)\r\n * Based on v2's clusterSelectedCards\r\n */\r\nexport function arrangeCluster(cards, centerPos) {\r\n  const radius = 50;\r\n  const positions = [];\r\n\r\n  cards.forEach((card, index) => {\r\n    const angle = (index / cards.length) * 2 * Math.PI;\r\n    const x = centerPos.x + Math.cos(angle) * radius;\r\n    const y = centerPos.y + Math.sin(angle) * radius;\r\n\r\n    positions.push({\r\n      id: card.id,\r\n      x: x,\r\n      y: y\r\n    });\r\n  });\r\n\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Arrange cards in vertical columns (grid variant)\r\n * Max 5 columns, 20px gaps both ways\r\n * All cards use standard width for aligned columns\r\n */\r\nexport function arrangeGridVertical(cards, centerPos) {\r\n  const maxCols = 5;\r\n  const gap = 20;\r\n  const standardWidth = 200; // Standard width for all cards\r\n  const positions = [];\r\n\r\n  const cols = Math.min(maxCols, Math.ceil(Math.sqrt(cards.length)));\r\n  const cardsPerCol = Math.ceil(cards.length / cols);\r\n\r\n  // Calculate total grid width (all columns same width)\r\n  const totalWidth = cols * standardWidth + (cols - 1) * gap;\r\n\r\n  // Start position\r\n  let currentX = centerPos.x - totalWidth / 2;\r\n  const startY = centerPos.y;\r\n\r\n  let cardIndex = 0;\r\n  for (let col = 0; col < cols && cardIndex < cards.length; col++) {\r\n    let currentY = startY;\r\n\r\n    for (let row = 0; row < cardsPerCol && cardIndex < cards.length; row++) {\r\n      const card = cards[cardIndex];\r\n      const height = card.height || 150;\r\n\r\n      positions.push({\r\n        id: card.id,\r\n        x: currentX,\r\n        y: currentY\r\n      });\r\n\r\n      currentY += height + gap;\r\n      cardIndex++;\r\n    }\r\n\r\n    currentX += standardWidth + gap;\r\n  }\r\n\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Arrange cards in packed rows\r\n * Max 5 per row, top-aligned within row, tight vertical packing\r\n * All cards use standard width for aligned columns\r\n */\r\nexport function arrangeGridHorizontal(cards, centerPos) {\r\n  const maxCols = 5;\r\n  const gap = 20;\r\n  const standardWidth = 200; // Standard width for all cards\r\n  const positions = [];\r\n\r\n  // Group cards into rows\r\n  const rows = [];\r\n  for (let i = 0; i < cards.length; i += maxCols) {\r\n    rows.push(cards.slice(i, i + maxCols));\r\n  }\r\n\r\n  // Calculate row heights (tallest card in each row)\r\n  const rowHeights = rows.map(row => {\r\n    return Math.max(...row.map(card => card.height || 150));\r\n  });\r\n\r\n  // Calculate total grid height\r\n  const totalHeight = rowHeights.reduce((sum, h) => sum + h, 0) + (rows.length - 1) * gap;\r\n\r\n  let currentY = centerPos.y - totalHeight / 2;\r\n\r\n  rows.forEach((row, rowIndex) => {\r\n    // Calculate row width (all cards same width)\r\n    const rowWidth = row.length * standardWidth + (row.length - 1) * gap;\r\n    let currentX = centerPos.x - rowWidth / 2;\r\n\r\n    row.forEach(card => {\r\n      positions.push({\r\n        id: card.id,\r\n        x: currentX,\r\n        y: currentY // Top-aligned within row\r\n      });\r\n\r\n      currentX += standardWidth + gap;\r\n    });\r\n\r\n    // Next row starts at bottom of tallest card in current row + gap\r\n    currentY += rowHeights[rowIndex] + gap;\r\n  });\r\n\r\n  return positions;\r\n}\r\n\r\n/**\r\n * Arrange cards in overlapping grid (Kanban-style, for showing titles)\r\n * Max 5 per row, cards overlap vertically to show ~120px of each\r\n * Rows start at left edge\r\n * All cards use standard width for aligned columns\r\n */\r\nexport function arrangeGridTopAligned(cards, centerPos) {\r\n  const maxCols = 5;\r\n  const colSpacing = 15; // Tight horizontal spacing\r\n  const rowSpacing = 120; // Vertical overlap - show 120px of each card\r\n  const standardWidth = 200; // Standard width for all cards\r\n  const positions = [];\r\n\r\n  // Group into rows\r\n  const rows = [];\r\n  for (let i = 0; i < cards.length; i += maxCols) {\r\n    rows.push(cards.slice(i, i + maxCols));\r\n  }\r\n\r\n  const totalHeight = rows.length * rowSpacing;\r\n  let currentY = centerPos.y - totalHeight / 2;\r\n\r\n  rows.forEach(row => {\r\n    // All rows start at the same X position (left-aligned)\r\n    let currentX = centerPos.x;\r\n\r\n    row.forEach(card => {\r\n      positions.push({\r\n        id: card.id,\r\n        x: currentX,\r\n        y: currentY\r\n      });\r\n\r\n      currentX += standardWidth + colSpacing;\r\n    });\r\n\r\n    currentY += rowSpacing; // Overlapping rows\r\n  });\r\n\r\n  return positions;\r\n}\r\n","/**\r\n * Canvas module using Konva.js\r\n *\r\n * FILE ORGANIZATION:\r\n * This file is organized into clear sections for easier navigation.\r\n * Use Ctrl+F to jump to section markers like \"// === RENDERING ===\"\r\n *\r\n * SECTIONS:\r\n * 1. Global State & Configuration\r\n * 2. Rendering (cards, colors)\r\n * 3. Card Creation & Editing (inline editor, bulk editor, touch menus)\r\n * 4. Card Operations (flip, delete)\r\n * 5. Canvas Management (reload, undo/redo)\r\n * 6. Clipboard (copy/paste/duplicate)\r\n * 7. Selection & Interaction (events, drag, pan, zoom)\r\n * 8. Public API (exports)\r\n * 9. UI Dialogs (command palette, quality dialog, etc)\r\n * 10. Search (boolean search with wildcards, proximity, etc)\r\n * 11. Context Menu & Card Actions (lock, pin)\r\n * 12. UI Buttons & Theme\r\n * 13. Arrangements & Keyboard Handlers\r\n *\r\n * NOTE: This file is large (3700+ lines) due to tight coupling with global state.\r\n * Future refactoring: Consider CanvasManager class or dependency injection.\r\n */\r\n\r\nimport Konva from 'konva';\r\nimport { getAllCards, updateCard, createCard, deleteCard, getCard } from './storage.js';\r\nimport { processImage } from '../utils/image-processing.js';\r\nimport { readImageWithGemini } from './gemini.js';\r\nimport {\r\n  arrangeVertical,\r\n  arrangeHorizontal,\r\n  arrangeGrid,\r\n  arrangeCluster,\r\n  arrangeGridVertical,\r\n  arrangeGridHorizontal,\r\n  arrangeGridTopAligned\r\n} from './arrangement.js';\r\n\r\n// ============================================================================\r\n// SECTION 1: GLOBAL STATE & CONFIGURATION\r\n// ============================================================================\r\n\r\nlet stage = null;\r\nlet layer = null;\r\nlet isPanning = false;\r\nlet cardGroups = new Map(); // Map cardId -> Konva.Group\r\n\r\n// Selection rectangle\r\nlet selectionRectangle = null;\r\nlet selectionStartPos = null;\r\nlet isSelecting = false;\r\n\r\n// Undo/redo stacks\r\nlet undoStack = [];\r\nlet redoStack = [];\r\nconst MAX_UNDO_STACK = 50;\r\n\r\n// Clipboard for copy/paste\r\nlet clipboard = [];\r\n\r\n// ============================================================================\r\n// SECTION 2: RENDERING (Cards, Colors, Visual Elements)\r\n// ============================================================================\r\n\r\n/**\r\n * Get card color from cardColor property\r\n */\r\nfunction getCardColor(cardColor) {\r\n  const colorMap = {\r\n    // Format: card-color-X\r\n    'card-color-1': '#d4f2d4', // Grn\r\n    'card-color-2': '#ffe4b3', // Orange\r\n    'card-color-3': '#ffc1cc', // Rd\r\n    'card-color-4': '#fff7b3', // Gul\r\n    'card-color-5': '#f3e5f5', // Lila\r\n    'card-color-6': '#c7e7ff', // Bl\r\n    'card-color-7': '#e0e0e0', // Gr\r\n    'card-color-8': '#ffffff', // Vit\r\n\r\n    // Format: color names (fr baktkompatibilitet och import)\r\n    'green': '#d4f2d4',\r\n    'orange': '#ffe4b3',\r\n    'pink': '#ffc1cc',\r\n    'red': '#ffc1cc',\r\n    'yellow': '#fff7b3',\r\n    'purple': '#f3e5f5',\r\n    'blue': '#c7e7ff',\r\n    'gray': '#e0e0e0',\r\n    'grey': '#e0e0e0',\r\n    'white': '#ffffff'\r\n  };\r\n\r\n  return colorMap[cardColor] || '#ffffff'; // Default white\r\n}\r\n\r\n/**\r\n * Initialize Konva canvas\r\n */\r\nexport async function initCanvas() {\r\n  const container = document.getElementById('canvas-container');\r\n  \r\n  if (!container) {\r\n    console.error('Canvas container not found');\r\n    return;\r\n  }\r\n  \r\n  // Create stage\r\n  stage = new Konva.Stage({\r\n    container: 'canvas-container',\r\n    width: container.clientWidth,\r\n    height: container.clientHeight,\r\n    draggable: false\r\n  });\r\n  \r\n  // Create main layer\r\n  layer = new Konva.Layer();\r\n  stage.add(layer);\r\n\r\n  // Create selection rectangle (hidden by default)\r\n  selectionRectangle = new Konva.Rect({\r\n    fill: 'rgba(33, 150, 243, 0.1)',\r\n    stroke: '#2196F3',\r\n    strokeWidth: 1,\r\n    visible: false\r\n  });\r\n  layer.add(selectionRectangle);\r\n\r\n  // Load cards from storage\r\n  await loadCards();\r\n\r\n  // Setup event listeners\r\n  setupCanvasEvents();\r\n\r\n  // Setup image drag-and-drop\r\n  setupImageDragDrop();\r\n\r\n  // Create floating buttons\r\n  createFitAllButton();\r\n  createCommandPaletteButton();\r\n  createAddButton();\r\n\r\n  console.log('Konva canvas initialized');\r\n}\r\n\r\n/**\r\n * Load cards from storage and render\r\n */\r\nasync function loadCards() {\r\n  const cards = await getAllCards();\r\n  \r\n  for (const card of cards) {\r\n    renderCard(card);\r\n  }\r\n  \r\n  layer.batchDraw();\r\n}\r\n\r\n/**\r\n * Render a single card on canvas\r\n */\r\nfunction renderCard(cardData) {\r\n  const group = new Konva.Group({\r\n    x: cardData.position?.x || 100,\r\n    y: cardData.position?.y || 100,\r\n    draggable: true\r\n  });\r\n\r\n  if (cardData.image) {\r\n    // Image card\r\n    renderImageCard(group, cardData);\r\n  } else {\r\n    // Text card\r\n    renderTextCard(group, cardData);\r\n  }\r\n\r\n  // Store card ID on group\r\n  group.setAttr('cardId', cardData.id);\r\n\r\n  // Set locked state\r\n  if (cardData.locked) {\r\n    group.draggable(false);\r\n    group.setAttr('locked', true);\r\n  }\r\n\r\n  // Click to select (for deletion)\r\n  group.on('click', function() {\r\n    const isSelected = this.hasName('selected');\r\n    const background = this.findOne('Rect');\r\n    const isEink = document.body.classList.contains('eink-theme');\r\n    const isDark = document.body.classList.contains('dark-theme');\r\n\r\n    if (isSelected) {\r\n      this.removeName('selected');\r\n      if (background) {\r\n        if (isEink) {\r\n          background.stroke('#000000');\r\n          background.strokeWidth(2);\r\n        } else if (isDark) {\r\n          background.stroke('#4a5568');\r\n          background.strokeWidth(1);\r\n        } else {\r\n          background.stroke('#e0e0e0');\r\n          background.strokeWidth(1);\r\n        }\r\n      }\r\n    } else {\r\n      this.addName('selected');\r\n      if (background) {\r\n        if (isEink) {\r\n          background.stroke('#000000');\r\n          background.strokeWidth(4);\r\n        } else {\r\n          background.stroke('#2196F3');\r\n          background.strokeWidth(3);\r\n        }\r\n      }\r\n    }\r\n\r\n    layer.batchDraw();\r\n  });\r\n\r\n  // Right-click context menu\r\n  group.on('contextmenu', function(e) {\r\n    e.evt.preventDefault();\r\n    showContextMenu(e.evt.clientX, e.evt.clientY, cardData.id, this);\r\n  });\r\n\r\n  // Touch handlers\r\n  let touchTimer = null;\r\n  let touchStartPos = null;\r\n  let hasMoved = false;\r\n\r\n  group.on('touchstart', function(e) {\r\n    const pos = this.position();\r\n    touchStartPos = { x: pos.x, y: pos.y };\r\n    hasMoved = false;\r\n\r\n    // Long press timer\r\n    touchTimer = setTimeout(async () => {\r\n      if (!hasMoved) {\r\n        // Long press detected\r\n        const selectedGroups = layer.find('.selected');\r\n\r\n        if (selectedGroups.length > 1 && this.hasName('selected')) {\r\n          // Multiple cards selected: show bulk menu\r\n          await showTouchBulkMenu(e.evt.clientX || e.evt.touches[0].clientX,\r\n                                  e.evt.clientY || e.evt.touches[0].clientY);\r\n        } else {\r\n          // Single card: open editor\r\n          if (cardData.image && cardData.flipped) {\r\n            createInlineEditor(cardData.id, this, cardData.backText || '', true);\r\n          } else if (cardData.image) {\r\n            // For image cards (front side), flip them\r\n            await flipCard(cardData.id);\r\n          } else {\r\n            // For text cards, open editor\r\n            createInlineEditor(cardData.id, this, cardData.text || '', false);\r\n          }\r\n        }\r\n        touchTimer = null;\r\n      }\r\n    }, 600); // 600ms long press\r\n  });\r\n\r\n  group.on('touchmove', function() {\r\n    const currentPos = this.position();\r\n    const moved = Math.abs(currentPos.x - touchStartPos.x) > 5 ||\r\n                  Math.abs(currentPos.y - touchStartPos.y) > 5;\r\n    if (moved) {\r\n      hasMoved = true;\r\n    }\r\n  });\r\n\r\n  group.on('touchend', function() {\r\n    if (touchTimer) {\r\n      clearTimeout(touchTimer);\r\n      touchTimer = null;\r\n\r\n      // If touch ended before long press timer and card hasn't moved much, treat as tap to select\r\n      if (!hasMoved) {\r\n        const isSelected = this.hasName('selected');\r\n        const background = this.findOne('Rect');\r\n        const isEink = document.body.classList.contains('eink-theme');\r\n        const isDark = document.body.classList.contains('dark-theme');\r\n\r\n        if (isSelected) {\r\n          this.removeName('selected');\r\n          if (background) {\r\n            if (isEink) {\r\n              background.stroke('#000000');\r\n              background.strokeWidth(2);\r\n            } else if (isDark) {\r\n              background.stroke('#4a5568');\r\n              background.strokeWidth(1);\r\n            } else {\r\n              background.stroke('#e0e0e0');\r\n              background.strokeWidth(1);\r\n            }\r\n          }\r\n        } else {\r\n          this.addName('selected');\r\n          if (background) {\r\n            if (isEink) {\r\n              background.stroke('#000000');\r\n              background.strokeWidth(4);\r\n            } else {\r\n              background.stroke('#2196F3');\r\n              background.strokeWidth(3);\r\n            }\r\n          }\r\n        }\r\n\r\n        layer.batchDraw();\r\n      }\r\n    }\r\n  });\r\n\r\n  group.on('touchcancel', function() {\r\n    if (touchTimer) {\r\n      clearTimeout(touchTimer);\r\n      touchTimer = null;\r\n    }\r\n  });\r\n\r\n  group.on('dragstart', function() {\r\n    hasMoved = true;\r\n    if (touchTimer) {\r\n      clearTimeout(touchTimer);\r\n      touchTimer = null;\r\n    }\r\n  });\r\n\r\n  // Group drag - move all selected cards together\r\n  let dragStartPositions = null;\r\n\r\n  group.on('dragstart', function() {\r\n    const isSelected = this.hasName('selected');\r\n\r\n    if (isSelected) {\r\n      // Save positions of all selected cards\r\n      dragStartPositions = new Map();\r\n      const selectedNodes = layer.find('.selected');\r\n\r\n      selectedNodes.forEach(node => {\r\n        if (node !== this && node.getAttr('cardId')) {\r\n          dragStartPositions.set(node, {\r\n            x: node.x(),\r\n            y: node.y()\r\n          });\r\n        }\r\n      });\r\n    }\r\n  });\r\n\r\n  group.on('dragmove', function() {\r\n    if (dragStartPositions && dragStartPositions.size > 0) {\r\n      // Calculate delta from this card's movement\r\n      const currentPos = this.position();\r\n      const startPos = { x: this.getAttr('startX'), y: this.getAttr('startY') };\r\n\r\n      // Store start position on first move\r\n      if (startPos.x === undefined) {\r\n        this.setAttr('startX', currentPos.x);\r\n        this.setAttr('startY', currentPos.y);\r\n        return;\r\n      }\r\n\r\n      const delta = {\r\n        x: currentPos.x - startPos.x,\r\n        y: currentPos.y - startPos.y\r\n      };\r\n\r\n      // Move all other selected cards by the same delta\r\n      dragStartPositions.forEach((originalPos, node) => {\r\n        node.position({\r\n          x: originalPos.x + delta.x,\r\n          y: originalPos.y + delta.y\r\n        });\r\n      });\r\n\r\n      layer.batchDraw();\r\n    }\r\n  });\r\n\r\n  group.on('dragend', async function() {\r\n    if (dragStartPositions && dragStartPositions.size > 0) {\r\n      // Update all moved cards in database and add to undo stack\r\n      for (const [node, originalPos] of dragStartPositions) {\r\n        const cardId = node.getAttr('cardId');\r\n        if (cardId) {\r\n          const newPosition = { x: node.x(), y: node.y() };\r\n\r\n          // Add to undo stack\r\n          pushUndo({\r\n            type: 'update',\r\n            cardId: cardId,\r\n            oldData: { position: originalPos },\r\n            newData: { position: newPosition }\r\n          });\r\n\r\n          await updateCard(cardId, { position: newPosition });\r\n        }\r\n      }\r\n\r\n      dragStartPositions = null;\r\n    }\r\n\r\n    // Clear start position attributes\r\n    this.setAttr('startX', undefined);\r\n    this.setAttr('startY', undefined);\r\n  });\r\n\r\n  layer.add(group);\r\n  cardGroups.set(cardData.id, group);\r\n}\r\n\r\n/**\r\n * Render text card\r\n */\r\nfunction renderTextCard(group, cardData) {\r\n  // Get card color\r\n  const cardColor = getCardColor(cardData.cardColor);\r\n\r\n  // Check themes\r\n  const isEink = document.body.classList.contains('eink-theme');\r\n  const isDark = document.body.classList.contains('dark-theme');\r\n\r\n  // E-ink: white with light tint if colored, otherwise white\r\n  let fillColor = cardColor;\r\n  if (isEink) {\r\n    if (cardData.cardColor && cardData.cardColor !== 'yellow') {\r\n      // Light tint based on card color\r\n      const colorMap = {\r\n        blue: '#e6f2ff',\r\n        green: '#e6ffe6',\r\n        pink: '#ffe6f2',\r\n        purple: '#f2e6ff',\r\n        orange: '#fff2e6'\r\n      };\r\n      fillColor = colorMap[cardData.cardColor] || '#ffffff';\r\n    } else {\r\n      fillColor = '#ffffff';\r\n    }\r\n  } else if (isDark) {\r\n    fillColor = '#2d3748';\r\n  }\r\n\r\n  // Background\r\n  const background = new Konva.Rect({\r\n    width: 200,\r\n    height: 150,\r\n    fill: fillColor,\r\n    stroke: isEink ? '#000000' : (isDark ? '#4a5568' : '#e0e0e0'),\r\n    strokeWidth: isEink ? 2 : 1,\r\n    cornerRadius: 8,\r\n    shadowColor: isEink ? 'transparent' : 'black',\r\n    shadowBlur: isEink ? 0 : 10,\r\n    shadowOpacity: isEink ? 0 : 0.1,\r\n    shadowOffset: { x: 0, y: isEink ? 0 : 2 }\r\n  });\r\n\r\n  // Text\r\n  const text = new Konva.Text({\r\n    text: cardData.text || '',\r\n    x: 16,\r\n    y: 16,\r\n    width: 168,\r\n    fontSize: 16,\r\n    fontFamily: 'sans-serif',\r\n    fill: isDark ? '#e0e0e0' : '#1a1a1a',\r\n    wrap: 'word'\r\n  });\r\n\r\n  group.add(background);\r\n  group.add(text);\r\n}\r\n\r\n/**\r\n * Render image card\r\n */\r\nfunction renderImageCard(group, cardData) {\r\n  const imageObj = new Image();\r\n  const imageData = cardData.image; // This is the object { base64, width, height, quality }\r\n  const isFlipped = cardData.flipped || false;\r\n\r\n  console.log('DEBUG: renderImageCard - cardData.image:', imageData);\r\n\r\n  imageObj.onload = function() {\r\n    console.log('DEBUG: renderImageCard - imageObj loaded. naturalWidth:', imageObj.naturalWidth, 'naturalHeight:', imageObj.naturalHeight);\r\n    console.log('DEBUG: renderImageCard - imageData.base64 (truncated):', imageData.base64 ? imageData.base64.substring(0, 100) + '...' : 'N/A');\r\n\r\n    // Check themes\r\n    const isEink = document.body.classList.contains('eink-theme');\r\n    const isDark = document.body.classList.contains('dark-theme');\r\n\r\n    // Calculate card display dimensions (maintain aspect ratio)\r\n    // Standard display size: 200px for aligned columns\r\n    const displayMaxWidth = 200;\r\n    const displayMaxHeight = 300;\r\n\r\n    let naturalWidth = imageObj.naturalWidth;\r\n    let naturalHeight = imageObj.naturalHeight;\r\n\r\n    // If natural dimensions are 0, use stored dimensions if available, or fallback\r\n    if (naturalWidth === 0 || naturalHeight === 0) {\r\n        console.warn('WARNING: Image natural dimensions are 0. Falling back to stored dimensions or default.');\r\n        naturalWidth = imageData.width || 200;\r\n        naturalHeight = imageData.height || 150;\r\n    }\r\n\r\n    // Calculate display size (scaled down for card)\r\n    let displayWidth = naturalWidth;\r\n    let displayHeight = naturalHeight;\r\n\r\n    if (displayWidth > displayMaxWidth || displayHeight > displayMaxHeight) {\r\n      const ratio = Math.min(displayMaxWidth / displayWidth, displayMaxHeight / displayHeight);\r\n      displayWidth = displayWidth * ratio;\r\n      displayHeight = displayHeight * ratio;\r\n    }\r\n\r\n    // Use display dimensions for card, but keep original image for sharp rendering\r\n    const width = displayWidth;\r\n    const height = displayHeight;\r\n\r\n    console.log('DEBUG: renderImageCard - Final calculated width:', width, 'height:', height);\r\n\r\n    // Store dimensions on group for flip\r\n    group.setAttr('cardWidth', width);\r\n    group.setAttr('cardHeight', height);\r\n\r\n    if (isFlipped) {\r\n      // Show back side (text)\r\n      const background = new Konva.Rect({\r\n        width: width,\r\n        height: height,\r\n        fill: isEink ? '#ffffff' : (isDark ? '#2d3748' : '#fffacd'),\r\n        stroke: isEink ? '#000000' : (isDark ? '#4a5568' : '#e0e0e0'),\r\n        strokeWidth: isEink ? 2 : 1,\r\n        cornerRadius: 8,\r\n        shadowColor: isEink ? 'transparent' : 'black',\r\n        shadowBlur: isEink ? 0 : 10,\r\n        shadowOpacity: isEink ? 0 : 0.1,\r\n        shadowOffset: { x: 0, y: isEink ? 0 : 2 }\r\n      });\r\n\r\n      const text = new Konva.Text({\r\n        text: cardData.backText || 'Dubbelklicka fr att redigera baksidan...',\r\n        x: 16,\r\n        y: 16,\r\n        width: width - 32,\r\n        height: height - 32,\r\n        fontSize: 16,\r\n        fontFamily: 'sans-serif',\r\n        fill: isDark ? '#e0e0e0' : '#1a1a1a',\r\n        wrap: 'word',\r\n        align: 'left',\r\n        verticalAlign: 'top'\r\n      });\r\n\r\n      group.add(background);\r\n      group.add(text);\r\n    } else {\r\n      // Show front side (image)\r\n      const background = new Konva.Rect({\r\n        width: width,\r\n        height: height,\r\n        fill: '#ffffff',\r\n        stroke: isEink ? '#000000' : (isDark ? '#4a5568' : '#e0e0e0'),\r\n        strokeWidth: isEink ? 2 : 1,\r\n        cornerRadius: 8,\r\n        shadowColor: isEink ? 'transparent' : 'black',\r\n        shadowBlur: isEink ? 0 : 10,\r\n        shadowOpacity: isEink ? 0 : 0.1,\r\n        shadowOffset: { x: 0, y: isEink ? 0 : 2 }\r\n      });\r\n\r\n      // Calculate scale to fit display dimensions while preserving image quality\r\n      const scaleX = width / naturalWidth;\r\n      const scaleY = height / naturalHeight;\r\n\r\n      const konvaImage = new Konva.Image({\r\n        image: imageObj,\r\n        scaleX: scaleX,\r\n        scaleY: scaleY,\r\n        cornerRadius: 8\r\n      });\r\n\r\n      group.add(background);\r\n      group.add(konvaImage);\r\n\r\n      // Tooltip on hover (show filename)\r\n      group.on('mouseenter', function() {\r\n        document.body.style.cursor = 'pointer';\r\n\r\n        // Show tooltip\r\n        const tooltip = document.createElement('div');\r\n        tooltip.id = 'card-tooltip';\r\n        tooltip.style.cssText = `\r\n          position: fixed;\r\n          background: rgba(0, 0, 0, 0.8);\r\n          color: white;\r\n          padding: 8px 12px;\r\n          border-radius: 6px;\r\n          font-size: 14px;\r\n          z-index: 10001;\r\n          pointer-events: none;\r\n          font-family: sans-serif;\r\n        `;\r\n        tooltip.textContent = cardData.text || 'Bild';\r\n        document.body.appendChild(tooltip);\r\n\r\n        // Update tooltip position on mouse move\r\n        const updateTooltip = (e) => {\r\n          tooltip.style.left = (e.clientX + 10) + 'px';\r\n          tooltip.style.top = (e.clientY + 10) + 'px';\r\n        };\r\n\r\n        stage.on('mousemove', updateTooltip);\r\n        group.setAttr('tooltipHandler', updateTooltip);\r\n      });\r\n\r\n      group.on('mouseleave', function() {\r\n        document.body.style.cursor = 'default';\r\n\r\n        // Remove tooltip\r\n        const tooltip = document.getElementById('card-tooltip');\r\n        if (tooltip) {\r\n          document.body.removeChild(tooltip);\r\n        }\r\n\r\n        // Remove mousemove handler\r\n        const handler = group.getAttr('tooltipHandler');\r\n        if (handler) {\r\n          stage.off('mousemove', handler);\r\n        }\r\n      });\r\n    }\r\n\r\n    layer.batchDraw();\r\n  };\r\n\r\n  imageObj.onerror = function() {\r\n      console.error('ERROR: renderImageCard - Failed to load image from base64. imageData:', imageData);\r\n  };\r\n\r\n  imageObj.src = imageData.base64;\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 3: CARD CREATION & EDITING (Dialogs, Inline Editor, Touch Menus)\r\n// ============================================================================\r\n\r\n/**\r\n * Create new card\r\n */\r\nasync function createNewCard(position) {\r\n  // Create empty card first\r\n  const cardData = {\r\n    text: '',\r\n    tags: [],\r\n    position\r\n  };\r\n\r\n  const cardId = await createCard(cardData);\r\n\r\n  // Add to undo stack\r\n  pushUndo({\r\n    type: 'create',\r\n    cardId,\r\n    card: cardData\r\n  });\r\n\r\n  // Reload canvas to show new card\r\n  await reloadCanvas();\r\n\r\n  // Open editor on the new card\r\n  const group = cardGroups.get(cardId);\r\n  if (group) {\r\n    await createInlineEditor(cardId, group, '', false);\r\n  }\r\n}\r\n\r\n/**\r\n * Inline text editor using HTML textarea overlay\r\n */\r\nasync function createInlineEditor(cardId, group, currentText, isImageBack = false) {\r\n  // Get card data\r\n  const cards = await getAllCards();\r\n  const card = cards.find(c => c.id === cardId);\r\n  if (!card) return;\r\n\r\n  const currentTags = card.tags || [];\r\n  const currentColor = card.cardColor || '';\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(0, 0, 0, 0.7);\r\n    z-index: 10000;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  `;\r\n\r\n  // Create dialog\r\n  const dialog = document.createElement('div');\r\n  dialog.style.cssText = `\r\n    background: var(--bg-primary);\r\n    color: var(--text-primary);\r\n    padding: 24px;\r\n    border-radius: 12px;\r\n    max-width: 600px;\r\n    width: 90%;\r\n    max-height: 80vh;\r\n    overflow-y: auto;\r\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\r\n  `;\r\n\r\n  dialog.innerHTML = `\r\n    <h3 style=\"margin-top: 0; margin-bottom: 20px; font-size: 20px; font-weight: 600;\">\r\n      ${isImageBack ? 'Redigera baksida' : 'Redigera kort'}\r\n    </h3>\r\n\r\n    <div style=\"margin-bottom: 16px;\">\r\n      <label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">Text:</label>\r\n      <textarea id=\"editCardText\"\r\n        style=\"width: 100%; height: 200px; padding: 12px; font-size: 16px;\r\n               border: 2px solid var(--border-color); border-radius: 8px;\r\n               background: var(--bg-secondary); color: var(--text-primary);\r\n               font-family: inherit; resize: vertical; box-sizing: border-box;\"\r\n      >${currentText || ''}</textarea>\r\n    </div>\r\n\r\n    ${!isImageBack ? `\r\n    <div style=\"margin-bottom: 16px;\">\r\n      <label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">Tags (kommaseparerade):</label>\r\n      <input type=\"text\" id=\"editCardTags\" value=\"${currentTags.join(', ')}\"\r\n        style=\"width: 100%; padding: 12px; font-size: 16px;\r\n               border: 2px solid var(--border-color); border-radius: 8px;\r\n               background: var(--bg-secondary); color: var(--text-primary);\r\n               box-sizing: border-box;\">\r\n    </div>\r\n\r\n    <div style=\"margin-bottom: 20px;\">\r\n      <label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">Kortfrg:</label>\r\n      <div id=\"editColorPicker\" style=\"display: flex; gap: 10px; flex-wrap: wrap;\">\r\n        <div class=\"color-dot\" data-color=\"\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: var(--bg-secondary); border: 3px solid var(--border-color); cursor: pointer;\r\n             display: flex; align-items: center; justify-content: center; font-size: 20px;\"\r\n             title=\"Ingen frg\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-1\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #d4f2d4; border: 3px solid transparent; cursor: pointer;\" title=\"Grn\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-2\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #ffe4b3; border: 3px solid transparent; cursor: pointer;\" title=\"Orange\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-3\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #ffc1cc; border: 3px solid transparent; cursor: pointer;\" title=\"Rd\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-4\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #fff7b3; border: 3px solid transparent; cursor: pointer;\" title=\"Gul\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-5\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #f3e5f5; border: 3px solid transparent; cursor: pointer;\" title=\"Lila\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-6\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #c7e7ff; border: 3px solid transparent; cursor: pointer;\" title=\"Bl\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-7\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #e0e0e0; border: 3px solid transparent; cursor: pointer;\" title=\"Gr\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-8\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #ffffff; border: 3px solid #ddd; cursor: pointer;\" title=\"Vit\"></div>\r\n      </div>\r\n    </div>\r\n    ` : ''}\r\n\r\n    <div style=\"display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;\">\r\n      <button id=\"cancelEdit\" style=\"padding: 12px 24px; background: var(--bg-secondary);\r\n                                     color: var(--text-primary); border: 2px solid var(--border-color);\r\n                                     border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer;\">\r\n        Avbryt\r\n      </button>\r\n      ${card.image ? `\r\n      <button id=\"readWithAI\" style=\"padding: 12px 24px; background: #8B5CF6;\r\n                                     color: white; border: none; border-radius: 8px;\r\n                                     font-size: 16px; font-weight: 600; cursor: pointer;\">\r\n         Ls med AI\r\n      </button>\r\n      ` : ''}\r\n      <button id=\"saveEdit\" style=\"padding: 12px 24px; background: var(--accent-color);\r\n                                    color: white; border: none; border-radius: 8px;\r\n                                    font-size: 16px; font-weight: 600; cursor: pointer;\">\r\n        ${isImageBack ? 'Spara & Vnd tillbaka' : 'Spara'}\r\n      </button>\r\n    </div>\r\n\r\n    <div style=\"margin-top: 16px; font-size: 13px; color: var(--text-secondary); text-align: center;\">\r\n      Tips: Ctrl+Enter = Spara, Esc = Avbryt\r\n    </div>\r\n  `;\r\n\r\n  overlay.appendChild(dialog);\r\n  document.body.appendChild(overlay);\r\n\r\n  // Get elements\r\n  const textarea = document.getElementById('editCardText');\r\n  const tagsInput = document.getElementById('editCardTags');\r\n  const saveBtn = document.getElementById('saveEdit');\r\n  const cancelBtn = document.getElementById('cancelEdit');\r\n\r\n  // Focus textarea\r\n  textarea.focus();\r\n  textarea.select();\r\n\r\n  // Handle color selection (only for regular cards)\r\n  let selectedColor = currentColor;\r\n  if (!isImageBack) {\r\n    const colorDots = document.querySelectorAll('#editColorPicker .color-dot');\r\n\r\n    // Highlight current color\r\n    colorDots.forEach(dot => {\r\n      if (dot.dataset.color === currentColor) {\r\n        dot.style.border = '3px solid var(--accent-color)';\r\n      } else if (!currentColor && dot.dataset.color === '') {\r\n        dot.style.border = '3px solid var(--accent-color)';\r\n      }\r\n\r\n      dot.addEventListener('click', function() {\r\n        // Remove selection from all\r\n        colorDots.forEach(d => {\r\n          if (d.dataset.color === '') {\r\n            d.style.border = '3px solid var(--border-color)';\r\n          } else if (d.dataset.color === 'card-color-8') {\r\n            d.style.border = '3px solid #ddd';\r\n          } else {\r\n            d.style.border = '3px solid transparent';\r\n          }\r\n        });\r\n\r\n        // Select this one\r\n        this.style.border = '3px solid var(--accent-color)';\r\n        selectedColor = this.dataset.color;\r\n      });\r\n    });\r\n  }\r\n\r\n  const cleanup = () => {\r\n    if (overlay.parentNode) {\r\n      document.body.removeChild(overlay);\r\n    }\r\n    document.removeEventListener('keydown', escHandler);\r\n  };\r\n\r\n  // Save handler\r\n  const save = async () => {\r\n    const newText = textarea.value;\r\n\r\n    if (isImageBack) {\r\n      // Save back text and flip card\r\n      pushUndo({\r\n        type: 'update',\r\n        cardId,\r\n        oldData: { backText: currentText },\r\n        newData: { backText: newText }\r\n      });\r\n\r\n      await updateCard(cardId, { backText: newText });\r\n      await flipCard(cardId);\r\n    } else {\r\n      // Save regular card\r\n      const newTags = tagsInput ? tagsInput.value.split(',').map(t => t.trim()).filter(t => t) : currentTags;\r\n\r\n      const updates = {\r\n        text: newText,\r\n        tags: newTags\r\n      };\r\n\r\n      // Add color if changed\r\n      if (selectedColor !== currentColor) {\r\n        updates.cardColor = selectedColor;\r\n      }\r\n\r\n      pushUndo({\r\n        type: 'update',\r\n        cardId,\r\n        oldData: { text: currentText, tags: currentTags, cardColor: currentColor },\r\n        newData: updates\r\n      });\r\n\r\n      await updateCard(cardId, updates);\r\n      await reloadCanvas();\r\n    }\r\n\r\n    cleanup();\r\n  };\r\n\r\n  // Event listeners\r\n  saveBtn.addEventListener('click', save);\r\n  cancelBtn.addEventListener('click', cleanup);\r\n\r\n  // AI read button (only for image cards)\r\n  const readWithAIBtn = document.getElementById('readWithAI');\r\n  if (readWithAIBtn) {\r\n    readWithAIBtn.addEventListener('click', async () => {\r\n      cleanup();\r\n      await readImageWithGemini(cardId);\r\n    });\r\n  }\r\n\r\n  // Keyboard shortcuts\r\n  const escHandler = (e) => {\r\n    if (e.key === 'Escape') {\r\n      cleanup();\r\n    }\r\n  };\r\n  document.addEventListener('keydown', escHandler);\r\n\r\n  textarea.addEventListener('keydown', (e) => {\r\n    if (e.ctrlKey && e.key === 'Enter') {\r\n      e.preventDefault();\r\n      save();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Bulk editor for multiple selected cards\r\n */\r\nasync function createBulkEditor(cardIds) {\r\n  const cards = await getAllCards();\r\n  const selectedCards = cards.filter(c => cardIds.includes(c.id));\r\n\r\n  if (selectedCards.length === 0) return;\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    width: 100%;\r\n    height: 100%;\r\n    background: rgba(0, 0, 0, 0.7);\r\n    z-index: 10000;\r\n    display: flex;\r\n    justify-content: center;\r\n    align-items: center;\r\n  `;\r\n\r\n  // Create dialog\r\n  const dialog = document.createElement('div');\r\n  dialog.style.cssText = `\r\n    background: var(--bg-primary);\r\n    color: var(--text-primary);\r\n    padding: 24px;\r\n    border-radius: 12px;\r\n    max-width: 600px;\r\n    width: 90%;\r\n    max-height: 80vh;\r\n    overflow-y: auto;\r\n    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);\r\n  `;\r\n\r\n  dialog.innerHTML = `\r\n    <h3 style=\"margin-top: 0; margin-bottom: 20px; font-size: 20px; font-weight: 600;\">\r\n      Redigera ${selectedCards.length} kort\r\n    </h3>\r\n\r\n    <div style=\"margin-bottom: 16px; padding: 12px; background: var(--bg-secondary); border-radius: 8px;\">\r\n      <p style=\"margin: 0; font-size: 14px;\">\r\n        ndringar appliceras p alla ${selectedCards.length} markerade kort.\r\n        Lmna flt tomma fr att inte ndra dem.\r\n      </p>\r\n    </div>\r\n\r\n    <div style=\"margin-bottom: 16px;\">\r\n      <label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">\r\n        Lgg till tags (kommaseparerade, lggs till befintliga):\r\n      </label>\r\n      <input type=\"text\" id=\"bulkAddTags\"\r\n        placeholder=\"t.ex. urgent, projekt\"\r\n        style=\"width: 100%; padding: 12px; font-size: 16px;\r\n               border: 2px solid var(--border-color); border-radius: 8px;\r\n               background: var(--bg-secondary); color: var(--text-primary);\r\n               box-sizing: border-box;\">\r\n    </div>\r\n\r\n    <div style=\"margin-bottom: 20px;\">\r\n      <label style=\"display: block; margin-bottom: 8px; font-weight: 500;\">Kortfrg:</label>\r\n      <div id=\"bulkColorPicker\" style=\"display: flex; gap: 10px; flex-wrap: wrap;\">\r\n        <div class=\"color-dot\" data-color=\"none\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: var(--bg-secondary); border: 3px solid var(--accent-color); cursor: pointer;\r\n             display: flex; align-items: center; justify-content: center; font-size: 20px;\"\r\n             title=\"ndra inte frg\"></div>\r\n        <div class=\"color-dot\" data-color=\"\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: var(--bg-secondary); border: 3px solid var(--border-color); cursor: pointer;\r\n             display: flex; align-items: center; justify-content: center; font-size: 20px;\"\r\n             title=\"Ingen frg\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-1\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #d4f2d4; border: 3px solid transparent; cursor: pointer;\" title=\"Grn\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-2\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #ffe4b3; border: 3px solid transparent; cursor: pointer;\" title=\"Orange\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-3\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #ffc1cc; border: 3px solid transparent; cursor: pointer;\" title=\"Rd\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-4\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #fff7b3; border: 3px solid transparent; cursor: pointer;\" title=\"Gul\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-5\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #f3e5f5; border: 3px solid transparent; cursor: pointer;\" title=\"Lila\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-6\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #c7e7ff; border: 3px solid transparent; cursor: pointer;\" title=\"Bl\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-7\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #e0e0e0; border: 3px solid transparent; cursor: pointer;\" title=\"Gr\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-8\" style=\"width: 36px; height: 36px; border-radius: 50%;\r\n             background: #ffffff; border: 3px solid #ddd; cursor: pointer;\" title=\"Vit\"></div>\r\n      </div>\r\n    </div>\r\n\r\n    <div style=\"display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;\">\r\n      <button id=\"bulkCancel\" style=\"padding: 12px 24px; background: var(--bg-secondary);\r\n                                     color: var(--text-primary); border: 2px solid var(--border-color);\r\n                                     border-radius: 8px; font-size: 16px; font-weight: 500; cursor: pointer;\">\r\n        Avbryt\r\n      </button>\r\n      <button id=\"bulkSave\" style=\"padding: 12px 24px; background: var(--accent-color);\r\n                                    color: white; border: none; border-radius: 8px;\r\n                                    font-size: 16px; font-weight: 600; cursor: pointer;\">\r\n        Uppdatera alla\r\n      </button>\r\n    </div>\r\n\r\n    <div style=\"margin-top: 16px; font-size: 13px; color: var(--text-secondary); text-align: center;\">\r\n      Tips: Ctrl+Enter = Spara, Esc = Avbryt\r\n    </div>\r\n  `;\r\n\r\n  overlay.appendChild(dialog);\r\n  document.body.appendChild(overlay);\r\n\r\n  // Get elements\r\n  const tagsInput = document.getElementById('bulkAddTags');\r\n  const saveBtn = document.getElementById('bulkSave');\r\n  const cancelBtn = document.getElementById('bulkCancel');\r\n\r\n  // Handle color selection\r\n  let selectedColor = 'none'; // Default: don't change\r\n  const colorDots = document.querySelectorAll('#bulkColorPicker .color-dot');\r\n\r\n  colorDots.forEach(dot => {\r\n    dot.addEventListener('click', function() {\r\n      // Remove selection from all\r\n      colorDots.forEach(d => {\r\n        if (d.dataset.color === 'none') {\r\n          d.style.border = '3px solid transparent';\r\n        } else if (d.dataset.color === '') {\r\n          d.style.border = '3px solid var(--border-color)';\r\n        } else if (d.dataset.color === 'card-color-8') {\r\n          d.style.border = '3px solid #ddd';\r\n        } else {\r\n          d.style.border = '3px solid transparent';\r\n        }\r\n      });\r\n\r\n      // Select this one\r\n      this.style.border = '3px solid var(--accent-color)';\r\n      selectedColor = this.dataset.color;\r\n    });\r\n  });\r\n\r\n  const cleanup = () => {\r\n    if (overlay.parentNode) {\r\n      document.body.removeChild(overlay);\r\n    }\r\n    document.removeEventListener('keydown', escHandler);\r\n  };\r\n\r\n  // Save handler\r\n  const save = async () => {\r\n    const addTags = tagsInput.value ? tagsInput.value.split(',').map(t => t.trim()).filter(t => t) : [];\r\n\r\n    // Build updates\r\n    for (const card of selectedCards) {\r\n      const updates = {};\r\n\r\n      // Add tags (merge with existing)\r\n      if (addTags.length > 0) {\r\n        const existingTags = card.tags || [];\r\n        const newTags = [...new Set([...existingTags, ...addTags])]; // Remove duplicates\r\n        updates.tags = newTags;\r\n      }\r\n\r\n      // Update color (only if not 'none')\r\n      if (selectedColor !== 'none') {\r\n        updates.cardColor = selectedColor;\r\n      }\r\n\r\n      // Only update if there are changes\r\n      if (Object.keys(updates).length > 0) {\r\n        await updateCard(card.id, updates);\r\n      }\r\n    }\r\n\r\n    await reloadCanvas();\r\n    cleanup();\r\n\r\n    console.log(`Bulk updated ${selectedCards.length} cards`);\r\n  };\r\n\r\n  // Event listeners\r\n  saveBtn.addEventListener('click', save);\r\n  cancelBtn.addEventListener('click', cleanup);\r\n\r\n  // Keyboard shortcuts\r\n  const escHandler = (e) => {\r\n    if (e.key === 'Escape') {\r\n      cleanup();\r\n    }\r\n  };\r\n  document.addEventListener('keydown', escHandler);\r\n\r\n  tagsInput.addEventListener('keydown', (e) => {\r\n    if (e.ctrlKey && e.key === 'Enter') {\r\n      e.preventDefault();\r\n      save();\r\n    }\r\n  });\r\n\r\n  // Focus tags input\r\n  tagsInput.focus();\r\n}\r\n\r\n/**\r\n * Show touch paste menu (for long-press on empty canvas)\r\n */\r\nasync function showTouchPasteMenu(x, y, position) {\r\n  const menu = document.createElement('div');\r\n  menu.style.cssText = `\r\n    position: fixed;\r\n    left: ${x}px;\r\n    top: ${y}px;\r\n    background: var(--bg-primary);\r\n    color: var(--text-primary);\r\n    border: 2px solid var(--border-color);\r\n    border-radius: 12px;\r\n    padding: 8px;\r\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\r\n    z-index: 10000;\r\n    min-width: 200px;\r\n  `;\r\n\r\n  menu.innerHTML = `\r\n    <div id=\"touchMenuPasteImage\" style=\"padding: 12px; cursor: pointer; border-radius: 8px; font-size: 16px;\">\r\n       Klistra in bild\r\n    </div>\r\n    <div id=\"touchMenuNewCard\" style=\"padding: 12px; cursor: pointer; border-radius: 8px; font-size: 16px;\">\r\n       Nytt kort\r\n    </div>\r\n    <div id=\"touchMenuCancel\" style=\"padding: 12px; cursor: pointer; border-radius: 8px; font-size: 16px; color: var(--text-secondary);\">\r\n       Avbryt\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(menu);\r\n\r\n  // Add hover effects\r\n  const items = menu.querySelectorAll('div[id^=\"touchMenu\"]');\r\n  items.forEach(item => {\r\n    item.addEventListener('mouseenter', () => {\r\n      item.style.background = 'var(--bg-secondary)';\r\n    });\r\n    item.addEventListener('mouseleave', () => {\r\n      item.style.background = 'transparent';\r\n    });\r\n  });\r\n\r\n  const cleanup = () => {\r\n    if (menu.parentNode) {\r\n      document.body.removeChild(menu);\r\n    }\r\n  };\r\n\r\n  // Paste image handler - try clipboard first, fallback to file picker\r\n  document.getElementById('touchMenuPasteImage').addEventListener('click', async () => {\r\n    cleanup();\r\n\r\n    // Try to paste from clipboard first\r\n    if (navigator.clipboard && navigator.clipboard.read) {\r\n      try {\r\n        await pasteImageFromClipboard();\r\n        return;\r\n      } catch (error) {\r\n        console.log('Clipboard paste failed, falling back to file picker:', error);\r\n      }\r\n    }\r\n\r\n    // Fallback to file picker\r\n    await importImage(position);\r\n  });\r\n\r\n  // New card handler\r\n  document.getElementById('touchMenuNewCard').addEventListener('click', async () => {\r\n    cleanup();\r\n    await createNewCard(position);\r\n  });\r\n\r\n  // Cancel handler\r\n  document.getElementById('touchMenuCancel').addEventListener('click', () => {\r\n    cleanup();\r\n  });\r\n\r\n  // Close on outside click\r\n  setTimeout(() => {\r\n    document.addEventListener('click', cleanup, { once: true });\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Show touch bulk menu (for long-press on selected cards)\r\n */\r\nexport async function showTouchBulkMenu(x, y) {\r\n  const selectedGroups = layer.find('.selected');\r\n  const selectedIds = selectedGroups.map(g => g.getAttr('cardId')).filter(id => id);\r\n\r\n  if (selectedIds.length === 0) return;\r\n\r\n  const menu = document.createElement('div');\r\n  menu.style.cssText = `\r\n    position: fixed;\r\n    left: ${x}px;\r\n    top: ${y}px;\r\n    background: var(--bg-primary);\r\n    color: var(--text-primary);\r\n    border: 2px solid var(--border-color);\r\n    border-radius: 12px;\r\n    padding: 8px;\r\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\r\n    z-index: 10000;\r\n    min-width: 220px;\r\n  `;\r\n\r\n  menu.innerHTML = `\r\n    <div style=\"padding: 8px 12px; font-weight: 600; border-bottom: 1px solid var(--border-color); margin-bottom: 4px;\">\r\n      ${selectedIds.length} kort markerade\r\n    </div>\r\n    <div id=\"touchBulkEdit\" style=\"padding: 12px; cursor: pointer; border-radius: 8px; font-size: 16px;\">\r\n       Redigera alla\r\n    </div>\r\n    <div id=\"touchBulkColor\" style=\"padding: 12px; cursor: pointer; border-radius: 8px; font-size: 16px;\">\r\n       ndra frg\r\n    </div>\r\n    <div id=\"touchBulkTag\" style=\"padding: 12px; cursor: pointer; border-radius: 8px; font-size: 16px;\">\r\n       Lgg till taggar\r\n    </div>\r\n    <div id=\"touchBulkCancel\" style=\"padding: 12px; cursor: pointer; border-radius: 8px; font-size: 16px; color: var(--text-secondary); border-top: 1px solid var(--border-color); margin-top: 4px;\">\r\n       Avbryt\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(menu);\r\n\r\n  // Add hover effects\r\n  const items = menu.querySelectorAll('div[id^=\"touchBulk\"]');\r\n  items.forEach(item => {\r\n    item.addEventListener('mouseenter', () => {\r\n      item.style.background = 'var(--bg-secondary)';\r\n    });\r\n    item.addEventListener('mouseleave', () => {\r\n      item.style.background = 'transparent';\r\n    });\r\n  });\r\n\r\n  const cleanup = () => {\r\n    if (menu.parentNode) {\r\n      document.body.removeChild(menu);\r\n    }\r\n  };\r\n\r\n  // Edit all handler\r\n  document.getElementById('touchBulkEdit').addEventListener('click', async () => {\r\n    cleanup();\r\n    await createBulkEditor(selectedIds);\r\n  });\r\n\r\n  // Color picker handler\r\n  document.getElementById('touchBulkColor').addEventListener('click', async () => {\r\n    cleanup();\r\n    await showQuickColorPicker(x, y, selectedIds);\r\n  });\r\n\r\n  // Add tags handler\r\n  document.getElementById('touchBulkTag').addEventListener('click', async () => {\r\n    cleanup();\r\n    await showQuickTagAdder(x, y, selectedIds);\r\n  });\r\n\r\n  // Cancel handler\r\n  document.getElementById('touchBulkCancel').addEventListener('click', () => {\r\n    cleanup();\r\n  });\r\n\r\n  // Close on outside click\r\n  setTimeout(() => {\r\n    document.addEventListener('click', cleanup, { once: true });\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Quick color picker for bulk operations\r\n */\r\nasync function showQuickColorPicker(x, y, cardIds) {\r\n  const picker = document.createElement('div');\r\n  picker.style.cssText = `\r\n    position: fixed;\r\n    left: ${x}px;\r\n    top: ${y}px;\r\n    background: var(--bg-primary);\r\n    color: var(--text-primary);\r\n    border: 2px solid var(--border-color);\r\n    border-radius: 12px;\r\n    padding: 12px;\r\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\r\n    z-index: 10001;\r\n    display: flex;\r\n    gap: 8px;\r\n    flex-wrap: wrap;\r\n    max-width: 200px;\r\n  `;\r\n\r\n  const colors = [\r\n    { id: '', label: '', title: 'Ingen frg' },\r\n    { id: 'card-color-1', color: '#d4f2d4', title: 'Grn' },\r\n    { id: 'card-color-2', color: '#ffe4b3', title: 'Orange' },\r\n    { id: 'card-color-3', color: '#ffc1cc', title: 'Rd' },\r\n    { id: 'card-color-4', color: '#fff7b3', title: 'Gul' },\r\n    { id: 'card-color-5', color: '#f3e5f5', title: 'Lila' },\r\n    { id: 'card-color-6', color: '#c7e7ff', title: 'Bl' },\r\n    { id: 'card-color-7', color: '#e0e0e0', title: 'Gr' },\r\n    { id: 'card-color-8', color: '#ffffff', title: 'Vit' }\r\n  ];\r\n\r\n  colors.forEach(colorInfo => {\r\n    const dot = document.createElement('div');\r\n    dot.style.cssText = `\r\n      width: 40px;\r\n      height: 40px;\r\n      border-radius: 50%;\r\n      background: ${colorInfo.color || 'var(--bg-secondary)'};\r\n      border: 2px solid var(--border-color);\r\n      cursor: pointer;\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      font-size: 24px;\r\n    `;\r\n    if (!colorInfo.color) {\r\n      dot.textContent = colorInfo.label;\r\n    }\r\n    dot.title = colorInfo.title;\r\n\r\n    dot.addEventListener('click', async () => {\r\n      const cards = await getAllCards();\r\n      for (const cardId of cardIds) {\r\n        await updateCard(cardId, { cardColor: colorInfo.id });\r\n      }\r\n      await reloadCanvas();\r\n      cleanup();\r\n    });\r\n\r\n    picker.appendChild(dot);\r\n  });\r\n\r\n  document.body.appendChild(picker);\r\n\r\n  const cleanup = () => {\r\n    if (picker.parentNode) {\r\n      document.body.removeChild(picker);\r\n    }\r\n  };\r\n\r\n  setTimeout(() => {\r\n    document.addEventListener('click', cleanup, { once: true });\r\n  }, 100);\r\n}\r\n\r\n/**\r\n * Quick tag adder for bulk operations\r\n */\r\nasync function showQuickTagAdder(x, y, cardIds) {\r\n  const adder = document.createElement('div');\r\n  adder.style.cssText = `\r\n    position: fixed;\r\n    left: ${x}px;\r\n    top: ${y}px;\r\n    background: var(--bg-primary);\r\n    color: var(--text-primary);\r\n    border: 2px solid var(--border-color);\r\n    border-radius: 12px;\r\n    padding: 16px;\r\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);\r\n    z-index: 10001;\r\n    min-width: 250px;\r\n  `;\r\n\r\n  adder.innerHTML = `\r\n    <div style=\"margin-bottom: 12px; font-weight: 600;\">Lgg till taggar</div>\r\n    <input type=\"text\" id=\"quickTagInput\" placeholder=\"t.ex. urgent, projekt\"\r\n      style=\"width: 100%; padding: 10px; border: 2px solid var(--border-color);\r\n             border-radius: 8px; background: var(--bg-secondary); color: var(--text-primary);\r\n             box-sizing: border-box; font-size: 16px; margin-bottom: 12px;\">\r\n    <div style=\"display: flex; gap: 8px;\">\r\n      <button id=\"quickTagCancel\" style=\"flex: 1; padding: 10px; background: var(--bg-secondary);\r\n              color: var(--text-primary); border: 2px solid var(--border-color); border-radius: 8px;\r\n              cursor: pointer; font-size: 14px;\">Avbryt</button>\r\n      <button id=\"quickTagSave\" style=\"flex: 1; padding: 10px; background: var(--accent-color);\r\n              color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 14px;\r\n              font-weight: 600;\">Lgg till</button>\r\n    </div>\r\n  `;\r\n\r\n  document.body.appendChild(adder);\r\n\r\n  const input = document.getElementById('quickTagInput');\r\n  const saveBtn = document.getElementById('quickTagSave');\r\n  const cancelBtn = document.getElementById('quickTagCancel');\r\n\r\n  input.focus();\r\n\r\n  const cleanup = () => {\r\n    if (adder.parentNode) {\r\n      document.body.removeChild(adder);\r\n    }\r\n  };\r\n\r\n  const save = async () => {\r\n    const newTags = input.value.split(',').map(t => t.trim()).filter(t => t);\r\n    if (newTags.length === 0) {\r\n      cleanup();\r\n      return;\r\n    }\r\n\r\n    const cards = await getAllCards();\r\n    for (const cardId of cardIds) {\r\n      const card = cards.find(c => c.id === cardId);\r\n      if (card) {\r\n        const existingTags = card.tags || [];\r\n        const mergedTags = [...new Set([...existingTags, ...newTags])];\r\n        await updateCard(cardId, { tags: mergedTags });\r\n      }\r\n    }\r\n\r\n    await reloadCanvas();\r\n    cleanup();\r\n  };\r\n\r\n  saveBtn.addEventListener('click', save);\r\n  cancelBtn.addEventListener('click', cleanup);\r\n\r\n  input.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Enter') {\r\n      e.preventDefault();\r\n      save();\r\n    } else if (e.key === 'Escape') {\r\n      cleanup();\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Open edit dialog for card (or bulk edit if multiple selected)\r\n */\r\nasync function openEditDialog(cardId) {\r\n  // Check if multiple cards are selected\r\n  const selectedGroups = layer.find('.selected');\r\n\r\n  if (selectedGroups.length > 1) {\r\n    // Bulk edit mode\r\n    const selectedIds = selectedGroups.map(g => g.getAttr('cardId')).filter(id => id);\r\n    await createBulkEditor(selectedIds);\r\n  } else {\r\n    // Single card edit\r\n    const cards = await getAllCards();\r\n    const card = cards.find(c => c.id === cardId);\r\n    if (!card) return;\r\n\r\n    const group = cardGroups.get(cardId);\r\n    if (!group) return;\r\n\r\n    if (card.image && card.flipped) {\r\n      // Flipped image card: inline edit back text\r\n      createInlineEditor(cardId, group, card.backText || '', true);\r\n    } else {\r\n      // Text card: inline edit\r\n      createInlineEditor(cardId, group, card.text || '', false);\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 4: CARD OPERATIONS (Flip, Delete)\r\n// ============================================================================\r\n\r\n/**\r\n * Flip image card\r\n */\r\nasync function flipCard(cardId) {\r\n  const cards = await getAllCards();\r\n  const card = cards.find(c => c.id === cardId);\r\n\r\n  if (!card || !card.image) return;\r\n\r\n  const newFlipped = !card.flipped;\r\n\r\n  pushUndo({\r\n    type: 'update',\r\n    cardId,\r\n    oldData: { flipped: card.flipped },\r\n    newData: { flipped: newFlipped }\r\n  });\r\n\r\n  await updateCard(cardId, { flipped: newFlipped });\r\n  await reloadCanvas();\r\n\r\n  // If flipping to back side, open editor automatically\r\n  if (newFlipped) {\r\n    setTimeout(() => {\r\n      const group = cardGroups.get(cardId);\r\n      if (group) {\r\n        createInlineEditor(cardId, group, card.backText || '', true);\r\n      }\r\n    }, 100); // Small delay to let canvas reload\r\n  }\r\n}\r\n\r\n/**\r\n * Delete card\r\n */\r\nasync function handleDeleteCard(cardId) {\r\n  // Get card data before deletion (for undo)\r\n  const cards = await getAllCards();\r\n  const card = cards.find(c => c.id === cardId);\r\n\r\n  if (card) {\r\n    // Add to undo stack\r\n    pushUndo({\r\n      type: 'delete',\r\n      card: { ...card }\r\n    });\r\n  }\r\n\r\n  await deleteCard(cardId);\r\n\r\n  // Remove from canvas\r\n  const group = cardGroups.get(cardId);\r\n  if (group) {\r\n    group.destroy();\r\n    cardGroups.delete(cardId);\r\n    layer.batchDraw();\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 5: CANVAS MANAGEMENT (Reload, Undo/Redo)\r\n// ============================================================================\r\n\r\n/**\r\n * Reload canvas from storage\r\n */\r\nexport async function reloadCanvas() {\r\n  // Clear existing cards\r\n  cardGroups.forEach(group => group.destroy());\r\n  cardGroups.clear();\r\n\r\n  // Reload from storage\r\n  await loadCards();\r\n}\r\n\r\n/**\r\n * Update shadows on all cards based on current theme\r\n * Called when theme changes\r\n */\r\nexport function updateCardShadows() {\r\n  const isEink = document.body.classList.contains('eink-theme');\r\n  const isDark = document.body.classList.contains('dark-theme');\r\n\r\n  cardGroups.forEach(group => {\r\n    const background = group.findOne('Rect');\r\n    if (background) {\r\n      if (isEink) {\r\n        // E-ink: no shadows\r\n        background.shadowColor('transparent');\r\n        background.shadowBlur(0);\r\n        background.shadowOpacity(0);\r\n        background.shadowOffset({ x: 0, y: 0 });\r\n      } else {\r\n        // Normal/dark: subtle shadows\r\n        background.shadowColor('black');\r\n        background.shadowBlur(10);\r\n        background.shadowOpacity(0.1);\r\n        background.shadowOffset({ x: 0, y: 2 });\r\n      }\r\n    }\r\n  });\r\n\r\n  if (layer) {\r\n    layer.batchDraw();\r\n  }\r\n}\r\n\r\n/**\r\n * Update fill colors on all cards based on current theme.\r\n * Called when theme changes.\r\n */\r\nexport async function updateCardFills() {\r\n  const isEink = document.body.classList.contains('eink-theme');\r\n  const isDark = document.body.classList.contains('dark-theme');\r\n  const allCards = await getAllCards();\r\n\r\n  const cardDataMap = new Map(allCards.map(card => [card.id, card]));\r\n\r\n  cardGroups.forEach(group => {\r\n    const cardId = group.getAttr('cardId');\r\n    const cardData = cardDataMap.get(cardId);\r\n    if (!cardData) return;\r\n\r\n    const background = group.findOne('Rect');\r\n    const text = group.findOne('Text');\r\n\r\n    if (background) {\r\n      let fillColor;\r\n\r\n      if (cardData.image && cardData.flipped) {\r\n        // Back of an image card\r\n        fillColor = isEink ? '#ffffff' : (isDark ? '#2d3748' : '#fffacd');\r\n      } else if (cardData.image && !cardData.flipped) {\r\n        // Front of an image card is always white\r\n        fillColor = '#ffffff';\r\n      } else {\r\n        // Text card\r\n        const cardColor = getCardColor(cardData.cardColor);\r\n        fillColor = cardColor; // Default to the card's own color\r\n\r\n        if (isEink) {\r\n          if (cardData.cardColor && cardData.cardColor !== 'yellow') {\r\n            const colorMap = {\r\n              'blue': '#e6f2ff', 'green': '#e6ffe6', 'pink': '#ffe6f2',\r\n              'purple': '#f2e6ff', 'orange': '#fff2e6'\r\n            };\r\n            fillColor = colorMap[cardData.cardColor] || '#ffffff';\r\n          } else {\r\n            fillColor = '#ffffff';\r\n          }\r\n        } else if (isDark) {\r\n          // In dark mode, text cards have a standard dark background, ignoring their color property\r\n          fillColor = '#2d3748';\r\n        }\r\n      }\r\n      background.fill(fillColor);\r\n    }\r\n\r\n    if (text) {\r\n      text.fill(isDark ? '#e0e0e0' : '#1a1a1a');\r\n    }\r\n  });\r\n\r\n  if (layer) {\r\n    layer.batchDraw();\r\n  }\r\n}\r\n\r\n/**\r\n * Update stroke on all cards based on current theme.\r\n * Called when theme changes.\r\n */\r\nexport function updateCardStrokes() {\r\n    const isEink = document.body.classList.contains('eink-theme');\r\n    const isDark = document.body.classList.contains('dark-theme');\r\n\r\n    cardGroups.forEach(group => {\r\n        const background = group.findOne('Rect');\r\n        if (background) {\r\n            const isSelected = group.hasName('selected');\r\n\r\n            if (isSelected) {\r\n                // Keep selection stroke color if selected\r\n                if (isEink) {\r\n                    background.stroke('#000000');\r\n                    background.strokeWidth(4);\r\n                } else {\r\n                    background.stroke('#2196F3');\r\n                    background.strokeWidth(3);\r\n                }\r\n            } else {\r\n                // Apply theme-specific stroke for non-selected cards\r\n                if (isEink) {\r\n                    background.stroke('#000000');\r\n                    background.strokeWidth(2);\r\n                } else if (isDark) {\r\n                    background.stroke('#4a5568');\r\n                    background.strokeWidth(1);\r\n                } else {\r\n                    background.stroke('#e0e0e0');\r\n                    background.strokeWidth(1);\r\n                }\r\n            }\r\n        }\r\n    });\r\n\r\n    if (layer) {\r\n        layer.batchDraw();\r\n    }\r\n}\r\n\r\n/**\r\n * Undo/redo functions\r\n */\r\nfunction pushUndo(action) {\r\n  undoStack.push(action);\r\n  if (undoStack.length > MAX_UNDO_STACK) {\r\n    undoStack.shift();\r\n  }\r\n  redoStack = []; // Clear redo stack on new action\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 6: CLIPBOARD (Copy/Paste/Duplicate)\r\n// ============================================================================\r\n\r\n/**\r\n * Duplicate/copy selected cards\r\n */\r\nasync function duplicateSelectedCards() {\r\n  const selectedGroups = layer.find('.selected');\r\n\r\n  if (selectedGroups.length === 0) {\r\n    console.log('No cards selected to duplicate');\r\n    return;\r\n  }\r\n\r\n  const { getCard, createCard } = await import('./storage.js');\r\n\r\n  for (const group of selectedGroups) {\r\n    const cardId = group.getAttr('cardId');\r\n    if (!cardId) continue;\r\n\r\n    // Get original card data\r\n    const originalCard = await getCard(cardId);\r\n    if (!originalCard) continue;\r\n\r\n    // Create duplicate with offset position\r\n    const { id, uniqueId, created, modified, metadata, ...cardData } = originalCard;\r\n\r\n    const duplicateData = {\r\n      ...cardData,\r\n      position: {\r\n        x: (originalCard.position?.x || 0) + 50,\r\n        y: (originalCard.position?.y || 0) + 50\r\n      }\r\n    };\r\n\r\n    // Create with copy metadata\r\n    await createCard(duplicateData, {\r\n      copied: true,\r\n      copiedAt: new Date().toISOString(),\r\n      copiedFrom: originalCard.uniqueId,\r\n      originalCardId: cardId\r\n    });\r\n  }\r\n\r\n  // Reload canvas\r\n  await reloadCanvas();\r\n  console.log(`Duplicated ${selectedGroups.length} cards`);\r\n}\r\n\r\n/**\r\n * Copy selected cards to clipboard\r\n */\r\nasync function copySelectedCards() {\r\n  const selectedGroups = layer.find('.selected');\r\n\r\n  if (selectedGroups.length === 0) {\r\n    console.log('No cards selected to copy');\r\n    return;\r\n  }\r\n\r\n  const { getCard } = await import('./storage.js');\r\n\r\n  clipboard = [];\r\n\r\n  for (const group of selectedGroups) {\r\n    const cardId = group.getAttr('cardId');\r\n    if (!cardId) continue;\r\n\r\n    const card = await getCard(cardId);\r\n    if (!card) continue;\r\n\r\n    // Store card data in clipboard\r\n    clipboard.push({\r\n      ...card\r\n    });\r\n  }\r\n\r\n  console.log(`Copied ${clipboard.length} cards to clipboard`);\r\n}\r\n\r\n/**\r\n * Paste cards from clipboard\r\n */\r\nasync function pasteCards() {\r\n  if (clipboard.length === 0) {\r\n    console.log('Clipboard is empty');\r\n    return;\r\n  }\r\n\r\n  const { createCard } = await import('./storage.js');\r\n\r\n  // Get paste position (center of viewport or mouse position)\r\n  const pointer = stage.getPointerPosition() || {\r\n    x: stage.width() / 2,\r\n    y: stage.height() / 2\r\n  };\r\n  const scale = stage.scaleX();\r\n  const pastePosition = {\r\n    x: (pointer.x - stage.x()) / scale,\r\n    y: (pointer.y - stage.y()) / scale\r\n  };\r\n\r\n  // Calculate offset from first card's position\r\n  const firstCard = clipboard[0];\r\n  const offsetX = pastePosition.x - (firstCard.position?.x || 0);\r\n  const offsetY = pastePosition.y - (firstCard.position?.y || 0);\r\n\r\n  for (const cardData of clipboard) {\r\n    const { id, uniqueId, created, modified, metadata, ...cleanData } = cardData;\r\n\r\n    const pastedData = {\r\n      ...cleanData,\r\n      position: {\r\n        x: (cardData.position?.x || 0) + offsetX,\r\n        y: (cardData.position?.y || 0) + offsetY\r\n      }\r\n    };\r\n\r\n    // Create with copy metadata\r\n    await createCard(pastedData, {\r\n      copied: true,\r\n      copiedAt: new Date().toISOString(),\r\n      copiedFrom: cardData.uniqueId,\r\n      originalCardId: id\r\n    });\r\n  }\r\n\r\n  await reloadCanvas();\r\n  console.log(`Pasted ${clipboard.length} cards`);\r\n}\r\n\r\n/**\r\n * Paste cards from clipboard and apply arrangement\r\n */\r\nasync function pasteCardsWithArrangement(arrangementFunc, arrangementName) {\r\n  if (clipboard.length === 0) {\r\n    console.log('Clipboard is empty');\r\n    return;\r\n  }\r\n\r\n  const { createCard } = await import('./storage.js');\r\n\r\n  // Get paste position (center of viewport)\r\n  const pointer = stage.getPointerPosition() || {\r\n    x: stage.width() / 2,\r\n    y: stage.height() / 2\r\n  };\r\n  const scale = stage.scaleX();\r\n  const pastePosition = {\r\n    x: (pointer.x - stage.x()) / scale,\r\n    y: (pointer.y - stage.y()) / scale\r\n  };\r\n\r\n  // Create cards first\r\n  const newCardIds = [];\r\n  for (const cardData of clipboard) {\r\n    const { id, uniqueId, created, modified, metadata, ...cleanData } = cardData;\r\n\r\n    const pastedData = {\r\n      ...cleanData,\r\n      position: pastePosition // Start at paste position\r\n    };\r\n\r\n    // Create with copy metadata\r\n    const newId = await createCard(pastedData, {\r\n      copied: true,\r\n      copiedAt: new Date().toISOString(),\r\n      copiedFrom: cardData.uniqueId,\r\n      originalCardId: id\r\n    });\r\n\r\n    newCardIds.push(newId);\r\n  }\r\n\r\n  await reloadCanvas();\r\n\r\n  // Select the newly pasted cards\r\n  layer.find('.selected').forEach(group => {\r\n    group.removeName('selected');\r\n    const background = group.findOne('Rect');\r\n    if (background) {\r\n      background.stroke(null);\r\n      background.strokeWidth(0);\r\n    }\r\n  });\r\n\r\n  newCardIds.forEach(cardId => {\r\n    const group = cardGroups.get(cardId);\r\n    if (group) {\r\n      group.addName('selected');\r\n      const background = group.findOne('Rect');\r\n      if (background) {\r\n        background.stroke('#2196F3');\r\n        background.strokeWidth(3);\r\n      }\r\n    }\r\n  });\r\n\r\n  layer.batchDraw();\r\n\r\n  // Apply arrangement to the newly pasted cards\r\n  await applyArrangement(arrangementFunc, arrangementName);\r\n\r\n  console.log(`Pasted and arranged ${clipboard.length} cards using ${arrangementName}`);\r\n}\r\n\r\nasync function undo() {\r\n  if (undoStack.length === 0) {\r\n    console.log('Nothing to undo');\r\n    return;\r\n  }\r\n\r\n  const action = undoStack.pop();\r\n  redoStack.push(action);\r\n\r\n  if (action.type === 'delete') {\r\n    // Restore deleted card\r\n    const cardId = await createCard(action.card);\r\n    await reloadCanvas();\r\n    console.log('Undo: Restored deleted card');\r\n  } else if (action.type === 'create') {\r\n    // Delete created card\r\n    await deleteCard(action.cardId);\r\n    await reloadCanvas();\r\n    console.log('Undo: Deleted created card');\r\n  } else if (action.type === 'update') {\r\n    // Restore old values\r\n    await updateCard(action.cardId, action.oldData);\r\n    await reloadCanvas();\r\n    console.log('Undo: Restored old card data');\r\n  }\r\n}\r\n\r\nasync function redo() {\r\n  if (redoStack.length === 0) {\r\n    console.log('Nothing to redo');\r\n    return;\r\n  }\r\n\r\n  const action = redoStack.pop();\r\n  undoStack.push(action);\r\n\r\n  if (action.type === 'delete') {\r\n    // Re-delete card\r\n    await deleteCard(action.card.id);\r\n    await reloadCanvas();\r\n    console.log('Redo: Re-deleted card');\r\n  } else if (action.type === 'create') {\r\n    // Re-create card\r\n    const cardId = await createCard(action.card);\r\n    await reloadCanvas();\r\n    console.log('Redo: Re-created card');\r\n  } else if (action.type === 'update') {\r\n    // Re-apply new values\r\n    await updateCard(action.cardId, action.newData);\r\n    await reloadCanvas();\r\n    console.log('Redo: Re-applied new card data');\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 7: SELECTION & INTERACTION (Events, Drag, Pan, Zoom)\r\n// ============================================================================\r\n\r\n/**\r\n * Update selection based on selection rectangle\r\n */\r\nfunction updateSelection() {\r\n  const selBox = selectionRectangle.getClientRect();\r\n  const isEink = document.body.classList.contains('eink-theme');\r\n  const isDark = document.body.classList.contains('dark-theme');\r\n\r\n  layer.find('.selected').forEach(group => {\r\n    const background = group.findOne('Rect');\r\n    group.removeName('selected');\r\n    if (background) {\r\n      if (isEink) {\r\n        background.stroke('#000000');\r\n        background.strokeWidth(2);\r\n      } else if (isDark) {\r\n        background.stroke('#4a5568');\r\n        background.strokeWidth(1);\r\n      } else {\r\n        background.stroke('#e0e0e0');\r\n        background.strokeWidth(1);\r\n      }\r\n    }\r\n  });\r\n\r\n  const groups = layer.getChildren(node => node.getAttr('cardId'));\r\n  groups.forEach(group => {\r\n    const groupBox = group.getClientRect();\r\n\r\n    // Check if rectangles intersect\r\n    if (Konva.Util.haveIntersection(selBox, groupBox)) {\r\n      const background = group.findOne('Rect');\r\n      group.addName('selected');\r\n      if (background) {\r\n        if (isEink) {\r\n          background.stroke('#000000');\r\n          background.strokeWidth(4);\r\n        } else {\r\n          background.stroke('#2196F3');\r\n          background.strokeWidth(3);\r\n        }\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Setup canvas events\r\n */\r\nfunction setupCanvasEvents() {\r\n  // Handle window resize\r\n  window.addEventListener('resize', () => {\r\n    const container = document.getElementById('canvas-container');\r\n    if (container && stage) {\r\n      stage.width(container.clientWidth);\r\n      stage.height(container.clientHeight);\r\n    }\r\n  });\r\n\r\n  // Zoom with mouse wheel (faster: 2x speed)\r\n  stage.on('wheel', (e) => {\r\n    e.evt.preventDefault();\r\n\r\n    const oldScale = stage.scaleX();\r\n    const pointer = stage.getPointerPosition();\r\n\r\n    const mousePointTo = {\r\n      x: (pointer.x - stage.x()) / oldScale,\r\n      y: (pointer.y - stage.y()) / oldScale,\r\n    };\r\n\r\n    const scaleBy = 1.1; // Was 1.05, now 1.1 for 2x faster zoom\r\n    const newScale = e.evt.deltaY < 0 ? oldScale * scaleBy : oldScale / scaleBy;\r\n\r\n    // Limit zoom between 0.1x and 5x\r\n    const clampedScale = Math.max(0.1, Math.min(5, newScale));\r\n\r\n    stage.scale({ x: clampedScale, y: clampedScale });\r\n\r\n    const newPos = {\r\n      x: pointer.x - mousePointTo.x * clampedScale,\r\n      y: pointer.y - mousePointTo.y * clampedScale,\r\n    };\r\n\r\n    stage.position(newPos);\r\n    stage.batchDraw();\r\n  });\r\n\r\n  // Pan with middle mouse or Ctrl+drag\r\n  // Selection rectangle with left-click drag on stage\r\n  stage.on('mousedown', (e) => {\r\n    // Ctrl+drag or middle mouse = pan\r\n    if (e.evt.button === 1 || (e.evt.button === 0 && e.evt.ctrlKey)) {\r\n      isPanning = true;\r\n      stage.draggable(true);\r\n      stage.container().style.cursor = 'grabbing';\r\n      return;\r\n    }\r\n\r\n    // Left click on stage (not on card) = start selection\r\n    if (e.target === stage && e.evt.button === 0) {\r\n      isSelecting = true;\r\n      const pos = stage.getPointerPosition();\r\n      const scale = stage.scaleX();\r\n      selectionStartPos = {\r\n        x: (pos.x - stage.x()) / scale,\r\n        y: (pos.y - stage.y()) / scale\r\n      };\r\n      selectionRectangle.width(0);\r\n      selectionRectangle.height(0);\r\n      selectionRectangle.visible(true);\r\n    }\r\n  });\r\n\r\n  stage.on('mousemove', () => {\r\n    if (!isSelecting) return;\r\n\r\n    const pos = stage.getPointerPosition();\r\n    const scale = stage.scaleX();\r\n    const currentPos = {\r\n      x: (pos.x - stage.x()) / scale,\r\n      y: (pos.y - stage.y()) / scale\r\n    };\r\n\r\n    const x = Math.min(selectionStartPos.x, currentPos.x);\r\n    const y = Math.min(selectionStartPos.y, currentPos.y);\r\n    const width = Math.abs(currentPos.x - selectionStartPos.x);\r\n    const height = Math.abs(currentPos.y - selectionStartPos.y);\r\n\r\n    selectionRectangle.setAttrs({\r\n      x: x,\r\n      y: y,\r\n      width: width,\r\n      height: height\r\n    });\r\n\r\n    // Update selection\r\n    updateSelection();\r\n    layer.batchDraw();\r\n  });\r\n\r\n  stage.on('mouseup', () => {\r\n    if (isPanning) {\r\n      isPanning = false;\r\n      stage.draggable(false);\r\n      stage.container().style.cursor = 'default';\r\n    }\r\n\r\n    if (isSelecting) {\r\n      isSelecting = false;\r\n      selectionRectangle.visible(false);\r\n      layer.batchDraw();\r\n    }\r\n  });\r\n\r\n  // Save card position when dragged\r\n  stage.on('dragend', (e) => {\r\n    const target = e.target;\r\n    if (target.getAttr('cardId')) {\r\n      const cardId = target.getAttr('cardId');\r\n      const position = { x: target.x(), y: target.y() };\r\n\r\n      updateCard(cardId, { position });\r\n    }\r\n  });\r\n\r\n  // Double-click to edit card or flip image card\r\n  stage.on('dblclick dbltap', async (e) => {\r\n    const target = e.target;\r\n    if (target.parent && target.parent.getAttr('cardId')) {\r\n      const cardId = target.parent.getAttr('cardId');\r\n\r\n      // Get card data to check if it's an image card\r\n      const cards = await getAllCards();\r\n      const card = cards.find(c => c.id === cardId);\r\n\r\n      if (!card) return;\r\n\r\n      if (card.image) {\r\n        // Image card: always flip on double-click (toggle)\r\n        await flipCard(cardId);\r\n      } else {\r\n        // Text card: open edit dialog\r\n        openEditDialog(cardId);\r\n      }\r\n    } else if (target === stage) {\r\n      // Only create card if user hasn't been panning\r\n      if (!stageTouchHasMoved) {\r\n        // Double-click on canvas to create new card\r\n        const pointer = stage.getPointerPosition();\r\n        const scale = stage.scaleX();\r\n        const position = {\r\n          x: (pointer.x - stage.x()) / scale,\r\n          y: (pointer.y - stage.y()) / scale\r\n        };\r\n        createNewCard(position);\r\n      }\r\n      // Reset movement flag after double-tap check\r\n      stageTouchHasMoved = false;\r\n    }\r\n  });\r\n\r\n  // Touch long-press on empty canvas to paste image\r\n  let stageTouchTimer = null;\r\n  let stageTouchStart = null;\r\n  let stageTouchStartPos = null;\r\n  let stageTouchHasMoved = false;\r\n  let lastCenter = null;\r\n  let lastDist = 0;\r\n  let isTouchPanning = false;\r\n\r\n  function getDistance(p1, p2) {\r\n    return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\r\n  }\r\n\r\n  function getCenter(p1, p2) {\r\n    return {\r\n      x: (p1.x + p2.x) / 2,\r\n      y: (p1.y + p2.y) / 2\r\n    };\r\n  }\r\n\r\n  stage.on('touchstart', (e) => {\r\n    const touch1 = e.evt.touches[0];\r\n    const touch2 = e.evt.touches[1];\r\n\r\n    // Reset movement tracking\r\n    stageTouchHasMoved = false;\r\n    stageTouchStartPos = touch1 ? { x: touch1.clientX, y: touch1.clientY } : null;\r\n\r\n    if (touch1 && touch2) {\r\n      // Two fingers - prepare for pinch/pan\r\n      e.evt.preventDefault();\r\n      isTouchPanning = false;\r\n      stage.draggable(false);\r\n      lastCenter = getCenter(\r\n        { x: touch1.clientX, y: touch1.clientY },\r\n        { x: touch2.clientX, y: touch2.clientY }\r\n      );\r\n      lastDist = getDistance(\r\n        { x: touch1.clientX, y: touch1.clientY },\r\n        { x: touch2.clientX, y: touch2.clientY }\r\n      );\r\n      return;\r\n    }\r\n\r\n    // Single finger on empty canvas - enable panning\r\n    if (e.target === stage) {\r\n      isTouchPanning = true;\r\n      stage.draggable(true);\r\n    }\r\n\r\n    if (e.target !== stage) return; // Only on empty canvas\r\n\r\n    stageTouchStart = Date.now();\r\n\r\n    stageTouchTimer = setTimeout(async () => {\r\n      // Only show paste menu if user hasn't moved (not panning)\r\n      if (!stageTouchHasMoved) {\r\n        const pointer = stage.getPointerPosition();\r\n        const scale = stage.scaleX();\r\n        const position = {\r\n          x: (pointer.x - stage.x()) / scale,\r\n          y: (pointer.y - stage.y()) / scale\r\n        };\r\n\r\n        // Show paste menu\r\n        await showTouchPasteMenu(e.evt.touches ? e.evt.touches[0].clientX : e.evt.clientX,\r\n                                 e.evt.touches ? e.evt.touches[0].clientY : e.evt.clientY,\r\n                                 position);\r\n      }\r\n      stageTouchTimer = null;\r\n    }, 600); // 600ms long press\r\n  });\r\n\r\n  stage.on('touchmove', (e) => {\r\n    const touch1 = e.evt.touches[0];\r\n    const touch2 = e.evt.touches[1];\r\n\r\n    // Track if user has moved (for detecting panning vs tap)\r\n    if (touch1 && stageTouchStartPos) {\r\n      const moveDistance = Math.sqrt(\r\n        Math.pow(touch1.clientX - stageTouchStartPos.x, 2) +\r\n        Math.pow(touch1.clientY - stageTouchStartPos.y, 2)\r\n      );\r\n      if (moveDistance > 10) { // 10px threshold\r\n        stageTouchHasMoved = true;\r\n      }\r\n    }\r\n\r\n    if (touch1 && touch2) {\r\n      // Two fingers - pinch to zoom and pan\r\n      e.evt.preventDefault();\r\n      stageTouchHasMoved = true; // Mark as moved for two-finger gestures\r\n\r\n      if (stageTouchTimer) {\r\n        clearTimeout(stageTouchTimer);\r\n        stageTouchTimer = null;\r\n      }\r\n\r\n      const newCenter = getCenter(\r\n        { x: touch1.clientX, y: touch1.clientY },\r\n        { x: touch2.clientX, y: touch2.clientY }\r\n      );\r\n      const newDist = getDistance(\r\n        { x: touch1.clientX, y: touch1.clientY },\r\n        { x: touch2.clientX, y: touch2.clientY }\r\n      );\r\n\r\n      const oldScale = stage.scaleX();\r\n      const pointTo = {\r\n        x: (newCenter.x - stage.x()) / oldScale,\r\n        y: (newCenter.y - stage.y()) / oldScale\r\n      };\r\n\r\n      // Zoom\r\n      const scale = Math.max(0.1, Math.min(5, oldScale * (newDist / lastDist)));\r\n      stage.scale({ x: scale, y: scale });\r\n\r\n      // Pan\r\n      const dx = newCenter.x - lastCenter.x;\r\n      const dy = newCenter.y - lastCenter.y;\r\n      const newPos = {\r\n        x: newCenter.x - pointTo.x * scale + dx,\r\n        y: newCenter.y - pointTo.y * scale + dy\r\n      };\r\n\r\n      stage.position(newPos);\r\n      stage.batchDraw();\r\n\r\n      lastDist = newDist;\r\n      lastCenter = newCenter;\r\n      return;\r\n    }\r\n\r\n    // Cancel long-press timer if user is moving (panning)\r\n    if (stageTouchTimer && stageTouchHasMoved) {\r\n      clearTimeout(stageTouchTimer);\r\n      stageTouchTimer = null;\r\n    }\r\n  });\r\n\r\n  stage.on('touchend touchcancel', (e) => {\r\n    if (stageTouchTimer) {\r\n      clearTimeout(stageTouchTimer);\r\n      stageTouchTimer = null;\r\n    }\r\n    if (isTouchPanning) {\r\n      stage.draggable(false);\r\n      isTouchPanning = false;\r\n    }\r\n    lastCenter = null;\r\n    lastDist = 0;\r\n\r\n    // Reset movement tracking\r\n    stageTouchStartPos = null;\r\n    // Note: Don't reset stageTouchHasMoved here - it's needed for dbltap check\r\n  });\r\n\r\n  // Track if 'g' key is currently held down for simultaneous combos\r\n  let gKeyHeld = false;\r\n\r\n  // Global keyboard shortcuts\r\n  window.addEventListener('keydown', async (e) => {\r\n    // Ignore if typing in input/textarea\r\n    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {\r\n      return;\r\n    }\r\n\r\n    // Ctrl+Z - Undo\r\n    if (e.ctrlKey && e.key === 'z') {\r\n      e.preventDefault();\r\n      await undo();\r\n      return;\r\n    }\r\n\r\n    // Ctrl+Y - Redo\r\n    if (e.ctrlKey && e.key === 'y') {\r\n      e.preventDefault();\r\n      await redo();\r\n      return;\r\n    }\r\n\r\n    // Ctrl+C - Copy selected cards\r\n    if (e.ctrlKey && e.key === 'c') {\r\n      e.preventDefault();\r\n      await copySelectedCards();\r\n      return;\r\n    }\r\n\r\n    // Ctrl+Shift+V - Paste image from clipboard\r\n    if (e.ctrlKey && e.shiftKey && e.key === 'V') {\r\n      e.preventDefault();\r\n      await pasteImageFromClipboard();\r\n      return;\r\n    }\r\n\r\n    // Ctrl+V - Paste copied cards\r\n    if (e.ctrlKey && e.key === 'v') {\r\n      e.preventDefault();\r\n      await pasteCards();\r\n      return;\r\n    }\r\n\r\n    // Ctrl+A - Select all cards\r\n    if (e.ctrlKey && e.key === 'a') {\r\n      e.preventDefault();\r\n      const allCards = layer.getChildren(node => node.getAttr('cardId'));\r\n      allCards.forEach(group => {\r\n        const background = group.findOne('Rect');\r\n        group.addName('selected');\r\n        if (background) {\r\n          background.stroke('#2196F3');\r\n          background.strokeWidth(3);\r\n        }\r\n      });\r\n      layer.batchDraw();\r\n      return;\r\n    }\r\n\r\n    // S - Save (export)\r\n    if (e.key === 's' && !e.ctrlKey) {\r\n      e.preventDefault();\r\n      await exportCanvas();\r\n      console.log('Canvas exported');\r\n      return;\r\n    }\r\n\r\n    // L - Load (import JSON)\r\n    if (e.key === 'l' && !e.ctrlKey) {\r\n      e.preventDefault();\r\n      await importCanvas();\r\n      console.log('Canvas import initiated');\r\n      return;\r\n    }\r\n\r\n    // B - Backup (download zip with all cards and images)\r\n    if (e.key === 'b' && !e.ctrlKey) {\r\n      e.preventDefault();\r\n      const downloadBtn = document.getElementById('btn-download');\r\n      if (downloadBtn) {\r\n        downloadBtn.click();\r\n        console.log('Backup download initiated');\r\n      }\r\n      return;\r\n    }\r\n\r\n    // K - Toggle view\r\n    if (e.key === 'k') {\r\n      e.preventDefault();\r\n      toggleViewFromMenu();\r\n      return;\r\n    }\r\n\r\n    // N - New text card\r\n    if (e.key === 'n') {\r\n      e.preventDefault();\r\n      const pointer = stage.getPointerPosition() || { x: stage.width() / 2, y: stage.height() / 2 };\r\n      const scale = stage.scaleX();\r\n      const position = {\r\n        x: (pointer.x - stage.x()) / scale,\r\n        y: (pointer.y - stage.y()) / scale\r\n      };\r\n      await createNewCard(position);\r\n      return;\r\n    }\r\n\r\n    // I - Import image\r\n    if (e.key === 'i') {\r\n      e.preventDefault();\r\n      await importImage();\r\n      return;\r\n    }\r\n\r\n    // F - Focus search\r\n    if (e.key === 'f') {\r\n      e.preventDefault();\r\n      const searchInput = document.getElementById('search-input');\r\n      if (searchInput) {\r\n        searchInput.focus();\r\n        searchInput.select();\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Space - Command palette\r\n    if (e.key === ' ') {\r\n      e.preventDefault();\r\n      showCommandPalette();\r\n      return;\r\n    }\r\n\r\n    // V - Vertical arrangement (or G+V if 'g' is held)\r\n    if (e.key === 'v' && !e.ctrlKey) {\r\n      e.preventDefault();\r\n      if (gKeyHeld) {\r\n        // G+V = Grid Vertical\r\n        console.log('G+V pressed (simultaneous)');\r\n        if (clipboard.length > 0) {\r\n          await pasteCardsWithArrangement(arrangeGridVertical, 'Grid Vertical');\r\n        } else {\r\n          await applyArrangement(arrangeGridVertical, 'Grid Vertical');\r\n        }\r\n      } else {\r\n        // V alone = Vertical\r\n        console.log('V pressed');\r\n        await applyArrangement(arrangeVertical, 'Vertical');\r\n      }\r\n      return;\r\n    }\r\n\r\n    // H - Horizontal arrangement (or G+H if 'g' is held)\r\n    if (e.key === 'h' && !e.ctrlKey) {\r\n      e.preventDefault();\r\n      if (gKeyHeld) {\r\n        // G+H = Grid Horizontal\r\n        console.log('G+H pressed (simultaneous)');\r\n        await applyArrangement(arrangeGridHorizontal, 'Grid Horizontal');\r\n      } else {\r\n        // H alone = Horizontal\r\n        console.log('H pressed');\r\n        await applyArrangement(arrangeHorizontal, 'Horizontal');\r\n      }\r\n      return;\r\n    }\r\n\r\n    // T - Grid Top-Aligned (only when G is held)\r\n    if (e.key === 't' && !e.ctrlKey && gKeyHeld) {\r\n      e.preventDefault();\r\n      console.log('G+T pressed (simultaneous)');\r\n      await applyArrangement(arrangeGridTopAligned, 'Grid Top-Aligned');\r\n      return;\r\n    }\r\n\r\n    // G - Set flag for combos (G+V, G+H, G+T)\r\n    if (e.key === 'g' && !e.ctrlKey) {\r\n      e.preventDefault();\r\n      gKeyHeld = true;\r\n      console.log('G pressed (waiting for combo)');\r\n      return;\r\n    }\r\n\r\n    // Q - Paste and arrange in cluster (if clipboard has cards), otherwise arrange selected\r\n    if (e.key === 'q' && !e.ctrlKey) {\r\n      e.preventDefault();\r\n      if (clipboard.length > 0) {\r\n        await pasteCardsWithArrangement(arrangeCluster, 'Cluster');\r\n      } else {\r\n        await applyArrangement(arrangeCluster, 'Cluster');\r\n      }\r\n      return;\r\n    }\r\n\r\n    // P - Toggle pin/unpin selected cards\r\n    if (e.key === 'p' && !e.ctrlKey) {\r\n      e.preventDefault();\r\n      await togglePinSelectedCards();\r\n      return;\r\n    }\r\n\r\n    // Delete/Backspace - Delete selected cards\r\n    if (e.key === 'Delete' || e.key === 'Backspace') {\r\n      e.preventDefault();\r\n      const selectedNodes = layer.find('.selected');\r\n      for (const node of selectedNodes) {\r\n        if (node.getAttr('cardId')) {\r\n          const cardId = node.getAttr('cardId');\r\n          await handleDeleteCard(cardId);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n  });\r\n\r\n  // Reset gKeyHeld flag when 'g' is released\r\n  window.addEventListener('keyup', (e) => {\r\n    if (e.key === 'g') {\r\n      gKeyHeld = false;\r\n      console.log('G released');\r\n    }\r\n  });\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 8: PUBLIC API (Exported Functions)\r\n// ============================================================================\r\n\r\n/**\r\n * Get stage instance\r\n */\r\nexport function getStage() {\r\n  return stage;\r\n}\r\n\r\n/**\r\n * Get main layer\r\n */\r\nexport function getLayer() {\r\n  return layer;\r\n}\r\n\r\n/**\r\n * Add new card (exported for external use)\r\n */\r\nexport async function addNewCard() {\r\n  const pointer = stage.getPointerPosition() || { x: stage.width() / 2, y: stage.height() / 2 };\r\n  const scale = stage.scaleX();\r\n  const position = {\r\n    x: (pointer.x - stage.x()) / scale,\r\n    y: (pointer.y - stage.y()) / scale\r\n  };\r\n\r\n  await createNewCard(position);\r\n}\r\n\r\n/**\r\n * Export canvas state as JSON\r\n */\r\nexport async function exportCanvas() {\r\n  const cards = await getAllCards();\r\n  const exportData = {\r\n    type: 'full',\r\n    version: '1.0',\r\n    exportedAt: Date.now(),\r\n    cards,\r\n    viewport: {\r\n      x: stage.x(),\r\n      y: stage.y(),\r\n      scale: stage.scaleX()\r\n    }\r\n  };\r\n\r\n  const json = JSON.stringify(exportData, null, 2);\r\n  const blob = new Blob([json], { type: 'application/json' });\r\n  const url = URL.createObjectURL(blob);\r\n\r\n  const a = document.createElement('a');\r\n  a.href = url;\r\n  a.download = `spatial-view-${Date.now()}.json`;\r\n  a.click();\r\n\r\n  URL.revokeObjectURL(url);\r\n}\r\n\r\n/**\r\n * Import canvas from JSON file\r\n */\r\nexport async function importCanvas() {\r\n  return new Promise((resolve, reject) => {\r\n    const input = document.createElement('input');\r\n    input.type = 'file';\r\n    input.accept = 'application/json,.json';\r\n\r\n    input.onchange = async (e) => {\r\n      const file = e.target.files[0];\r\n      if (!file) {\r\n        resolve(null);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const text = await file.text();\r\n        const data = JSON.parse(text);\r\n\r\n        // Import cards\r\n        const { createCard } = await import('./storage.js');\r\n\r\n        if (data.cards && Array.isArray(data.cards)) {\r\n          for (let i = 0; i < data.cards.length; i++) {\r\n            const card = data.cards[i];\r\n            // Create each card in storage (without the id to avoid conflicts)\r\n            const { id, ...cardWithoutId } = card;\r\n\r\n            // Add import metadata\r\n            await createCard(cardWithoutId, {\r\n              imported: true,\r\n              importedAt: new Date().toISOString(),\r\n              importedFrom: file.name,\r\n              importBatchIndex: i\r\n            });\r\n          }\r\n\r\n          // Reload canvas to show imported cards\r\n          await reloadCanvas();\r\n\r\n          // Restore viewport if available\r\n          if (data.viewport) {\r\n            stage.position({ x: data.viewport.x, y: data.viewport.y });\r\n            stage.scale({ x: data.viewport.scale, y: data.viewport.scale });\r\n            stage.batchDraw();\r\n          }\r\n\r\n          console.log(`Imported ${data.cards.length} cards`);\r\n          alert(`Importerade ${data.cards.length} kort!`);\r\n          resolve(data.cards.length);\r\n        } else {\r\n          throw new Error('Invalid JSON format');\r\n        }\r\n      } catch (error) {\r\n        console.error('Import failed:', error);\r\n        alert('Misslyckades att importera fil: ' + error.message);\r\n        reject(error);\r\n      }\r\n    };\r\n\r\n    input.click();\r\n  });\r\n}\r\n\r\n/**\r\n * Import image and create card\r\n */\r\nexport async function importImage() {\r\n  return new Promise((resolve, reject) => {\r\n    // Create file input\r\n    const input = document.createElement('input');\r\n    input.type = 'file';\r\n    input.accept = 'image/*';\r\n    input.multiple = true;\r\n\r\n    // Check if mobile device for camera option\r\n    const isMobile = /mobile|android|iphone|ipad|ipod/i.test(navigator.userAgent);\r\n    if (isMobile) {\r\n      input.capture = 'environment'; // Use rear camera\r\n    }\r\n\r\n    input.onchange = async (e) => {\r\n      const files = Array.from(e.target.files);\r\n      if (files.length === 0) {\r\n        resolve([]);\r\n        return;\r\n      }\r\n\r\n      // Show quality selector dialog AFTER files are chosen\r\n      const quality = await showQualityDialog(files.length);\r\n      if (!quality) {\r\n        resolve([]);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const cardIds = [];\r\n\r\n        for (const file of files) {\r\n          // Process image\r\n          const processed = await processImage(file, quality);\r\n\r\n          // Calculate position (stagger multiple images)\r\n          const pointer = stage.getPointerPosition() || { x: stage.width() / 2, y: stage.height() / 2 };\r\n          const scale = stage.scaleX();\r\n          const offset = cardIds.length * 50; // Stagger by 50px\r\n          const position = {\r\n            x: ((pointer.x - stage.x()) / scale) + offset,\r\n            y: ((pointer.y - stage.y()) / scale) + offset\r\n          };\r\n\r\n          // Create card with image\r\n          const cardId = await createCard({\r\n            text: processed.metadata.fileName,\r\n            tags: ['bild'],\r\n            position,\r\n            image: {\r\n              base64: processed.base64,\r\n              width: processed.metadata.width,\r\n              height: processed.metadata.height,\r\n              quality: processed.metadata.quality\r\n            },\r\n            metadata: processed.metadata\r\n          });\r\n\r\n          cardIds.push(cardId);\r\n        }\r\n\r\n        // Reload canvas to show new cards\r\n        await reloadCanvas();\r\n\r\n        resolve(cardIds);\r\n      } catch (error) {\r\n        console.error('Image import failed:', error);\r\n        reject(error);\r\n      }\r\n    };\r\n\r\n    input.click();\r\n  });\r\n}\r\n\r\n/**\r\n * Paste image from system clipboard (e.g. screenshot)\r\n */\r\nasync function pasteImageFromClipboard() {\r\n  try {\r\n    // Check if Clipboard API is available\r\n    if (!navigator.clipboard || !navigator.clipboard.read) {\r\n      alert('Clipboard API stds inte i denna webblsare. Anvnd \"Importera bild\" istllet.');\r\n      return;\r\n    }\r\n\r\n    const clipboardItems = await navigator.clipboard.read();\r\n    let imageFound = false;\r\n\r\n    for (const clipboardItem of clipboardItems) {\r\n      for (const type of clipboardItem.types) {\r\n        if (type.startsWith('image/')) {\r\n          imageFound = true;\r\n          const blob = await clipboardItem.getType(type);\r\n\r\n          // Convert blob to file\r\n          const file = new File([blob], 'clipboard-image.png', { type: blob.type });\r\n\r\n          // Show quality selector dialog\r\n          const quality = await showQualityDialog(1);\r\n          if (!quality) return;\r\n\r\n          // Process image\r\n          const processed = await processImage(file, quality);\r\n\r\n          // Calculate position at center or mouse position\r\n          const pointer = stage.getPointerPosition() || { x: stage.width() / 2, y: stage.height() / 2 };\r\n          const scale = stage.scaleX();\r\n          const position = {\r\n            x: (pointer.x - stage.x()) / scale,\r\n            y: (pointer.y - stage.y()) / scale\r\n          };\r\n\r\n          // Create card with image\r\n          await createCard({\r\n            text: 'Inklistrad bild',\r\n            tags: ['bild', 'clipboard'],\r\n            position,\r\n            image: {\r\n              base64: processed.base64,\r\n              width: processed.metadata.width,\r\n              height: processed.metadata.height,\r\n              quality: processed.metadata.quality\r\n            },\r\n            metadata: {\r\n              ...processed.metadata,\r\n              fileName: 'clipboard-image.png',\r\n              source: 'clipboard'\r\n            }\r\n          });\r\n\r\n          await reloadCanvas();\r\n          console.log('Image pasted from clipboard');\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!imageFound) {\r\n      alert('Ingen bild hittades i clipboard. Kopiera en bild eller skrmdump frst.');\r\n    }\r\n\r\n  } catch (error) {\r\n    console.error('Failed to paste from clipboard:', error);\r\n    if (error.name === 'NotAllowedError') {\r\n      alert('Tillgng till clipboard nekades. Ge webblsaren tillstnd att lsa clipboard.');\r\n    } else {\r\n      alert('Kunde inte klistra in bild frn clipboard: ' + error.message);\r\n    }\r\n  }\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 9: UI DIALOGS (Command Palette, Quality Dialog, Text Input)\r\n// ============================================================================\r\n\r\n/**\r\n * Show command palette\r\n */\r\nfunction showCommandPalette() {\r\n  const commands = [\r\n    { key: 'N', icon: '', name: 'Nytt text-kort', desc: 'Skapa nytt text-kort vid muspekare', action: async () => {\r\n      const pointer = stage.getPointerPosition() || { x: stage.width() / 2, y: stage.height() / 2 };\r\n      const scale = stage.scaleX();\r\n      const position = {\r\n        x: (pointer.x - stage.x()) / scale,\r\n        y: (pointer.y - stage.y()) / scale\r\n      };\r\n      await createNewCard(position);\r\n    }},\r\n    { key: 'I', icon: '', name: 'Importera bild', desc: 'ppna filvljare fr att importera bilder', action: async () => {\r\n      await importImage();\r\n    }},\r\n    { key: 'Ctrl+Shift+V', icon: '', name: 'Klistra in bild', desc: 'Klistra in bild frn clipboard (t.ex. skrmdump)', action: async () => {\r\n      await pasteImageFromClipboard();\r\n    }},\r\n    { key: 'R', icon: '', name: 'Ls med AI', desc: 'Anvnd Gemini AI fr att lsa text frn markerade bildkort', action: async () => {\r\n      const selectedNodes = layer.find('.selected');\r\n      if (selectedNodes.length === 0) {\r\n        alert('Markera frst ett eller flera bildkort som du vill lsa med AI.');\r\n        return;\r\n      }\r\n\r\n      // Get all cards and filter only image cards\r\n      const allCards = await getAllCards();\r\n      const imageCardIds = [];\r\n\r\n      for (const node of selectedNodes) {\r\n        const cardId = node.getAttr('cardId');\r\n        if (cardId) {\r\n          const card = allCards.find(c => c.id === cardId);\r\n          if (card && card.image) {\r\n            imageCardIds.push(cardId);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (imageCardIds.length === 0) {\r\n        alert('Inga bildkort r markerade. Endast bildkort kan lsas med AI.');\r\n        return;\r\n      }\r\n\r\n      // Process each card\r\n      for (const cardId of imageCardIds) {\r\n        await readImageWithGemini(cardId);\r\n      }\r\n    }},\r\n    { key: 'F', icon: '', name: 'Sk kort', desc: 'Fokusera skfltet', action: () => {\r\n      const searchInput = document.getElementById('search-input');\r\n      if (searchInput) {\r\n        searchInput.focus();\r\n        searchInput.select();\r\n      }\r\n    }},\r\n    { key: 'S', icon: '', name: 'Exportera', desc: 'Exportera canvas till JSON-fil', action: async () => {\r\n      await exportCanvas();\r\n    }},\r\n    { key: 'L', icon: '', name: 'Importera JSON', desc: 'Importera kort frn JSON-fil', action: async () => {\r\n      await importCanvas();\r\n    }},\r\n    { key: 'B', icon: '', name: 'Ladda ner backup', desc: 'Ladda ner alla kort och bilder som zip-fil', action: async () => {\r\n      // Trigger download from main.js\r\n      const downloadBtn = document.getElementById('btn-download');\r\n      if (downloadBtn) {\r\n        downloadBtn.click();\r\n      }\r\n    }},\r\n    { key: 'Delete', icon: '', name: 'Ta bort kort', desc: 'Ta bort markerade kort', action: async () => {\r\n      const selectedNodes = layer.find('.selected');\r\n      for (const node of selectedNodes) {\r\n        if (node.getAttr('cardId')) {\r\n          const cardId = node.getAttr('cardId');\r\n          await handleDeleteCard(cardId);\r\n        }\r\n      }\r\n    }},\r\n    { key: 'Ctrl+Z', icon: '', name: 'ngra', desc: 'ngra senaste ndring', action: async () => {\r\n      await undo();\r\n    }},\r\n    { key: 'Ctrl+Y', icon: '', name: 'Gr om', desc: 'Gr om ngrad ndring', action: async () => {\r\n      await redo();\r\n    }},\r\n    { key: 'Ctrl+C', icon: '', name: 'Kopiera kort', desc: 'Kopiera markerade kort till clipboard', action: async () => {\r\n      await copySelectedCards();\r\n    }},\r\n    { key: 'Ctrl+V', icon: '', name: 'Klistra in kort', desc: 'Klistra in kopierade kort', action: async () => {\r\n      await pasteCards();\r\n    }},\r\n    { key: 'P', icon: '', name: 'Pinna/Avpinna kort', desc: 'Pinna eller avpinna markerade kort (kan inte flyttas)', action: async () => {\r\n      await togglePinSelectedCards();\r\n    }},\r\n    { key: 'V', icon: '', name: 'Arrangera vertikalt', desc: 'Arrangera markerade kort i vertikal kolumn', action: async () => {\r\n      await applyArrangement(arrangeVertical, 'Vertical');\r\n    }},\r\n    { key: 'H', icon: '', name: 'Arrangera horisontellt', desc: 'Arrangera markerade kort i horisontell rad', action: async () => {\r\n      await applyArrangement(arrangeHorizontal, 'Horizontal');\r\n    }},\r\n    { key: 'Q', icon: '', name: 'Arrangera cirkel', desc: 'Klistra in och arrangera i cirkel (om kopierade kort), annars arrangera markerade', action: async () => {\r\n      if (clipboard.length > 0) {\r\n        await pasteCardsWithArrangement(arrangeCluster, 'Cluster');\r\n      } else {\r\n        await applyArrangement(arrangeCluster, 'Cluster');\r\n      }\r\n    }},\r\n    { key: 'G+V', icon: '', name: 'Arrangera grid vertikalt', desc: 'Klistra in och arrangera vertikalt (om kopierade kort), annars arrangera markerade', action: async () => {\r\n      if (clipboard.length > 0) {\r\n        await pasteCardsWithArrangement(arrangeGridVertical, 'Grid Vertical');\r\n      } else {\r\n        await applyArrangement(arrangeGridVertical, 'Grid Vertical');\r\n      }\r\n    }},\r\n    { key: 'G+H', icon: '', name: 'Arrangera grid horisontellt', desc: 'Arrangera markerade kort i horisontella rader', action: async () => {\r\n      await applyArrangement(arrangeGridHorizontal, 'Grid Horizontal');\r\n    }},\r\n    { key: 'G+T', icon: '', name: 'Arrangera grid verlappande', desc: 'Arrangera markerade kort verlappande (Kanban-stil)', action: async () => {\r\n      await applyArrangement(arrangeGridTopAligned, 'Grid Top-Aligned');\r\n    }},\r\n    { key: '-', icon: '', name: 'Byt tema', desc: 'Vxla mellan ljust/mrkt/e-ink tema', action: () => {\r\n      window.dispatchEvent(new CustomEvent('toggleTheme'));\r\n    }},\r\n    { key: '-', icon: '', name: 'Byt vy', desc: 'Vxla mellan brd-vy och kolumn-vy', action: () => {\r\n      window.dispatchEvent(new CustomEvent('toggleView'));\r\n    }},\r\n    { key: 'Ctrl+A', icon: '', name: 'Markera alla', desc: 'Markera alla kort p canvas', action: () => {\r\n      const isEink = document.body.classList.contains('eink-theme');\r\n      const allCards = layer.getChildren(node => node.getAttr('cardId'));\r\n      allCards.forEach(group => {\r\n        const background = group.findOne('Rect');\r\n        group.addName('selected');\r\n        if (background) {\r\n          if (isEink) {\r\n            background.stroke('#000000');\r\n            background.strokeWidth(4);\r\n          } else {\r\n            background.stroke('#2196F3');\r\n            background.strokeWidth(3);\r\n          }\r\n        }\r\n      });\r\n      layer.batchDraw();\r\n    }},\r\n    { key: 'Scroll', icon: '', name: 'Zooma', desc: 'Zooma in/ut med mushjulet', action: null },\r\n    { key: 'Ctrl+Drag', icon: '', name: 'Panorera', desc: 'Panorera canvas genom att hlla Ctrl och dra', action: null },\r\n    { key: 'Double-click', icon: '', name: 'Redigera kort', desc: 'Dubbelklicka p kort fr att redigera', action: null },\r\n    { key: 'Right-click', icon: '', name: 'Kontextmeny', desc: 'Hgerklicka p kort fr meny', action: null },\r\n    { key: 'Drag', icon: '', name: 'Flytta kort', desc: 'Dra kort fr att flytta dem', action: null },\r\n  ];\r\n\r\n  // Create modal overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.7);\r\n    display: flex;\r\n    align-items: flex-start;\r\n    justify-content: center;\r\n    z-index: 10000;\r\n    padding-top: 80px;\r\n    overflow-y: auto;\r\n  `;\r\n\r\n  // Create command palette\r\n  const palette = document.createElement('div');\r\n  palette.style.cssText = `\r\n    background: white;\r\n    border-radius: 12px;\r\n    padding: 24px;\r\n    max-width: 600px;\r\n    width: 90%;\r\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\r\n    max-height: 80vh;\r\n    overflow-y: auto;\r\n  `;\r\n\r\n  // Function to render command list\r\n  const renderCommands = (filteredCommands) => {\r\n    const commandList = palette.querySelector('#command-list');\r\n    commandList.innerHTML = filteredCommands.map((cmd, idx) => `\r\n      <div class=\"command-item\" data-original-index=\"${cmd.originalIndex}\" style=\"\r\n        padding: 16px;\r\n        background: ${cmd.action ? '#f5f5f5' : '#fafafa'};\r\n        border-radius: 8px;\r\n        cursor: ${cmd.action ? 'pointer' : 'default'};\r\n        transition: all 0.15s;\r\n        border: 2px solid transparent;\r\n        display: flex;\r\n        align-items: center;\r\n        gap: 16px;\r\n      \">\r\n        <div style=\"font-size: 24px; flex-shrink: 0;\">\r\n          ${cmd.icon}\r\n        </div>\r\n        <div style=\"flex: 1; min-width: 0;\">\r\n          <div style=\"font-weight: 600; font-size: 16px; color: #1a1a1a; margin-bottom: 2px;\">\r\n            ${cmd.name}\r\n          </div>\r\n          <div style=\"font-size: 13px; color: #666;\">\r\n            ${cmd.desc}\r\n          </div>\r\n        </div>\r\n        <div style=\"\r\n          background: white;\r\n          padding: 6px 12px;\r\n          border-radius: 6px;\r\n          font-size: 12px;\r\n          font-weight: 600;\r\n          color: #666;\r\n          font-family: monospace;\r\n          white-space: nowrap;\r\n          flex-shrink: 0;\r\n        \">\r\n          ${cmd.key}\r\n        </div>\r\n      </div>\r\n    `).join('');\r\n\r\n    // Add hover and click effects\r\n    const commandItems = commandList.querySelectorAll('.command-item');\r\n    commandItems.forEach((item) => {\r\n      const originalIdx = parseInt(item.dataset.originalIndex);\r\n      const cmd = commands[originalIdx];\r\n\r\n      if (cmd.action) {\r\n        item.addEventListener('mouseenter', () => {\r\n          item.style.background = '#e3f2fd';\r\n          item.style.borderColor = '#2196F3';\r\n          item.style.transform = 'scale(1.01)';\r\n        });\r\n\r\n        item.addEventListener('mouseleave', () => {\r\n          item.style.background = '#f5f5f5';\r\n          item.style.borderColor = 'transparent';\r\n          item.style.transform = 'scale(1)';\r\n        });\r\n\r\n        item.addEventListener('click', async () => {\r\n          cleanup();\r\n          await cmd.action();\r\n        });\r\n      }\r\n    });\r\n  };\r\n\r\n  palette.innerHTML = `\r\n    <div style=\"display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;\">\r\n      <h2 style=\"margin: 0; font-size: 24px; color: #1a1a1a;\">\r\n         Command Palette\r\n      </h2>\r\n      <span style=\"color: #999; font-size: 14px;\">Tryck ESC fr att stnga</span>\r\n    </div>\r\n\r\n    <input\r\n      type=\"text\"\r\n      id=\"command-search\"\r\n      placeholder=\"Sk kommandon...\"\r\n      style=\"\r\n        width: 100%;\r\n        padding: 12px 16px;\r\n        border: 2px solid #e0e0e0;\r\n        border-radius: 8px;\r\n        font-size: 16px;\r\n        margin-bottom: 16px;\r\n        outline: none;\r\n        transition: border-color 0.15s;\r\n      \"\r\n    />\r\n\r\n    <div id=\"command-list\" style=\"display: flex; flex-direction: column; gap: 8px;\">\r\n    </div>\r\n  `;\r\n\r\n  overlay.appendChild(palette);\r\n  document.body.appendChild(overlay);\r\n\r\n  // Add commands with original index for tracking\r\n  const commandsWithIndex = commands.map((cmd, idx) => ({ ...cmd, originalIndex: idx }));\r\n\r\n  // Initial render with all commands\r\n  renderCommands(commandsWithIndex);\r\n\r\n  // Add search functionality\r\n  const searchInput = palette.querySelector('#command-search');\r\n  searchInput.addEventListener('input', (e) => {\r\n    const query = e.target.value.toLowerCase().trim();\r\n\r\n    if (!query) {\r\n      renderCommands(commandsWithIndex);\r\n      return;\r\n    }\r\n\r\n    const filtered = commandsWithIndex.filter(cmd =>\r\n      cmd.name.toLowerCase().includes(query) ||\r\n      cmd.desc.toLowerCase().includes(query) ||\r\n      cmd.key.toLowerCase().includes(query)\r\n    );\r\n\r\n    renderCommands(filtered);\r\n  });\r\n\r\n  // Focus search input\r\n  searchInput.focus();\r\n\r\n  // Handle focus on border\r\n  searchInput.addEventListener('focus', () => {\r\n    searchInput.style.borderColor = '#2196F3';\r\n  });\r\n  searchInput.addEventListener('blur', () => {\r\n    searchInput.style.borderColor = '#e0e0e0';\r\n  });\r\n\r\n  // Cleanup function\r\n  const cleanup = () => {\r\n    document.body.removeChild(overlay);\r\n  };\r\n\r\n  // ESC to close\r\n  const handleEsc = (e) => {\r\n    if (e.key === 'Escape') {\r\n      cleanup();\r\n      document.removeEventListener('keydown', handleEsc);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', handleEsc);\r\n\r\n  // Click overlay to close\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      cleanup();\r\n      document.removeEventListener('keydown', handleEsc);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Show quality selector dialog\r\n */\r\nfunction showQualityDialog(fileCount) {\r\n  return new Promise((resolve) => {\r\n    // Create modal overlay\r\n    const overlay = document.createElement('div');\r\n    overlay.style.cssText = `\r\n      position: fixed;\r\n      top: 0;\r\n      left: 0;\r\n      right: 0;\r\n      bottom: 0;\r\n      background: rgba(0, 0, 0, 0.5);\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      z-index: 10000;\r\n    `;\r\n\r\n    // Create dialog\r\n    const dialog = document.createElement('div');\r\n    dialog.style.cssText = `\r\n      background: white;\r\n      border-radius: 12px;\r\n      padding: 32px;\r\n      max-width: 500px;\r\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\r\n    `;\r\n\r\n    dialog.innerHTML = `\r\n      <h2 style=\"margin: 0 0 16px 0; font-size: 24px; color: #1a1a1a;\">\r\n        Vlj kvalitet\r\n      </h2>\r\n      <p style=\"margin: 0 0 24px 0; color: #666; font-size: 16px;\">\r\n        ${fileCount} ${fileCount === 1 ? 'bild vald' : 'bilder valda'}\r\n      </p>\r\n\r\n      <div style=\"display: flex; flex-direction: column; gap: 12px;\">\r\n        <button id=\"quality-normal\" style=\"\r\n          padding: 20px;\r\n          background: #2196F3;\r\n          color: white;\r\n          border: none;\r\n          border-radius: 8px;\r\n          font-size: 16px;\r\n          font-weight: 600;\r\n          cursor: pointer;\r\n          text-align: left;\r\n          transition: transform 0.1s;\r\n        \">\r\n          <div style=\"font-size: 18px; margin-bottom: 4px;\"> Normal (rekommenderad)</div>\r\n          <div style=\"font-size: 14px; opacity: 0.9;\">900px, bra balans fr A7-kort</div>\r\n        </button>\r\n\r\n        <button id=\"quality-high\" style=\"\r\n          padding: 20px;\r\n          background: #FF9800;\r\n          color: white;\r\n          border: none;\r\n          border-radius: 8px;\r\n          font-size: 16px;\r\n          font-weight: 600;\r\n          cursor: pointer;\r\n          text-align: left;\r\n          transition: transform 0.1s;\r\n        \">\r\n          <div style=\"font-size: 18px; margin-bottom: 4px;\"> Hg (fr OCR)</div>\r\n          <div style=\"font-size: 14px; opacity: 0.9;\">1200px, bst fr AI-textigenknning</div>\r\n        </button>\r\n\r\n        <button id=\"quality-low\" style=\"\r\n          padding: 20px;\r\n          background: #4CAF50;\r\n          color: white;\r\n          border: none;\r\n          border-radius: 8px;\r\n          font-size: 16px;\r\n          font-weight: 600;\r\n          cursor: pointer;\r\n          text-align: left;\r\n          transition: transform 0.1s;\r\n        \">\r\n          <div style=\"font-size: 18px; margin-bottom: 4px;\"> Lg (snabbt)</div>\r\n          <div style=\"font-size: 14px; opacity: 0.9;\">600px, mindre filstorlek</div>\r\n        </button>\r\n\r\n        <button id=\"quality-original\" style=\"\r\n          padding: 20px;\r\n          background: #9C27B0;\r\n          color: white;\r\n          border: none;\r\n          border-radius: 8px;\r\n          font-size: 16px;\r\n          font-weight: 600;\r\n          cursor: pointer;\r\n          text-align: left;\r\n          transition: transform 0.1s;\r\n        \">\r\n          <div style=\"font-size: 18px; margin-bottom: 4px;\"> Original</div>\r\n          <div style=\"font-size: 14px; opacity: 0.9;\">Ingen komprimering - kan bli stort!</div>\r\n        </button>\r\n\r\n        <button id=\"quality-cancel\" style=\"\r\n          padding: 12px;\r\n          background: transparent;\r\n          color: #666;\r\n          border: none;\r\n          border-radius: 8px;\r\n          font-size: 14px;\r\n          cursor: pointer;\r\n        \">\r\n          Avbryt\r\n        </button>\r\n      </div>\r\n    `;\r\n\r\n    overlay.appendChild(dialog);\r\n    document.body.appendChild(overlay);\r\n\r\n    // Add hover effects\r\n    const buttons = dialog.querySelectorAll('button[id^=\"quality-\"]');\r\n    buttons.forEach(btn => {\r\n      if (btn.id !== 'quality-cancel') {\r\n        btn.addEventListener('mouseenter', () => {\r\n          btn.style.transform = 'scale(1.02)';\r\n        });\r\n        btn.addEventListener('mouseleave', () => {\r\n          btn.style.transform = 'scale(1)';\r\n        });\r\n      }\r\n    });\r\n\r\n    // Handle button clicks\r\n    const cleanup = (quality) => {\r\n      document.body.removeChild(overlay);\r\n      resolve(quality);\r\n    };\r\n\r\n    dialog.querySelector('#quality-high').addEventListener('click', () => cleanup('high'));\r\n    dialog.querySelector('#quality-normal').addEventListener('click', () => cleanup('normal'));\r\n    dialog.querySelector('#quality-low').addEventListener('click', () => cleanup('low'));\r\n    dialog.querySelector('#quality-original').addEventListener('click', () => cleanup('original'));\r\n    dialog.querySelector('#quality-cancel').addEventListener('click', () => cleanup(null));\r\n\r\n    // ESC to cancel\r\n    const handleEsc = (e) => {\r\n      if (e.key === 'Escape') {\r\n        cleanup(null);\r\n        document.removeEventListener('keydown', handleEsc);\r\n      }\r\n    };\r\n    document.addEventListener('keydown', handleEsc);\r\n  });\r\n}\r\n\r\n/**\r\n * Setup drag-and-drop for images\r\n */\r\nexport function setupImageDragDrop() {\r\n  const container = stage.container();\r\n\r\n  // Prevent default drag behavior\r\n  container.addEventListener('dragover', (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.style.border = '3px dashed #2196F3';\r\n  });\r\n\r\n  container.addEventListener('dragleave', (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.style.border = 'none';\r\n  });\r\n\r\n  // Handle drop\r\n  container.addEventListener('drop', async (e) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    container.style.border = 'none';\r\n\r\n    const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));\r\n\r\n    if (files.length === 0) return;\r\n\r\n    try {\r\n      // Show quality selector dialog\r\n      const quality = await showQualityDialog(files.length);\r\n      if (!quality) return;\r\n\r\n      for (const file of files) {\r\n        const processed = await processImage(file, quality);\r\n\r\n        // Get drop position\r\n        const pointer = stage.getPointerPosition();\r\n        const scale = stage.scaleX();\r\n        const position = {\r\n          x: (pointer.x - stage.x()) / scale,\r\n          y: (pointer.y - stage.y()) / scale\r\n        };\r\n\r\n        await createCard({\r\n          text: processed.metadata.fileName,\r\n          tags: ['bild'],\r\n          position,\r\n          image: {\r\n            base64: processed.base64,\r\n            width: processed.metadata.width,\r\n            height: processed.metadata.height,\r\n            quality: processed.metadata.quality\r\n          },\r\n          metadata: processed.metadata\r\n        });\r\n      }\r\n\r\n      await reloadCanvas();\r\n    } catch (error) {\r\n      console.error('Drag-drop import failed:', error);\r\n      alert('Misslyckades att importera bild: ' + error.message);\r\n    }\r\n  });\r\n\r\n  console.log('Drag-and-drop enabled for images');\r\n}\r\n\r\n/**\r\n * Fit all cards in view\r\n */\r\nexport function fitAllCards() {\r\n  // ALWAYS fit ALL cards (like v2's cy.fit(null, 50))\r\n  const cards = layer.getChildren().filter(node => node.getAttr('cardId'));\r\n\r\n  if (cards.length === 0) {\r\n    console.log('No cards to fit');\r\n    return;\r\n  }\r\n\r\n  // Calculate bounding box for all cards\r\n  let minX = Infinity;\r\n  let minY = Infinity;\r\n  let maxX = -Infinity;\r\n  let maxY = -Infinity;\r\n\r\n  cards.forEach(card => {\r\n    const box = card.getClientRect();\r\n    minX = Math.min(minX, box.x);\r\n    minY = Math.min(minY, box.y);\r\n    maxX = Math.max(maxX, box.x + box.width);\r\n    maxY = Math.max(maxY, box.y + box.height);\r\n  });\r\n\r\n  const contentWidth = maxX - minX;\r\n  const contentHeight = maxY - minY;\r\n\r\n  // Add fixed padding (50px like v2)\r\n  const padding = 50;\r\n  const paddedWidth = contentWidth + padding * 2;\r\n  const paddedHeight = contentHeight + padding * 2;\r\n\r\n  // Calculate scale to fit\r\n  const scaleX = stage.width() / paddedWidth;\r\n  const scaleY = stage.height() / paddedHeight;\r\n  const scale = Math.min(scaleX, scaleY, 1); // Don't zoom in beyond 1x\r\n\r\n  // Calculate center of content\r\n  const contentCenterX = minX + contentWidth / 2;\r\n  const contentCenterY = minY + contentHeight / 2;\r\n\r\n  // Set new scale\r\n  stage.scale({ x: scale, y: scale });\r\n\r\n  // Center the content in the stage\r\n  stage.position({\r\n    x: stage.width() / 2 - contentCenterX * scale,\r\n    y: stage.height() / 2 - contentCenterY * scale\r\n  });\r\n\r\n  stage.batchDraw();\r\n  console.log('Fitted and centered all cards in view');\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 10: SEARCH (Boolean Search, Wildcards, Proximity)\r\n// ============================================================================\r\n\r\n/**\r\n * Check if term matches with wildcard support\r\n */\r\nexport function matchWithWildcard(term, searchableText) {\r\n  if (term.includes('*')) {\r\n    // Convert wildcard to regex\r\n    const regexPattern = term.replace(/\\*/g, '.*');\r\n    const regex = new RegExp('\\\\b' + regexPattern + '\\\\b', 'i');\r\n    return regex.test(searchableText);\r\n  }\r\n  return searchableText.includes(term);\r\n}\r\n\r\n/**\r\n * Check proximity search (NEAR/x or N/x)\r\n */\r\nexport function checkProximity(query, searchableText) {\r\n  // Match patterns like \"word1 near/5 word2\" or \"word1 n/5 word2\"\r\n  const proximityMatch = query.match(/(.+?)\\s+(near|n)\\/(\\d+)\\s+(.+)/i);\r\n  if (!proximityMatch) return false;\r\n\r\n  const term1 = proximityMatch[1].trim();\r\n  const distance = parseInt(proximityMatch[3]);\r\n  const term2 = proximityMatch[4].trim();\r\n\r\n  // Split text into words\r\n  const words = searchableText.split(/\\s+/);\r\n\r\n  // Find positions of both terms\r\n  const positions1 = [];\r\n  const positions2 = [];\r\n\r\n  words.forEach((word, index) => {\r\n    if (matchWithWildcard(term1, word)) positions1.push(index);\r\n    if (matchWithWildcard(term2, word)) positions2.push(index);\r\n  });\r\n\r\n  // Check if any pair is within distance\r\n  for (const pos1 of positions1) {\r\n    for (const pos2 of positions2) {\r\n      if (Math.abs(pos1 - pos2) <= distance) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\n/**\r\n * Evaluate boolean search query\r\n * Supports: OR, AND, NOT, \"exact phrases\", *, ( ), NEAR/x, N/x\r\n */\r\nexport function evaluateBooleanQuery(query, searchableText) {\r\n  // Handle different boolean operators\r\n  console.log('[evaluateBooleanQuery] Query:', query, 'SearchableText:', searchableText.substring(0, 50));\r\n\r\n  // Handle parentheses (highest precedence)\r\n  if (query.includes('(')) {\r\n    // Find matching parentheses and evaluate recursively\r\n    const parenMatch = query.match(/\\(([^()]+)\\)/);\r\n    if (parenMatch) {\r\n      const innerQuery = parenMatch[1];\r\n      const innerResult = evaluateBooleanQuery(innerQuery, searchableText);\r\n      // Replace the parentheses group with result placeholder\r\n      const replaced = query.replace(parenMatch[0], innerResult ? '__TRUE__' : '__FALSE__');\r\n      return evaluateBooleanQuery(replaced, searchableText);\r\n    }\r\n  }\r\n\r\n  // Handle result placeholders from parentheses\r\n  if (query === '__TRUE__') return true;\r\n  if (query === '__FALSE__') return false;\r\n\r\n  // Handle proximity search (NEAR/x or N/x)\r\n  if (/\\s+(near|n)\\/\\d+\\s+/i.test(query)) {\r\n    return checkProximity(query, searchableText);\r\n  }\r\n\r\n  // Split by OR first (lowest precedence)\r\n  if (query.includes(' or ')) {\r\n    const orParts = query.split(' or ');\r\n    console.log('[evaluateBooleanQuery] OR parts:', orParts);\r\n    return orParts.some(part => evaluateBooleanQuery(part.trim(), searchableText));\r\n  }\r\n\r\n  // Handle NOT operations\r\n  if (query.includes(' not ')) {\r\n    const notIndex = query.indexOf(' not ');\r\n    const beforeNot = query.substring(0, notIndex).trim();\r\n    const afterNot = query.substring(notIndex + 5).trim(); // ' not '.length = 5\r\n\r\n    // If there's something before NOT, it must match\r\n    let beforeMatches = true;\r\n    if (beforeNot) {\r\n      beforeMatches = evaluateBooleanQuery(beforeNot, searchableText);\r\n    }\r\n\r\n    // The part after NOT must NOT match\r\n    const afterMatches = evaluateBooleanQuery(afterNot, searchableText);\r\n\r\n    return beforeMatches && !afterMatches;\r\n  }\r\n\r\n  // Handle AND operations (default behavior and explicit)\r\n  const andParts = query.includes(' and ') ?\r\n    query.split(' and ') :\r\n    query.split(' ').filter(term => term.length > 0);\r\n\r\n  return andParts.every(term => {\r\n    term = term.trim();\r\n    console.log('[evaluateBooleanQuery] Checking term:', term);\r\n\r\n    // Skip placeholders\r\n    if (term === '__TRUE__') return true;\r\n    if (term === '__FALSE__') return false;\r\n\r\n    // Remove quotes if present for exact phrase matching\r\n    if (term.startsWith('\"') && term.endsWith('\"')) {\r\n      // Exact phrase search\r\n      const phrase = term.slice(1, -1);\r\n      console.log('[evaluateBooleanQuery] Exact phrase search:', phrase, 'Match:', searchableText.includes(phrase));\r\n      return searchableText.includes(phrase);\r\n    } else if (term.startsWith(\"'\") && term.endsWith(\"'\")) {\r\n      // Also support single quotes\r\n      const phrase = term.slice(1, -1);\r\n      console.log('[evaluateBooleanQuery] Single quote phrase search:', phrase, 'Match:', searchableText.includes(phrase));\r\n      return searchableText.includes(phrase);\r\n    } else {\r\n      // Regular word search with wildcard support\r\n      const matches = matchWithWildcard(term, searchableText);\r\n      console.log('[evaluateBooleanQuery] Regular/wildcard search:', term, 'Match:', matches);\r\n      return matches;\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Search and highlight cards\r\n * @param {string} query - Search query\r\n */\r\nexport async function searchCards(query) {\r\n  console.log('[searchCards] Called with query:', query);\r\n\r\n  if (!layer) {\r\n    console.error('[searchCards] Layer not initialized');\r\n    return;\r\n  }\r\n\r\n  const allCards = await getAllCards();\r\n  // Get all groups from layer that have a cardId attribute\r\n  const allGroups = layer.getChildren().filter(node => node.getAttr('cardId'));\r\n\r\n  console.log('[searchCards] Total cards in DB:', allCards.length);\r\n  console.log('[searchCards] Total card groups on canvas:', allGroups.length);\r\n\r\n  if (!query || query.trim() === '') {\r\n    // Clear search - reset all cards\r\n    console.log('[searchCards] Clearing search, resetting all cards');\r\n    allGroups.forEach(group => {\r\n      group.opacity(1);\r\n      const background = group.findOne('Rect');\r\n      if (!group.hasName('selected')) {\r\n        if (background) {\r\n          background.stroke('#e0e0e0');\r\n          background.strokeWidth(1);\r\n        }\r\n      }\r\n    });\r\n    layer.batchDraw();\r\n    return;\r\n  }\r\n\r\n  const lowerQuery = query.toLowerCase();\r\n  const matchingCards = new Set();\r\n\r\n  // Find matching cards using boolean logic\r\n  allCards.forEach(card => {\r\n    const text = (card.text || '').toLowerCase();\r\n    const backText = (card.backText || '').toLowerCase();\r\n    const tags = (card.tags || []).join(' ').toLowerCase();\r\n\r\n    // Combine all searchable text\r\n    const searchableText = [text, backText, tags].join(' ');\r\n\r\n    console.log('[searchCards] Checking card:', card.id);\r\n\r\n    // Use boolean query evaluation\r\n    if (evaluateBooleanQuery(lowerQuery, searchableText)) {\r\n      console.log('[searchCards]  Match found:', card.id);\r\n      matchingCards.add(card.id);\r\n    }\r\n  });\r\n\r\n  console.log('[searchCards] Matching card IDs:', Array.from(matchingCards));\r\n\r\n  // Apply visual effects\r\n  allGroups.forEach(group => {\r\n    const cardId = group.getAttr('cardId');\r\n    const background = group.findOne('Rect');\r\n    const isMatch = matchingCards.has(cardId);\r\n\r\n    console.log('[searchCards] Group cardId:', cardId, 'isMatch:', isMatch, 'hasBackground:', !!background);\r\n\r\n    if (isMatch) {\r\n      // Matching card: mark and full opacity\r\n      console.log('[searchCards]  Highlighting match:', cardId);\r\n      group.opacity(1);\r\n      group.addName('selected');\r\n      if (background) {\r\n        background.stroke('#2196F3');\r\n        background.strokeWidth(3);\r\n      }\r\n    } else {\r\n      // Non-matching card: fade and remove selection\r\n      console.log('[searchCards]  Fading non-match:', cardId);\r\n      group.opacity(0.3);\r\n      group.removeName('selected');\r\n      if (background) {\r\n        background.stroke('#e0e0e0');\r\n        background.strokeWidth(1);\r\n      }\r\n    }\r\n  });\r\n\r\n  layer.batchDraw();\r\n  console.log(`[searchCards]  Search complete: found ${matchingCards.size} matches for \"${query}\"`);\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 11: CONTEXT MENU & CARD ACTIONS (Lock, Pin)\r\n// ============================================================================\r\n\r\n/**\r\n * Show context menu for card\r\n */\r\nexport async function showContextMenu(x, y, cardId, group) {\r\n  // Remove any existing context menu\r\n  const existingMenu = document.getElementById('card-context-menu');\r\n  if (existingMenu) {\r\n    existingMenu.remove();\r\n  }\r\n\r\n  const selectedGroups = layer.find('.selected');\r\n  const isBulkOperation = selectedGroups.length > 1 && group.hasName('selected');\r\n  const isLocked = group.getAttr('locked') || false;\r\n\r\n  // Create menu\r\n  const menu = document.createElement('div');\r\n  menu.id = 'card-context-menu';\r\n  menu.style.cssText = `\r\n    position: fixed;\r\n    left: ${x}px;\r\n    top: ${y}px;\r\n    background: var(--bg-primary);\r\n    color: var(--text-primary);\r\n    border: 1px solid var(--border-color);\r\n    border-radius: 6px;\r\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n    z-index: 10001;\r\n    min-width: 180px;\r\n    overflow: hidden;\r\n  `;\r\n\r\n  let menuItems = [];\r\n\r\n  if (isBulkOperation) {\r\n    const selectedIds = selectedGroups.map(g => g.getAttr('cardId'));\r\n    menu.innerHTML = `<div style=\"padding: 8px 12px; font-weight: 600; border-bottom: 1px solid var(--border-color); margin-bottom: 4px; color: var(--text-primary);\">${selectedIds.length} kort markerade</div>`;\r\n    menuItems = [\r\n      {\r\n        label: ' ndra frg',\r\n        action: () => showQuickColorPicker(x, y, selectedIds)\r\n      },\r\n      {\r\n        label: ' Redigera alla',\r\n        action: () => createBulkEditor(selectedIds)\r\n      },\r\n      {\r\n        label: ' Ta bort alla',\r\n        action: () => {\r\n          if (confirm(`r du sker p att du vill ta bort ${selectedIds.length} kort?`)) {\r\n            selectedIds.forEach(id => handleDeleteCard(id));\r\n          }\r\n        }\r\n      }\r\n    ];\r\n    renderMenuItems(menu, menuItems, true);\r\n  } else {\r\n    // Single card menu\r\n    const card = await getCard(cardId);\r\n    menuItems = [\r\n      {\r\n        label: isLocked ? ' Avpinna kort' : ' Pinna kort',\r\n        action: () => toggleLockCard(cardId, group)\r\n      },\r\n      {\r\n        label: ' Redigera',\r\n        action: () => {\r\n          if (card && card.image) {\r\n            flipCard(cardId);\r\n          } else {\r\n            openEditDialog(cardId);\r\n          }\r\n        }\r\n      }\r\n    ];\r\n\r\n    if (card && card.image) {\r\n      menuItems.push({\r\n        label: ' Ls med AI',\r\n        action: () => readImageWithGemini(cardId)\r\n      });\r\n    }\r\n\r\n    menuItems.push({\r\n      label: ' Ta bort',\r\n      action: () => handleDeleteCard(cardId)\r\n    });\r\n\r\n    renderMenuItems(menu, menuItems, false);\r\n  }\r\n\r\n  document.body.appendChild(menu);\r\n\r\n  // Close menu on click outside\r\n  const closeMenu = (e) => {\r\n    if (!menu.contains(e.target)) {\r\n      menu.remove();\r\n      document.removeEventListener('click', closeMenu);\r\n    }\r\n  };\r\n  setTimeout(() => document.addEventListener('click', closeMenu), 10);\r\n}\r\n\r\nfunction renderMenuItems(menu, items, isBulk) {\r\n    if (!isBulk) {\r\n        menu.innerHTML = ''; // Clear loading placeholder\r\n    }\r\n\r\n    items.forEach(item => {\r\n        const menuItem = document.createElement('div');\r\n        menuItem.textContent = item.label;\r\n        menuItem.style.cssText = `\r\n          padding: 10px 16px;\r\n          cursor: pointer;\r\n          font-size: 14px;\r\n          transition: background 0.2s;\r\n          color: var(--text-primary);\r\n        `;\r\n        menuItem.addEventListener('mouseenter', () => {\r\n          menuItem.style.background = 'var(--bg-secondary)';\r\n        });\r\n        menuItem.addEventListener('mouseleave', () => {\r\n          menuItem.style.background = 'var(--bg-primary)';\r\n        });\r\n        menuItem.addEventListener('click', (e) => {\r\n          e.stopPropagation();\r\n          item.action();\r\n          const contextMenu = document.getElementById('card-context-menu');\r\n          if (contextMenu) contextMenu.remove();\r\n        });\r\n        menu.appendChild(menuItem);\r\n    });\r\n}\r\n\r\n/**\r\n * Toggle lock state for a card\r\n */\r\nasync function toggleLockCard(cardId, group) {\r\n  const isLocked = group.getAttr('locked') || false;\r\n  const newLockedState = !isLocked;\r\n\r\n  // Update visual state\r\n  group.draggable(!newLockedState);\r\n  group.setAttr('locked', newLockedState);\r\n\r\n  // Update database\r\n  await updateCard(cardId, { locked: newLockedState });\r\n\r\n  // Visual feedback - add lock icon\r\n  updateLockIndicator(group, newLockedState);\r\n\r\n  console.log(`Card ${cardId} ${newLockedState ? 'locked' : 'unlocked'}`);\r\n  layer.batchDraw();\r\n}\r\n\r\n/**\r\n * Update lock indicator on card\r\n */\r\nfunction updateLockIndicator(group, isLocked) {\r\n  // Remove existing lock indicator\r\n  const existingLock = group.findOne('.lock-indicator');\r\n  if (existingLock) {\r\n    existingLock.destroy();\r\n  }\r\n\r\n  if (isLocked) {\r\n    // Add pin icon\r\n    const background = group.findOne('Rect');\r\n    if (background) {\r\n      const pinIcon = new Konva.Text({\r\n        text: '',\r\n        x: background.width() - 30,\r\n        y: 5,\r\n        fontSize: 20,\r\n        name: 'lock-indicator',\r\n        listening: false\r\n      });\r\n      group.add(pinIcon);\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Toggle pin/unpin for selected cards\r\n */\r\nasync function togglePinSelectedCards() {\r\n  const selectedGroups = layer.find('.selected');\r\n  if (selectedGroups.length === 0) {\r\n    console.log('No cards selected to pin/unpin');\r\n    return;\r\n  }\r\n\r\n  // Check if any are pinned\r\n  const anyPinned = selectedGroups.some(group => group.getAttr('locked'));\r\n\r\n  for (const group of selectedGroups) {\r\n    const cardId = group.getAttr('cardId');\r\n    if (cardId) {\r\n      // If any are pinned, unpin all. Otherwise, pin all.\r\n      const newState = !anyPinned;\r\n      group.draggable(!newState);\r\n      group.setAttr('locked', newState);\r\n      await updateCard(cardId, { locked: newState });\r\n      updateLockIndicator(group, newState);\r\n    }\r\n  }\r\n\r\n  console.log(`${anyPinned ? 'Unpinned' : 'Pinned'} ${selectedGroups.length} cards`);\r\n  layer.batchDraw();\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 12: UI BUTTONS & THEME (Fit All, Add Menu, Theme Toggle)\r\n// ============================================================================\r\n\r\n/**\r\n * Create \"Fit All\" button\r\n */\r\nfunction createFitAllButton() {\r\n  const button = document.createElement('button');\r\n  button.id = 'fit-all-button';\r\n  button.innerHTML = '';\r\n  button.title = 'Visa alla kort';\r\n  button.style.cssText = `\r\n    position: fixed;\r\n    bottom: 24px;\r\n    right: 24px;\r\n    width: 56px;\r\n    height: 56px;\r\n    background: #2196F3;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 50%;\r\n    font-size: 24px;\r\n    cursor: pointer;\r\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n    z-index: 1000;\r\n    transition: all 0.2s;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  `;\r\n\r\n  button.addEventListener('mouseenter', () => {\r\n    button.style.transform = 'scale(1.1)';\r\n    button.style.boxShadow = '0 6px 16px rgba(0, 0, 0, 0.2)';\r\n  });\r\n\r\n  button.addEventListener('mouseleave', () => {\r\n    button.style.transform = 'scale(1)';\r\n    button.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';\r\n  });\r\n\r\n  button.addEventListener('click', fitAllCards);\r\n\r\n  document.body.appendChild(button);\r\n  console.log('Fit All button created');\r\n}\r\n\r\n/**\r\n * Create \"Command Palette\" button\r\n */\r\nfunction createCommandPaletteButton() {\r\n  const button = document.createElement('button');\r\n  button.id = 'command-palette-button';\r\n  button.innerHTML = '';\r\n  button.title = 'Kommandopalett (Space)';\r\n  button.style.cssText = `\r\n    position: fixed;\r\n    bottom: 168px;\r\n    right: 24px;\r\n    width: 56px;\r\n    height: 56px;\r\n    background: #2196F3;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 50%;\r\n    font-size: 28px;\r\n    cursor: pointer;\r\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n    z-index: 1000;\r\n    transition: all 0.2s;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n  `;\r\n\r\n  button.addEventListener('mouseenter', () => {\r\n    button.style.transform = 'scale(1.1)';\r\n    button.style.boxShadow = '0 6px 16px rgba(0, 0, 0, 0.2)';\r\n  });\r\n\r\n  button.addEventListener('mouseleave', () => {\r\n    button.style.transform = 'scale(1)';\r\n    button.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';\r\n  });\r\n\r\n  button.addEventListener('click', showCommandPalette);\r\n\r\n  document.body.appendChild(button);\r\n  console.log('Command Palette button created');\r\n}\r\n\r\n/**\r\n * Show add menu overlay\r\n */\r\nfunction showAddMenu() {\r\n  // Remove existing menu if any\r\n  const existingMenu = document.getElementById('add-menu-overlay');\r\n  if (existingMenu) {\r\n    existingMenu.remove();\r\n    return; // Toggle off\r\n  }\r\n\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.id = 'add-menu-overlay';\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 10002;\r\n    backdrop-filter: blur(4px);\r\n  `;\r\n\r\n  // Create menu container\r\n  const menu = document.createElement('div');\r\n  menu.style.cssText = `\r\n    background: white;\r\n    border-radius: 12px;\r\n    padding: 24px;\r\n    min-width: 300px;\r\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\r\n  `;\r\n\r\n  // Title\r\n  const title = document.createElement('h2');\r\n  title.textContent = 'Snabbmeny';\r\n  title.style.cssText = `\r\n    margin: 0 0 20px 0;\r\n    font-size: 24px;\r\n    color: #1a1a1a;\r\n  `;\r\n  menu.appendChild(title);\r\n\r\n  // Menu items\r\n  const menuItems = [\r\n    {\r\n      icon: '',\r\n      label: 'Nytt text-kort',\r\n      desc: 'Skapa ett nytt text-kort',\r\n      action: async () => {\r\n        const pointer = stage.getPointerPosition();\r\n        const scale = stage.scaleX();\r\n        const position = pointer ? {\r\n          x: (pointer.x - stage.x()) / scale,\r\n          y: (pointer.y - stage.y()) / scale\r\n        } : { x: 100, y: 100 };\r\n        await createNewCard(position);\r\n        overlay.remove();\r\n      }\r\n    },\r\n    {\r\n      icon: '',\r\n      label: 'Importera bild',\r\n      desc: 'Lgg till en bild frn din enhet',\r\n      action: async () => {\r\n        overlay.remove(); // Remove overlay BEFORE opening file picker\r\n        await importImage();\r\n      }\r\n    }\r\n  ];\r\n\r\n  menuItems.forEach(item => {\r\n    const menuItem = document.createElement('div');\r\n    menuItem.style.cssText = `\r\n      padding: 16px;\r\n      margin-bottom: 8px;\r\n      background: #f5f5f5;\r\n      border-radius: 8px;\r\n      cursor: pointer;\r\n      transition: all 0.15s;\r\n      display: flex;\r\n      align-items: center;\r\n      gap: 16px;\r\n    `;\r\n\r\n    menuItem.innerHTML = `\r\n      <div style=\"font-size: 28px; flex-shrink: 0;\">${item.icon}</div>\r\n      <div style=\"flex: 1;\">\r\n        <div style=\"font-weight: 600; font-size: 16px; color: #1a1a1a; margin-bottom: 2px;\">\r\n          ${item.label}\r\n        </div>\r\n        <div style=\"font-size: 13px; color: #666;\">\r\n          ${item.desc}\r\n        </div>\r\n      </div>\r\n    `;\r\n\r\n    menuItem.addEventListener('mouseenter', () => {\r\n      menuItem.style.background = '#e8e8e8';\r\n      menuItem.style.transform = 'translateX(4px)';\r\n    });\r\n\r\n    menuItem.addEventListener('mouseleave', () => {\r\n      menuItem.style.background = '#f5f5f5';\r\n      menuItem.style.transform = 'translateX(0)';\r\n    });\r\n\r\n    menuItem.addEventListener('click', item.action);\r\n    menu.appendChild(menuItem);\r\n  });\r\n\r\n  overlay.appendChild(menu);\r\n  document.body.appendChild(overlay);\r\n\r\n  // Close on overlay click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      overlay.remove();\r\n    }\r\n  });\r\n\r\n  // Close on ESC\r\n  const escHandler = (e) => {\r\n    if (e.key === 'Escape') {\r\n      overlay.remove();\r\n      document.removeEventListener('keydown', escHandler);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', escHandler);\r\n}\r\n\r\n/**\r\n * Toggle theme\r\n */\r\nfunction toggleTheme() {\r\n  const body = document.body;\r\n  const currentTheme = body.getAttribute('data-theme') || 'light';\r\n\r\n  const themes = ['light', 'dark', 'eink'];\r\n  const currentIndex = themes.indexOf(currentTheme);\r\n  const nextIndex = (currentIndex + 1) % themes.length;\r\n  const nextTheme = themes[nextIndex];\r\n\r\n  body.setAttribute('data-theme', nextTheme);\r\n  localStorage.setItem('theme', nextTheme);\r\n\r\n  console.log(`Theme changed to: ${nextTheme}`);\r\n}\r\n\r\n/**\r\n * Toggle view from menu\r\n */\r\nfunction toggleViewFromMenu() {\r\n  // Call the main.js toggleView function via custom event\r\n  window.dispatchEvent(new CustomEvent('toggleView'));\r\n}\r\n\r\n/**\r\n * Create floating add button\r\n */\r\nfunction createAddButton() {\r\n  const button = document.createElement('button');\r\n  button.id = 'add-button';\r\n  button.innerHTML = '+';\r\n  button.title = 'Nytt kort (N) | Lngpress: Importera bild (I) | Extra lng: Command (C)';\r\n  button.style.cssText = `\r\n    position: fixed;\r\n    bottom: 96px;\r\n    right: 24px;\r\n    width: 56px;\r\n    height: 56px;\r\n    background: #4CAF50;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 50%;\r\n    font-size: 32px;\r\n    font-weight: 300;\r\n    cursor: pointer;\r\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\r\n    z-index: 1000;\r\n    transition: all 0.2s;\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    line-height: 1;\r\n  `;\r\n\r\n  let pressStartTime = null;\r\n\r\n  const onPressStart = () => {\r\n    pressStartTime = Date.now();\r\n    button.style.transform = 'scale(0.95)';\r\n  };\r\n\r\n  const onPressEnd = () => {\r\n    button.style.transform = 'scale(1)';\r\n    // Show overlay menu\r\n    showAddMenu();\r\n  };\r\n\r\n  let isPressed = false;\r\n\r\n  button.addEventListener('mousedown', () => {\r\n    isPressed = true;\r\n    onPressStart();\r\n  });\r\n\r\n  button.addEventListener('mouseup', () => {\r\n    if (isPressed) {\r\n      isPressed = false;\r\n      onPressEnd();\r\n    }\r\n  });\r\n\r\n  button.addEventListener('mouseleave', () => {\r\n    if (isPressed) {\r\n      isPressed = false;\r\n      button.style.transform = 'scale(1)';\r\n    }\r\n  });\r\n\r\n  button.addEventListener('touchstart', (e) => {\r\n    e.preventDefault();\r\n    isPressed = true;\r\n    onPressStart();\r\n  });\r\n\r\n  button.addEventListener('touchend', (e) => {\r\n    e.preventDefault();\r\n    if (isPressed) {\r\n      isPressed = false;\r\n      onPressEnd();\r\n    }\r\n  });\r\n\r\n  button.addEventListener('mouseenter', () => {\r\n    if (!isPressed) {\r\n      button.style.transform = 'scale(1.1)';\r\n      button.style.boxShadow = '0 6px 16px rgba(0, 0, 0, 0.2)';\r\n    }\r\n  });\r\n\r\n  button.addEventListener('mouseleave', () => {\r\n    if (!isPressed) {\r\n      button.style.transform = 'scale(1)';\r\n      button.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';\r\n    }\r\n  });\r\n\r\n  document.body.appendChild(button);\r\n  console.log('Add button created');\r\n}\r\n\r\n// ============================================================================\r\n// SECTION 13: ARRANGEMENTS & KEYBOARD HANDLERS (Grid, Vertical, Horizontal, etc.)\r\n// ============================================================================\r\n\r\n/**\r\n * Apply arrangement to selected cards with animation\r\n */\r\nasync function applyArrangement(arrangeFn, arrangeName) {\r\n  const selectedGroups = layer.find('.selected');\r\n  if (selectedGroups.length === 0) {\r\n    console.log('No cards selected for arrangement');\r\n    return;\r\n  }\r\n\r\n  // Get mouse/center position\r\n  const pointer = stage.getPointerPosition();\r\n  const scale = stage.scaleX();\r\n  const centerPos = pointer ? {\r\n    x: (pointer.x - stage.x()) / scale,\r\n    y: (pointer.y - stage.y()) / scale\r\n  } : {\r\n    x: 0,\r\n    y: 0\r\n  };\r\n\r\n  // Prepare card data for arrangement\r\n  const cardsData = await Promise.all(\r\n    selectedGroups.map(async group => {\r\n      const cardId = group.getAttr('cardId');\r\n      const cards = await getAllCards();\r\n      const card = cards.find(c => c.id === cardId);\r\n      const background = group.findOne('Rect');\r\n\r\n      return {\r\n        id: cardId,\r\n        width: background ? background.width() : 200,\r\n        height: background ? background.height() : 150,\r\n        card: card\r\n      };\r\n    })\r\n  );\r\n\r\n  // Calculate new positions\r\n  const newPositions = arrangeFn(cardsData, centerPos);\r\n\r\n  // Check if this is a grid arrangement that needs standard width\r\n  const needsStandardWidth = arrangeName.includes('Grid Vertical') ||\r\n                             arrangeName.includes('Grid Horizontal') ||\r\n                             arrangeName.includes('Grid Top-Aligned');\r\n  const standardWidth = 200;\r\n\r\n  // Animate cards to new positions (and resize if needed)\r\n  newPositions.forEach(({ id, x, y }) => {\r\n    const group = cardGroups.get(id);\r\n    if (!group) return;\r\n\r\n    // Animate position\r\n    group.to({\r\n      x: x,\r\n      y: y,\r\n      duration: 0.3,\r\n      easing: Konva.Easings.EaseOut\r\n    });\r\n\r\n    // Resize cards to standard width for grid arrangements\r\n    if (needsStandardWidth) {\r\n      const background = group.findOne('Rect');\r\n      const text = group.findOne('Text');\r\n      const image = group.findOne('Image');\r\n\r\n      if (background) {\r\n        const currentWidth = background.width();\r\n        if (currentWidth !== standardWidth) {\r\n          background.to({\r\n            width: standardWidth,\r\n            duration: 0.3,\r\n            easing: Konva.Easings.EaseOut\r\n          });\r\n        }\r\n      }\r\n\r\n      if (text) {\r\n        text.to({\r\n          width: standardWidth - 20,\r\n          duration: 0.3,\r\n          easing: Konva.Easings.EaseOut\r\n        });\r\n      }\r\n\r\n      if (image) {\r\n        // Scale image proportionally to fit standard width\r\n        const currentWidth = image.width();\r\n        const currentHeight = image.height();\r\n        if (currentWidth !== standardWidth) {\r\n          const scale = standardWidth / currentWidth;\r\n          image.to({\r\n            width: standardWidth,\r\n            height: currentHeight * scale,\r\n            duration: 0.3,\r\n            easing: Konva.Easings.EaseOut\r\n          });\r\n\r\n          // Also resize background to match new image height\r\n          if (background) {\r\n            background.to({\r\n              height: currentHeight * scale + 60, // +60 for text area\r\n              duration: 0.3,\r\n              easing: Konva.Easings.EaseOut\r\n            });\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update database\r\n    updateCard(id, { position: { x, y } });\r\n  });\r\n\r\n  layer.batchDraw();\r\n  console.log(`Arranged ${newPositions.length} cards: ${arrangeName}`);\r\n}\r\n\r\n/**\r\n * Custom modal dialog (replaces prompt)\r\n */\r\nfunction showTextInputDialog(title, defaultValue = '') {\r\n  return new Promise((resolve) => {\r\n    // Create overlay\r\n    const overlay = document.createElement('div');\r\n    overlay.style.cssText = `\r\n      position: fixed;\r\n      top: 0;\r\n      left: 0;\r\n      width: 100%;\r\n      height: 100%;\r\n      background: rgba(0, 0, 0, 0.5);\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      z-index: 10000;\r\n      backdrop-filter: blur(4px);\r\n    `;\r\n\r\n    // Create dialog\r\n    const dialog = document.createElement('div');\r\n    dialog.style.cssText = `\r\n      background: #ffffff;\r\n      border-radius: 12px;\r\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\r\n      padding: 24px;\r\n      width: 90%;\r\n      max-width: 500px;\r\n      animation: slideDown 0.2s ease-out;\r\n    `;\r\n\r\n    // Add animation keyframe\r\n    if (!document.getElementById('dialog-animation-style')) {\r\n      const style = document.createElement('style');\r\n      style.id = 'dialog-animation-style';\r\n      style.textContent = `\r\n        @keyframes slideDown {\r\n          from {\r\n            opacity: 0;\r\n            transform: translateY(-20px);\r\n          }\r\n          to {\r\n            opacity: 1;\r\n            transform: translateY(0);\r\n          }\r\n        }\r\n      `;\r\n      document.head.appendChild(style);\r\n    }\r\n\r\n    // Title\r\n    const titleEl = document.createElement('h3');\r\n    titleEl.textContent = title;\r\n    titleEl.style.cssText = `\r\n      margin: 0 0 16px 0;\r\n      font-size: 18px;\r\n      font-weight: 600;\r\n      color: #1a1a1a;\r\n    `;\r\n\r\n    // Input\r\n    const input = document.createElement('textarea');\r\n    input.value = defaultValue;\r\n    input.style.cssText = `\r\n      width: 100%;\r\n      min-height: 100px;\r\n      padding: 12px;\r\n      border: 2px solid #e0e0e0;\r\n      border-radius: 8px;\r\n      font-size: 16px;\r\n      font-family: sans-serif;\r\n      resize: vertical;\r\n      margin-bottom: 16px;\r\n      transition: border-color 0.2s;\r\n    `;\r\n    input.addEventListener('focus', () => {\r\n      input.style.borderColor = '#2196F3';\r\n    });\r\n    input.addEventListener('blur', () => {\r\n      input.style.borderColor = '#e0e0e0';\r\n    });\r\n\r\n    // Buttons container\r\n    const buttons = document.createElement('div');\r\n    buttons.style.cssText = `\r\n      display: flex;\r\n      gap: 12px;\r\n      justify-content: flex-end;\r\n    `;\r\n\r\n    // Cancel button\r\n    const cancelBtn = document.createElement('button');\r\n    cancelBtn.textContent = 'Avbryt';\r\n    cancelBtn.style.cssText = `\r\n      padding: 10px 20px;\r\n      background: #f5f5f5;\r\n      color: #666;\r\n      border: none;\r\n      border-radius: 8px;\r\n      font-size: 16px;\r\n      cursor: pointer;\r\n      transition: background 0.2s;\r\n    `;\r\n    cancelBtn.addEventListener('mouseenter', () => {\r\n      cancelBtn.style.background = '#e0e0e0';\r\n    });\r\n    cancelBtn.addEventListener('mouseleave', () => {\r\n      cancelBtn.style.background = '#f5f5f5';\r\n    });\r\n    cancelBtn.addEventListener('click', () => {\r\n      document.body.removeChild(overlay);\r\n      resolve(null);\r\n    });\r\n\r\n    // OK button\r\n    const okBtn = document.createElement('button');\r\n    okBtn.textContent = 'OK';\r\n    okBtn.style.cssText = `\r\n      padding: 10px 20px;\r\n      background: #2196F3;\r\n      color: white;\r\n      border: none;\r\n      border-radius: 8px;\r\n      font-size: 16px;\r\n      font-weight: 600;\r\n      cursor: pointer;\r\n      transition: background 0.2s;\r\n    `;\r\n    okBtn.addEventListener('mouseenter', () => {\r\n      okBtn.style.background = '#1976D2';\r\n    });\r\n    okBtn.addEventListener('mouseleave', () => {\r\n      okBtn.style.background = '#2196F3';\r\n    });\r\n    okBtn.addEventListener('click', () => {\r\n      document.body.removeChild(overlay);\r\n      resolve(input.value);\r\n    });\r\n\r\n    // Build dialog\r\n    buttons.appendChild(cancelBtn);\r\n    buttons.appendChild(okBtn);\r\n    dialog.appendChild(titleEl);\r\n    dialog.appendChild(input);\r\n    dialog.appendChild(buttons);\r\n    overlay.appendChild(dialog);\r\n\r\n    // Handle escape key\r\n    const escapeHandler = (e) => {\r\n      if (e.key === 'Escape') {\r\n        document.body.removeChild(overlay);\r\n        document.removeEventListener('keydown', escapeHandler);\r\n        resolve(null);\r\n      }\r\n    };\r\n    document.addEventListener('keydown', escapeHandler);\r\n\r\n    // Handle enter key (submit)\r\n    input.addEventListener('keydown', (e) => {\r\n      if (e.key === 'Enter' && e.ctrlKey) {\r\n        okBtn.click();\r\n      }\r\n    });\r\n\r\n    // Show dialog\r\n    document.body.appendChild(overlay);\r\n    input.focus();\r\n    input.select();\r\n  });\r\n}\r\n\r\n/**\r\n * Clear clipboard\r\n */\r\nexport function clearClipboard() {\r\n  clipboard = [];\r\n  console.log('Clipboard cleared');\r\n}\r\n\r\n/**\r\n * Deselect all cards\r\n */\r\nexport function deselectAllCards() {\r\n  if (!layer) return;\r\n\r\n  const isEink = document.body.classList.contains('eink-theme');\r\n  const isDark = document.body.classList.contains('dark-theme');\r\n\r\n  layer.find('.selected').forEach(group => {\r\n    group.removeName('selected');\r\n    const background = group.findOne('Rect');\r\n    if (background) {\r\n      if (isEink) {\r\n        background.stroke('#000000');\r\n        background.strokeWidth(2);\r\n      } else if (isDark) {\r\n        background.stroke('#4a5568');\r\n        background.strokeWidth(1);\r\n      } else {\r\n        background.stroke('#e0e0e0');\r\n        background.strokeWidth(1);\r\n      }\r\n    }\r\n  });\r\n\r\n  layer.batchDraw();\r\n  console.log('All cards deselected');\r\n}\r\n","/**\r\n * Spatial View v1.0\r\n * Main entry point\r\n *\r\n *  TODO: DENNA FIL R FR STOR (606+ rader)!\r\n * Behver delas upp enligt ARCHITECTURE.md:\r\n * - ui/toolbar.js (toolbar interactions, knappar)\r\n * - ui/search-bar.js (sk-input hantering)\r\n * - ui/view-switcher.js (byten mellan board/column view)\r\n * - core/app.js (huvudsaklig init-logik)\r\n * main.js ska bara vara ~50 rader orchestrator\r\n */\r\n\r\nimport './styles.css';\r\nimport { initCanvas, addNewCard, exportCanvas, importImage, searchCards, clearClipboard, deselectAllCards } from './lib/canvas.js';\r\nimport { initStorage } from './lib/storage.js';\r\n\r\n// App state\r\nconst state = {\r\n  currentView: 'board', // 'board' | 'column'\r\n  deviceMode: detectDeviceMode(),\r\n  theme: localStorage.getItem('theme') || 'light',\r\n  uiMode: localStorage.getItem('uiMode') || 'full', // 'full' | 'minimal' | 'toggle-only'\r\n  cards: [],\r\n};\r\n\r\n/**\r\n * Detect device mode for optimizations\r\n */\r\nfunction detectDeviceMode() {\r\n  const ua = navigator.userAgent.toLowerCase();\r\n  \r\n  // E-ink detection (Viwoood AiPaper Mini or similar)\r\n  if (ua.includes('eink') || ua.includes('viwoood')) {\r\n    return 'eink';\r\n  }\r\n  \r\n  // Mobile detection\r\n  if (/mobile|android|iphone|ipad|ipod/.test(ua)) {\r\n    return 'mobile';\r\n  }\r\n  \r\n  // Tablet detection\r\n  if (/tablet|ipad/.test(ua) || (window.innerWidth <= 1024 && 'ontouchstart' in window)) {\r\n    return 'tablet';\r\n  }\r\n  \r\n  return 'desktop';\r\n}\r\n\r\n/**\r\n * Apply device-specific optimizations\r\n */\r\nfunction applyDeviceOptimizations() {\r\n  const body = document.body;\r\n  body.classList.add(`device-${state.deviceMode}`);\r\n\r\n  if (state.deviceMode === 'eink') {\r\n    // E-ink mode: disable animations, use column view\r\n    state.theme = 'eink';\r\n    state.currentView = 'column';\r\n    // Default to minimal UI for e-ink if not set\r\n    if (!localStorage.getItem('uiMode')) {\r\n      state.uiMode = 'minimal';\r\n    }\r\n    console.log('E-ink mode activated');\r\n  }\r\n\r\n  if (state.deviceMode === 'mobile' || state.deviceMode === 'tablet') {\r\n    // Mobile/tablet mode: start with column view\r\n    state.currentView = 'column';\r\n    // Default to minimal UI for touch devices if not set\r\n    if (!localStorage.getItem('uiMode')) {\r\n      state.uiMode = 'minimal';\r\n    }\r\n    console.log(`${state.deviceMode} mode activated`);\r\n  }\r\n\r\n}\r\n\r\n/**\r\n * Initialize app\r\n */\r\nasync function init() {\r\n  console.log('Initializing Spatial View...');\r\n  console.log('Device mode:', state.deviceMode);\r\n  \r\n  // Apply device optimizations\r\n  applyDeviceOptimizations();\r\n\r\n  // Apply saved theme BEFORE initializing canvas\r\n  applySavedTheme();\r\n\r\n  // Initialize storage\r\n  await initStorage();\r\n\r\n  // Initialize canvas (Konva) - always initialize for switching\r\n  await initCanvas();\r\n\r\n  // Setup event listeners\r\n  setupEventListeners();\r\n\r\n  // If starting in column view, render it\r\n  if (state.currentView === 'column') {\r\n    await renderColumnView();\r\n  }\r\n\r\n  console.log('Spatial View ready!');\r\n}\r\n\r\n/**\r\n * Apply saved theme from localStorage\r\n * Called BEFORE canvas initialization to ensure cards render with correct theme\r\n */\r\nfunction applySavedTheme() {\r\n  const body = document.body;\r\n  const savedTheme = localStorage.getItem('theme') || state.theme;\r\n  if (savedTheme && savedTheme !== 'light') {\r\n    body.classList.remove('dark-theme', 'eink-theme', 'sepia-theme');\r\n    if (savedTheme === 'dark') {\r\n      body.classList.add('dark-theme');\r\n    } else if (savedTheme === 'eink') {\r\n      body.classList.add('eink-theme');\r\n    }\r\n    state.theme = savedTheme;\r\n    console.log('Applied saved theme:', savedTheme);\r\n  }\r\n}\r\n\r\n/**\r\n * Setup global event listeners\r\n */\r\nfunction setupEventListeners() {\r\n\r\n  // View toggle\r\n  const viewToggle = document.getElementById('btn-view-toggle');\r\n  viewToggle?.addEventListener('click', toggleView);\r\n\r\n  // Theme toggle\r\n  const themeBtn = document.getElementById('btn-theme-toggle');\r\n  themeBtn?.addEventListener('click', toggleTheme);\r\n\r\n  // UI mode toggle\r\n  const uiModeToggle = document.getElementById('btn-ui-mode-toggle');\r\n  uiModeToggle?.addEventListener('click', toggleUIMode);\r\n\r\n  // Import button\r\n  const importBtn = document.getElementById('btn-import');\r\n  importBtn?.addEventListener('click', handleImport);\r\n\r\n  // Download button\r\n  const downloadBtn = document.getElementById('btn-download');\r\n  downloadBtn?.addEventListener('click', handleDownloadBackup);\r\n\r\n  // Search\r\n  const searchInput = document.getElementById('search-input');\r\n  searchInput?.addEventListener('input', debounce(handleSearch, 300));\r\n\r\n  // Escape to clear search (local - when focused)\r\n  searchInput?.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Escape') {\r\n      searchInput.value = '';\r\n      handleSearch({ target: searchInput }); // Clear search results\r\n      searchInput.blur(); // Unfocus the search input\r\n    }\r\n  });\r\n\r\n  // Global Escape handler for search, clipboard, and selection\r\n  document.addEventListener('keydown', (e) => {\r\n    if (e.key === 'Escape') {\r\n      // Clear clipboard\r\n      clearClipboard();\r\n\r\n      // Deselect all cards\r\n      deselectAllCards();\r\n\r\n      // If search has content, clear it\r\n      if (searchInput && searchInput.value) {\r\n        searchInput.value = '';\r\n        handleSearch({ target: searchInput }); // Clear search results\r\n        searchInput.blur(); // Unfocus the search input\r\n      }\r\n    }\r\n  });\r\n\r\n  // Listen for toggle view event from canvas\r\n  window.addEventListener('toggleView', toggleView);\r\n\r\n  // Listen for toggle theme event from canvas\r\n  window.addEventListener('toggleTheme', toggleTheme);\r\n\r\n  // Apply saved UI mode\r\n  applyUIMode();\r\n\r\n  // Info overlay handlers\r\n  const floatingHeader = document.getElementById('floating-header');\r\n  const infoOverlay = document.getElementById('info-overlay');\r\n  const infoClose = document.getElementById('info-close');\r\n\r\n  floatingHeader?.addEventListener('click', () => {\r\n    infoOverlay?.classList.add('active');\r\n  });\r\n\r\n  infoClose?.addEventListener('click', () => {\r\n    infoOverlay?.classList.remove('active');\r\n  });\r\n\r\n  // Close on overlay background click\r\n  infoOverlay?.addEventListener('click', (e) => {\r\n    if (e.target === infoOverlay) {\r\n      infoOverlay.classList.remove('active');\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * Toggle between board and column view\r\n */\r\nasync function toggleView() {\r\n  state.currentView = state.currentView === 'board' ? 'column' : 'board';\r\n\r\n  const boardView = document.getElementById('board-view');\r\n  const columnView = document.getElementById('column-view');\r\n  const toggleBtn = document.getElementById('btn-view-toggle');\r\n\r\n  if (state.currentView === 'board') {\r\n    boardView?.classList.add('active');\r\n    columnView?.classList.remove('active');\r\n    toggleBtn.textContent = ''; // Icon for Column view (what it will switch to)\r\n  } else {\r\n    boardView?.classList.remove('active');\r\n    columnView?.classList.add('active');\r\n    toggleBtn.textContent = ''; // Icon for Board view (what it will switch to)\r\n    // Load cards in column view\r\n    await renderColumnView();\r\n  }\r\n}\r\n\r\n/**\r\n * Render cards in column view\r\n */\r\nasync function renderColumnView(searchQuery = '') {\r\n  const cardList = document.getElementById('card-list');\r\n  if (!cardList) return;\r\n\r\n  // Import storage to get cards\r\n  const { getAllCards } = await import('./lib/storage.js');\r\n  let cards = await getAllCards();\r\n\r\n  // Clear existing content\r\n  cardList.innerHTML = '';\r\n\r\n  if (cards.length === 0) {\r\n    cardList.innerHTML = '<div style=\"padding: 40px; text-align: center; color: #999;\">Inga kort nnu. Klicka p \"+ Lgg till\" fr att skapa ett kort.</div>';\r\n    return;\r\n  }\r\n\r\n  // Filter by search query if provided\r\n  if (searchQuery && searchQuery.trim()) {\r\n    const query = searchQuery.trim().toLowerCase();\r\n\r\n    // Import boolean search function\r\n    const { evaluateBooleanQuery } = await import('./lib/canvas.js');\r\n\r\n    cards = cards.filter(card => {\r\n      const text = card.text || '';\r\n      const backText = card.backText || '';\r\n      const combinedText = (text + ' ' + backText).toLowerCase();\r\n\r\n      // Use boolean search (same as board view)\r\n      return evaluateBooleanQuery(query, combinedText);\r\n    });\r\n\r\n    if (cards.length === 0) {\r\n      cardList.innerHTML = `<div style=\"padding: 40px; text-align: center; color: #999;\">Inga kort matchade \"${searchQuery}\"</div>`;\r\n      return;\r\n    }\r\n  }\r\n\r\n  // Sort cards by last modified (newest first)\r\n  const sortedCards = [...cards].sort((a, b) => {\r\n    const timeA = a.lastModified || 0;\r\n    const timeB = b.lastModified || 0;\r\n    return timeB - timeA;\r\n  });\r\n\r\n  // Check themes\r\n  const isEink = document.body.classList.contains('eink-theme');\r\n  const isDark = document.body.classList.contains('dark-theme');\r\n\r\n  // Render each card\r\n  sortedCards.forEach(card => {\r\n    const cardElement = document.createElement('div');\r\n    cardElement.className = 'column-card';\r\n\r\n    if (isEink) {\r\n      // E-ink: white card, black border, NO shadows, rounded corners\r\n      cardElement.style.cssText = `\r\n        background: white;\r\n        border: 2px solid #000;\r\n        border-radius: 8px;\r\n        padding: 16px;\r\n        margin-bottom: 16px;\r\n        box-shadow: none;\r\n        cursor: pointer;\r\n        transition: none;\r\n      `;\r\n    } else if (isDark) {\r\n      // Dark theme: blue card, white text\r\n      cardElement.style.cssText = `\r\n        background: #2d3748;\r\n        border: 1px solid #4a5568;\r\n        border-radius: 8px;\r\n        padding: 16px;\r\n        margin-bottom: 16px;\r\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n        color: #e0e0e0;\r\n      `;\r\n    } else {\r\n      // Light theme\r\n      cardElement.style.cssText = `\r\n        background: white;\r\n        border: 1px solid #e0e0e0;\r\n        border-radius: 8px;\r\n        padding: 16px;\r\n        margin-bottom: 16px;\r\n        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\r\n        cursor: pointer;\r\n        transition: all 0.2s;\r\n      `;\r\n    }\r\n\r\n    if (card.image) {\r\n      // Image card\r\n      const img = document.createElement('img');\r\n      // Handle both direct base64 string and object format\r\n      const imageSrc = typeof card.image === 'string' ? card.image : card.image.base64;\r\n      img.src = imageSrc;\r\n      img.style.cssText = `\r\n        width: 100%;\r\n        max-width: 100%;\r\n        height: auto;\r\n        border-radius: 4px;\r\n        margin-bottom: 12px;\r\n        display: block;\r\n      `;\r\n\r\n      // Error handling for images\r\n      img.onerror = () => {\r\n        console.error('Failed to load image for card:', card.id);\r\n        img.style.display = 'none';\r\n        const errorText = document.createElement('div');\r\n        errorText.textContent = ' Bild kunde inte laddas';\r\n        errorText.style.cssText = `\r\n          padding: 20px;\r\n          background: #fff3cd;\r\n          border-radius: 4px;\r\n          color: #856404;\r\n          text-align: center;\r\n          margin-bottom: 12px;\r\n        `;\r\n        cardElement.insertBefore(errorText, cardElement.firstChild);\r\n      };\r\n\r\n      cardElement.appendChild(img);\r\n\r\n      if (card.text || card.backText) {\r\n        const text = document.createElement('div');\r\n        text.textContent = card.backText || card.text || '';\r\n        text.style.cssText = `\r\n          font-size: 14px;\r\n          color: ${isDark ? '#e0e0e0' : '#666'};\r\n          line-height: 1.5;\r\n          white-space: pre-wrap;\r\n        `;\r\n        cardElement.appendChild(text);\r\n      }\r\n    } else {\r\n      // Text card\r\n      const text = document.createElement('div');\r\n      text.textContent = card.text || 'Tomt kort';\r\n      text.style.cssText = `\r\n        font-size: 16px;\r\n        color: ${isDark ? '#e0e0e0' : '#1a1a1a'};\r\n        line-height: 1.6;\r\n        white-space: pre-wrap;\r\n      `;\r\n      cardElement.appendChild(text);\r\n    }\r\n\r\n    // Hover effect\r\n    cardElement.addEventListener('mouseenter', () => {\r\n      if (isEink) {\r\n        // E-ink: thicker border on hover\r\n        cardElement.style.border = '3px solid #000';\r\n      } else if (isDark) {\r\n        // Dark theme\r\n        cardElement.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.5)';\r\n        cardElement.style.transform = 'translateY(-2px)';\r\n      } else {\r\n        // Light theme\r\n        cardElement.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.15)';\r\n        cardElement.style.transform = 'translateY(-2px)';\r\n      }\r\n    });\r\n\r\n    cardElement.addEventListener('mouseleave', () => {\r\n      if (isEink) {\r\n        // E-ink: back to normal border\r\n        cardElement.style.border = '2px solid #000';\r\n      } else if (isDark) {\r\n        // Dark theme\r\n        cardElement.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.3)';\r\n        cardElement.style.transform = 'translateY(0)';\r\n      } else {\r\n        // Light theme\r\n        cardElement.style.boxShadow = '0 2px 4px rgba(0, 0, 0, 0.1)';\r\n        cardElement.style.transform = 'translateY(0)';\r\n      }\r\n    });\r\n\r\n    // Click to select (same as board view)\r\n    cardElement.addEventListener('click', () => {\r\n      const isSelected = cardElement.classList.contains('selected');\r\n\r\n      if (isSelected) {\r\n        cardElement.classList.remove('selected');\r\n        if (isEink) {\r\n          cardElement.style.border = '2px solid #000';\r\n        } else if (isDark) {\r\n          cardElement.style.border = '1px solid #4a5568';\r\n        } else {\r\n          cardElement.style.border = '1px solid #e0e0e0';\r\n        }\r\n      } else {\r\n        cardElement.classList.add('selected');\r\n        if (isEink) {\r\n          cardElement.style.border = '4px solid #000';\r\n        } else {\r\n          cardElement.style.border = '3px solid #2196F3';\r\n        }\r\n      }\r\n    });\r\n\r\n    // Double-click to edit - inline editing for column view\r\n    cardElement.addEventListener('dblclick', () => {\r\n      showColumnInlineEdit(card, cardElement);\r\n    });\r\n\r\n    // Right-click context menu (same as board view)\r\n    cardElement.addEventListener('contextmenu', async (e) => {\r\n      e.preventDefault();\r\n      // Import context menu function from canvas\r\n      const { showContextMenu } = await import('./lib/canvas.js');\r\n      showContextMenu(e.clientX, e.clientY, card.id, cardElement);\r\n    });\r\n\r\n    // Touch handlers (same as board view)\r\n    let touchTimer = null;\r\n    let touchStartY = null;\r\n    let hasMoved = false;\r\n\r\n    cardElement.addEventListener('touchstart', (e) => {\r\n      touchStartY = e.touches[0].clientY;\r\n      hasMoved = false;\r\n\r\n      // Long press timer\r\n      touchTimer = setTimeout(async () => {\r\n        if (!hasMoved) {\r\n          // Long press detected\r\n          const selectedCards = cardList.querySelectorAll('.column-card.selected');\r\n\r\n          if (selectedCards.length > 1 && cardElement.classList.contains('selected')) {\r\n            // Multiple cards selected: show bulk menu\r\n            const { showTouchBulkMenu } = await import('./lib/canvas.js');\r\n            await showTouchBulkMenu(e.touches[0].clientX, e.touches[0].clientY);\r\n          } else {\r\n            // Single card: open editor\r\n            showColumnEditDialog(card, cardElement);\r\n          }\r\n          touchTimer = null;\r\n        }\r\n      }, 600); // 600ms long press\r\n    });\r\n\r\n    cardElement.addEventListener('touchmove', (e) => {\r\n      const currentY = e.touches[0].clientY;\r\n      const moved = Math.abs(currentY - touchStartY) > 5;\r\n      if (moved) {\r\n        hasMoved = true;\r\n      }\r\n    });\r\n\r\n    cardElement.addEventListener('touchend', () => {\r\n      if (touchTimer) {\r\n        clearTimeout(touchTimer);\r\n        touchTimer = null;\r\n      }\r\n    });\r\n\r\n    cardElement.addEventListener('touchcancel', () => {\r\n      if (touchTimer) {\r\n        clearTimeout(touchTimer);\r\n        touchTimer = null;\r\n      }\r\n    });\r\n\r\n    cardList.appendChild(cardElement);\r\n  });\r\n}\r\n\r\n/**\r\n * Show edit dialog for card in column view\r\n */\r\n/**\r\n * Show inline editor in column view\r\n */\r\nasync function showColumnInlineEdit(card, cardElement) {\r\n  // Check if already editing\r\n  if (cardElement.querySelector('.inline-editor')) return;\r\n\r\n  const isImageCard = !!card.image;\r\n  const currentText = isImageCard ? (card.backText || '') : (card.text || '');\r\n  const currentTags = card.tags || [];\r\n  const currentColor = card.cardColor || '';\r\n\r\n  // Create inline editor container\r\n  const editorContainer = document.createElement('div');\r\n  editorContainer.className = 'inline-editor';\r\n  editorContainer.style.cssText = `\r\n    padding: 16px;\r\n    background: var(--bg-secondary);\r\n    border: 2px solid var(--accent-color);\r\n    border-radius: 8px;\r\n    margin-top: 12px;\r\n  `;\r\n\r\n  // If image card, show image first\r\n  let imageHTML = '';\r\n  if (isImageCard) {\r\n    const imageSrc = typeof card.image === 'string' ? card.image : card.image.base64;\r\n    imageHTML = `\r\n      <div style=\"margin-bottom: 16px;\">\r\n        <img src=\"${imageSrc}\" style=\"width: 100%; border-radius: 8px;\" alt=\"Card image\" />\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  editorContainer.innerHTML = `\r\n    ${imageHTML}\r\n\r\n    <div style=\"margin-bottom: 12px;\">\r\n      <label style=\"display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px;\">Text:</label>\r\n      <textarea id=\"column-edit-text\"\r\n        style=\"width: 100%; min-height: 150px; padding: 10px; font-size: 15px;\r\n               border: 2px solid var(--border-color); border-radius: 6px;\r\n               background: var(--bg-primary); color: var(--text-primary);\r\n               font-family: inherit; resize: vertical; box-sizing: border-box;\"\r\n      >${currentText}</textarea>\r\n    </div>\r\n\r\n    ${!isImageCard ? `\r\n    <div style=\"margin-bottom: 12px;\">\r\n      <label style=\"display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px;\">Tags (kommaseparerade):</label>\r\n      <input type=\"text\" id=\"column-edit-tags\" value=\"${currentTags.join(', ')}\"\r\n        style=\"width: 100%; padding: 10px; font-size: 15px;\r\n               border: 2px solid var(--border-color); border-radius: 6px;\r\n               background: var(--bg-primary); color: var(--text-primary);\r\n               box-sizing: border-box;\">\r\n    </div>\r\n\r\n    <div style=\"margin-bottom: 16px;\">\r\n      <label style=\"display: block; margin-bottom: 6px; font-weight: 500; font-size: 14px;\">Kortfrg:</label>\r\n      <div id=\"column-color-picker\" style=\"display: flex; gap: 8px; flex-wrap: wrap;\">\r\n        <div class=\"color-dot\" data-color=\"\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: var(--bg-primary); border: 3px solid var(--border-color); cursor: pointer;\r\n             display: flex; align-items: center; justify-content: center; font-size: 18px;\"\r\n             title=\"Ingen frg\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-1\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: #d4f2d4; border: 3px solid ${currentColor === 'card-color-1' ? '#2196F3' : 'transparent'}; cursor: pointer;\" title=\"Grn\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-2\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: #ffe4b3; border: 3px solid ${currentColor === 'card-color-2' ? '#2196F3' : 'transparent'}; cursor: pointer;\" title=\"Orange\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-3\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: #ffc1cc; border: 3px solid ${currentColor === 'card-color-3' ? '#2196F3' : 'transparent'}; cursor: pointer;\" title=\"Rd\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-4\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: #fff7b3; border: 3px solid ${currentColor === 'card-color-4' ? '#2196F3' : 'transparent'}; cursor: pointer;\" title=\"Gul\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-5\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: #f3e5f5; border: 3px solid ${currentColor === 'card-color-5' ? '#2196F3' : 'transparent'}; cursor: pointer;\" title=\"Lila\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-6\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: #c7e7ff; border: 3px solid ${currentColor === 'card-color-6' ? '#2196F3' : 'transparent'}; cursor: pointer;\" title=\"Bl\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-7\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: #e0e0e0; border: 3px solid ${currentColor === 'card-color-7' ? '#2196F3' : 'transparent'}; cursor: pointer;\" title=\"Gr\"></div>\r\n        <div class=\"color-dot\" data-color=\"card-color-8\" style=\"width: 32px; height: 32px; border-radius: 50%;\r\n             background: #ffffff; border: 3px solid ${currentColor === 'card-color-8' ? '#2196F3' : '#ddd'}; cursor: pointer;\" title=\"Vit\"></div>\r\n      </div>\r\n    </div>\r\n    ` : ''}\r\n\r\n    <div style=\"display: flex; gap: 8px; justify-content: flex-end;\">\r\n      <button id=\"column-cancel-edit\" style=\"padding: 10px 20px; background: var(--bg-secondary);\r\n                                         color: var(--text-primary); border: 2px solid var(--border-color);\r\n                                         border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer;\">\r\n        Avbryt\r\n      </button>\r\n      <button id=\"column-delete-card\" style=\"padding: 10px 20px; background: #dc3545;\r\n                                         color: white; border: none; border-radius: 6px;\r\n                                         font-size: 14px; font-weight: 500; cursor: pointer;\">\r\n         Ta bort\r\n      </button>\r\n      <button id=\"column-save-edit\" style=\"padding: 10px 20px; background: var(--accent-color);\r\n                                        color: white; border: none; border-radius: 6px;\r\n                                        font-size: 14px; font-weight: 600; cursor: pointer;\">\r\n        Spara\r\n      </button>\r\n    </div>\r\n\r\n    <div style=\"margin-top: 12px; font-size: 12px; color: var(--text-secondary); text-align: center;\">\r\n      Ctrl+Enter = Spara, Esc = Avbryt\r\n    </div>\r\n  `;\r\n\r\n  cardElement.appendChild(editorContainer);\r\n\r\n  // Get elements\r\n  const textarea = editorContainer.querySelector('#column-edit-text');\r\n  const tagsInput = editorContainer.querySelector('#column-edit-tags');\r\n  const saveBtn = editorContainer.querySelector('#column-save-edit');\r\n  const cancelBtn = editorContainer.querySelector('#column-cancel-edit');\r\n  const deleteBtn = editorContainer.querySelector('#column-delete-card');\r\n  const colorPicker = editorContainer.querySelector('#column-color-picker');\r\n\r\n  // Focus textarea\r\n  textarea.focus();\r\n  textarea.select();\r\n\r\n  // Track selected color\r\n  let selectedColor = currentColor;\r\n\r\n  // Color picker logic\r\n  if (colorPicker) {\r\n    const colorDots = colorPicker.querySelectorAll('.color-dot');\r\n    colorDots.forEach(dot => {\r\n      dot.addEventListener('click', () => {\r\n        const color = dot.dataset.color;\r\n        selectedColor = color;\r\n\r\n        // Update borders\r\n        colorDots.forEach(d => {\r\n          if (d.dataset.color === color) {\r\n            d.style.border = '3px solid #2196F3';\r\n          } else {\r\n            d.style.border = d.dataset.color === 'card-color-8' ? '3px solid #ddd' : '3px solid transparent';\r\n          }\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  // Save function\r\n  const saveEdit = async () => {\r\n    const newText = textarea.value;\r\n    const { updateCard } = await import('./lib/storage.js');\r\n\r\n    const updates = {};\r\n\r\n    if (isImageCard) {\r\n      updates.backText = newText;\r\n    } else {\r\n      updates.text = newText;\r\n\r\n      // Parse tags\r\n      if (tagsInput) {\r\n        const tagString = tagsInput.value.trim();\r\n        updates.tags = tagString ? tagString.split(',').map(t => t.trim()).filter(t => t.length > 0) : [];\r\n      }\r\n\r\n      // Set color\r\n      updates.cardColor = selectedColor;\r\n    }\r\n\r\n    await updateCard(card.id, updates);\r\n    editorContainer.remove();\r\n    await renderColumnView(); // Refresh view\r\n  };\r\n\r\n  // Cancel function\r\n  const cancelEdit = () => {\r\n    editorContainer.remove();\r\n  };\r\n\r\n  // Delete function\r\n  const deleteCard = async () => {\r\n    if (confirm('r du sker p att du vill ta bort detta kort?')) {\r\n      const { deleteCard } = await import('./lib/storage.js');\r\n      await deleteCard(card.id);\r\n      await renderColumnView();\r\n    }\r\n  };\r\n\r\n  // Event listeners\r\n  saveBtn.addEventListener('click', saveEdit);\r\n  cancelBtn.addEventListener('click', cancelEdit);\r\n  deleteBtn.addEventListener('click', deleteCard);\r\n\r\n  // Keyboard shortcuts\r\n  const keyHandler = (e) => {\r\n    if (e.key === 'Escape') {\r\n      cancelEdit();\r\n      document.removeEventListener('keydown', keyHandler);\r\n    } else if (e.ctrlKey && e.key === 'Enter') {\r\n      saveEdit();\r\n      document.removeEventListener('keydown', keyHandler);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', keyHandler);\r\n}\r\n\r\n/**\r\n * OLD: Show edit dialog (modal) - kept for reference but replaced with inline\r\n */\r\nasync function showColumnEditDialog_OLD(card, cardElement) {\r\n  // Create overlay\r\n  const overlay = document.createElement('div');\r\n  overlay.style.cssText = `\r\n    position: fixed;\r\n    top: 0;\r\n    left: 0;\r\n    right: 0;\r\n    bottom: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 10000;\r\n    backdrop-filter: blur(4px);\r\n  `;\r\n\r\n  // Create dialog\r\n  const dialog = document.createElement('div');\r\n  dialog.style.cssText = `\r\n    background: white;\r\n    border-radius: 12px;\r\n    padding: 24px;\r\n    max-width: 500px;\r\n    width: 90%;\r\n    max-height: 80vh;\r\n    overflow-y: auto;\r\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\r\n  `;\r\n\r\n  // Title\r\n  const title = document.createElement('h2');\r\n  title.textContent = card.image ? 'Redigera bildkort' : 'Redigera textkort';\r\n  title.style.cssText = `\r\n    margin: 0 0 20px 0;\r\n    font-size: 24px;\r\n    color: #1a1a1a;\r\n  `;\r\n  dialog.appendChild(title);\r\n\r\n  // If image card, show image\r\n  if (card.image) {\r\n    const img = document.createElement('img');\r\n    // Handle both direct base64 string and object format\r\n    const imageSrc = typeof card.image === 'string' ? card.image : card.image.base64;\r\n    img.src = imageSrc;\r\n    img.style.cssText = `\r\n      width: 100%;\r\n      border-radius: 8px;\r\n      margin-bottom: 16px;\r\n    `;\r\n    dialog.appendChild(img);\r\n  }\r\n\r\n  // Text area\r\n  const textarea = document.createElement('textarea');\r\n  const textToEdit = card.image ? (card.backText || '') : (card.text || '');\r\n  textarea.value = textToEdit;\r\n  textarea.style.cssText = `\r\n    width: 100%;\r\n    min-height: 200px;\r\n    padding: 12px;\r\n    font-size: 16px;\r\n    font-family: sans-serif;\r\n    border: 2px solid #e0e0e0;\r\n    border-radius: 8px;\r\n    resize: vertical;\r\n    margin-bottom: 16px;\r\n  `;\r\n  dialog.appendChild(textarea);\r\n\r\n  // Buttons container\r\n  const buttonContainer = document.createElement('div');\r\n  buttonContainer.style.cssText = `\r\n    display: flex;\r\n    gap: 12px;\r\n    justify-content: flex-end;\r\n  `;\r\n\r\n  // Delete button\r\n  const deleteBtn = document.createElement('button');\r\n  deleteBtn.textContent = ' Ta bort';\r\n  deleteBtn.style.cssText = `\r\n    padding: 10px 20px;\r\n    background: #dc3545;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 6px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  `;\r\n  deleteBtn.addEventListener('mouseenter', () => {\r\n    deleteBtn.style.background = '#c82333';\r\n  });\r\n  deleteBtn.addEventListener('mouseleave', () => {\r\n    deleteBtn.style.background = '#dc3545';\r\n  });\r\n  deleteBtn.addEventListener('click', async () => {\r\n    if (confirm('r du sker p att du vill ta bort detta kort?')) {\r\n      const { deleteCard } = await import('./lib/storage.js');\r\n      await deleteCard(card.id);\r\n      overlay.remove();\r\n      await renderColumnView(); // Refresh the view\r\n    }\r\n  });\r\n\r\n  // Cancel button\r\n  const cancelBtn = document.createElement('button');\r\n  cancelBtn.textContent = 'Avbryt';\r\n  cancelBtn.style.cssText = `\r\n    padding: 10px 20px;\r\n    background: #6c757d;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 6px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  `;\r\n  cancelBtn.addEventListener('mouseenter', () => {\r\n    cancelBtn.style.background = '#5a6268';\r\n  });\r\n  cancelBtn.addEventListener('mouseleave', () => {\r\n    cancelBtn.style.background = '#6c757d';\r\n  });\r\n  cancelBtn.addEventListener('click', () => {\r\n    overlay.remove();\r\n  });\r\n\r\n  // Save button\r\n  const saveBtn = document.createElement('button');\r\n  saveBtn.textContent = 'Spara';\r\n  saveBtn.style.cssText = `\r\n    padding: 10px 20px;\r\n    background: #28a745;\r\n    color: white;\r\n    border: none;\r\n    border-radius: 6px;\r\n    font-size: 14px;\r\n    cursor: pointer;\r\n    transition: all 0.2s;\r\n  `;\r\n  saveBtn.addEventListener('mouseenter', () => {\r\n    saveBtn.style.background = '#218838';\r\n  });\r\n  saveBtn.addEventListener('mouseleave', () => {\r\n    saveBtn.style.background = '#28a745';\r\n  });\r\n  saveBtn.addEventListener('click', async () => {\r\n    const newText = textarea.value;\r\n    const { updateCard } = await import('./lib/storage.js');\r\n\r\n    if (card.image) {\r\n      await updateCard(card.id, { backText: newText });\r\n    } else {\r\n      await updateCard(card.id, { text: newText });\r\n    }\r\n\r\n    overlay.remove();\r\n    await renderColumnView(); // Refresh the view\r\n  });\r\n\r\n  buttonContainer.appendChild(deleteBtn);\r\n  buttonContainer.appendChild(cancelBtn);\r\n  buttonContainer.appendChild(saveBtn);\r\n  dialog.appendChild(buttonContainer);\r\n\r\n  overlay.appendChild(dialog);\r\n  document.body.appendChild(overlay);\r\n\r\n  // Focus textarea\r\n  textarea.focus();\r\n  textarea.select();\r\n\r\n  // Close on overlay click\r\n  overlay.addEventListener('click', (e) => {\r\n    if (e.target === overlay) {\r\n      overlay.remove();\r\n    }\r\n  });\r\n\r\n  // Close on ESC\r\n  const escHandler = (e) => {\r\n    if (e.key === 'Escape') {\r\n      overlay.remove();\r\n      document.removeEventListener('keydown', escHandler);\r\n    }\r\n  };\r\n  document.addEventListener('keydown', escHandler);\r\n}\r\n\r\n/**\r\n * Toggle theme\r\n */\r\nasync function toggleTheme() {\r\n  const body = document.body;\r\n\r\n  // Get current theme from class\r\n  let currentTheme = 'light';\r\n  if (body.classList.contains('dark-theme')) currentTheme = 'dark';\r\n  else if (body.classList.contains('eink-theme')) currentTheme = 'eink';\r\n\r\n  const themes = ['light', 'dark', 'eink'];\r\n  const currentIndex = themes.indexOf(currentTheme);\r\n  const nextIndex = (currentIndex + 1) % themes.length;\r\n  const nextTheme = themes[nextIndex];\r\n\r\n  // Remove all theme classes\r\n  body.classList.remove('dark-theme', 'eink-theme', 'sepia-theme');\r\n\r\n  // Add new theme class (except for light which is default)\r\n  if (nextTheme === 'dark') {\r\n    body.classList.add('dark-theme');\r\n  } else if (nextTheme === 'eink') {\r\n    body.classList.add('eink-theme');\r\n  }\r\n\r\n  // Also set data attribute for consistency\r\n  body.setAttribute('data-theme', nextTheme);\r\n  localStorage.setItem('theme', nextTheme);\r\n  state.theme = nextTheme;\r\n\r\n  // Update button text\r\n  const themeBtn = document.getElementById('btn-theme-toggle');\r\n  if (themeBtn) {\r\n    // The text is now removed, but we could update a title/tooltip here\r\n    const themeTitles = {\r\n      'light': 'Byt till mrkt tema',\r\n      'dark': 'Byt till e-ink tema',\r\n      'eink': 'Byt till ljust tema'\r\n    };\r\n    themeBtn.title = themeTitles[nextTheme] || 'Byt tema';\r\n  }\r\n\r\n  // Update card appearances based on new theme\r\n  const { updateCardShadows, updateCardFills, updateCardStrokes } = await import('./lib/canvas.js');\r\n  updateCardShadows();\r\n  await updateCardFills(); // Use await since it's an async function\r\n  updateCardStrokes();\r\n\r\n  console.log(`Theme changed to: ${nextTheme}`);\r\n}\r\n\r\n/**\r\n * Toggle UI mode (full -> minimal -> toggle-only -> full)\r\n */\r\nfunction toggleUIMode() {\r\n  const modes = ['full', 'minimal', 'toggle-only'];\r\n  const currentIndex = modes.indexOf(state.uiMode);\r\n  const nextIndex = (currentIndex + 1) % modes.length;\r\n  state.uiMode = modes[nextIndex];\r\n\r\n  // Save to localStorage\r\n  localStorage.setItem('uiMode', state.uiMode);\r\n\r\n  // Apply the new mode\r\n  applyUIMode();\r\n\r\n  console.log(`UI mode changed to: ${state.uiMode}`);\r\n}\r\n\r\n/**\r\n * Apply UI mode - show/hide buttons\r\n */\r\nfunction applyUIMode() {\r\n  const toolbar = document.getElementById('toolbar');\r\n  const toolbarActions = document.getElementById('toolbar-actions');\r\n  const commandPaletteBtn = document.getElementById('command-palette-button');\r\n  const addBtn = document.getElementById('add-button');\r\n  const fitAllBtn = document.getElementById('fit-all-button');\r\n  const uiToggleBtn = document.getElementById('btn-ui-mode-toggle');\r\n\r\n  if (!toolbar) return;\r\n\r\n  // Reset toggle button to default position first\r\n  if (uiToggleBtn) {\r\n    uiToggleBtn.style.position = '';\r\n    uiToggleBtn.style.top = '';\r\n    uiToggleBtn.style.right = '';\r\n    uiToggleBtn.style.zIndex = '';\r\n  }\r\n\r\n  // Mode 1: Full - show everything\r\n  if (state.uiMode === 'full') {\r\n    toolbar.style.display = 'flex';\r\n    if (toolbarActions) {\r\n      toolbarActions.style.display = 'flex';\r\n      // Show all buttons in toolbar\r\n      Array.from(toolbarActions.children).forEach(child => {\r\n        child.style.display = '';\r\n      });\r\n    }\r\n    if (commandPaletteBtn) commandPaletteBtn.style.display = 'flex';\r\n    if (addBtn) addBtn.style.display = 'flex';\r\n    if (fitAllBtn) fitAllBtn.style.display = 'flex';\r\n    if (uiToggleBtn) uiToggleBtn.title = 'Byt till minimalt UI';\r\n  }\r\n\r\n  // Mode 2: Minimal - hide toolbar buttons EXCEPT toggle, show floating command palette\r\n  else if (state.uiMode === 'minimal') {\r\n    // Hide toolbar buttons except toggle\r\n    if (toolbarActions) {\r\n      Array.from(toolbarActions.children).forEach(child => {\r\n        if (child.id === 'btn-ui-mode-toggle') {\r\n          child.style.display = '';\r\n        } else {\r\n          child.style.display = 'none';\r\n        }\r\n      });\r\n      toolbarActions.style.display = 'flex';\r\n    }\r\n    // Show floating command palette button\r\n    if (commandPaletteBtn) commandPaletteBtn.style.display = 'flex';\r\n    if (addBtn) addBtn.style.display = 'none';\r\n    if (fitAllBtn) fitAllBtn.style.display = 'none';\r\n    toolbar.style.display = 'flex';\r\n    if (uiToggleBtn) uiToggleBtn.title = 'Byt till endast UI-knapp';\r\n  }\r\n\r\n  // Mode 3: Toggle-only - show ONLY toggle button\r\n  else if (state.uiMode === 'toggle-only') {\r\n    // Hide toolbar buttons except toggle\r\n    if (toolbarActions) {\r\n      Array.from(toolbarActions.children).forEach(child => {\r\n        if (child.id === 'btn-ui-mode-toggle') {\r\n          child.style.display = '';\r\n        } else {\r\n          child.style.display = 'none';\r\n        }\r\n      });\r\n      toolbarActions.style.display = 'flex';\r\n    }\r\n    // Hide floating buttons\r\n    if (commandPaletteBtn) commandPaletteBtn.style.display = 'none';\r\n    if (addBtn) addBtn.style.display = 'none';\r\n    if (fitAllBtn) fitAllBtn.style.display = 'none';\r\n    toolbar.style.display = 'flex';\r\n    if (uiToggleBtn) uiToggleBtn.title = 'Byt till fullt UI';\r\n  }\r\n\r\n  console.log(`Applied UI mode: ${state.uiMode}`);\r\n}\r\n\r\n/**\r\n * Handle import action\r\n */\r\nasync function handleImport() {\r\n  if (state.currentView !== 'board') {\r\n    alert('Byt till Board-vy fr att lgga till bilder');\r\n    return;\r\n  }\r\n\r\n  // Open file picker directly (quality dialog shows after)\r\n  try {\r\n    await importImage();\r\n  } catch (error) {\r\n    console.error('Import failed:', error);\r\n    alert('Misslyckades att importera bild: ' + error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle download backup\r\n */\r\nasync function handleDownloadBackup() {\r\n  try {\r\n    const JSZip = (await import('jszip')).default;\r\n    const { getAllCards } = await import('./lib/storage.js');\r\n\r\n    console.log('Creating backup...');\r\n    const zip = new JSZip();\r\n\r\n    // Get all cards\r\n    const cards = await getAllCards();\r\n\r\n    // Create JSON export\r\n    const jsonData = {\r\n      version: '1.0',\r\n      exportDate: new Date().toISOString(),\r\n      cards: cards\r\n    };\r\n\r\n    zip.file('cards.json', JSON.stringify(jsonData, null, 2));\r\n\r\n    // Add images folder\r\n    const imagesFolder = zip.folder('images');\r\n    let imageCount = 0;\r\n\r\n    // Extract and save images\r\n    for (const card of cards) {\r\n      if (card.image) {\r\n        try {\r\n          // Handle both direct base64 string and object format\r\n          const imageSrc = typeof card.image === 'string' ? card.image : card.image.base64;\r\n\r\n          // Extract base64 data (remove data:image/png;base64, prefix)\r\n          const base64Data = imageSrc.split(',')[1];\r\n\r\n          if (base64Data) {\r\n            // Use card ID as filename\r\n            const filename = `card_${card.id}.png`;\r\n            imagesFolder.file(filename, base64Data, { base64: true });\r\n            imageCount++;\r\n          }\r\n        } catch (error) {\r\n          console.error(`Failed to export image for card ${card.id}:`, error);\r\n        }\r\n      }\r\n    }\r\n\r\n    console.log(`Exporting ${cards.length} cards and ${imageCount} images...`);\r\n\r\n    // Generate zip file\r\n    const blob = await zip.generateAsync({ type: 'blob' });\r\n\r\n    // Download\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n\r\n    // Create filename with date\r\n    const date = new Date().toISOString().split('T')[0];\r\n    a.download = `spatial-view-backup-${date}.zip`;\r\n\r\n    document.body.appendChild(a);\r\n    a.click();\r\n    document.body.removeChild(a);\r\n    URL.revokeObjectURL(url);\r\n\r\n    console.log(`Backup created successfully: ${cards.length} cards, ${imageCount} images`);\r\n    alert(`Backup skapad!\\n\\n${cards.length} kort och ${imageCount} bilder exporterade.`);\r\n\r\n  } catch (error) {\r\n    console.error('Backup failed:', error);\r\n    alert('Misslyckades att skapa backup: ' + error.message);\r\n  }\r\n}\r\n\r\n/**\r\n * Handle search input\r\n */\r\nasync function handleSearch(event) {\r\n  const query = event.target.value;\r\n  console.log('[main.js] handleSearch called with:', query);\r\n  console.log('[main.js] currentView:', state.currentView);\r\n\r\n  if (state.currentView === 'board') {\r\n    await searchCards(query);\r\n  } else {\r\n    // Column view - filter cards\r\n    await renderColumnView(query);\r\n  }\r\n}\r\n\r\n/**\r\n * Debounce helper\r\n */\r\nfunction debounce(func, wait) {\r\n  let timeout;\r\n  return function executedFunction(...args) {\r\n    const later = () => {\r\n      clearTimeout(timeout);\r\n      func(...args);\r\n    };\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n  };\r\n}\r\n\r\n// Start app when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', init);\r\n} else {\r\n  init();\r\n}\r\n\r\n// Export state for debugging\r\nif (import.meta.env.DEV) {\r\n  window.__SPATIAL_VIEW__ = state;\r\n}\r\n"],"file":"index-CsL9Llmi.js"}