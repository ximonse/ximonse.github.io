<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spatial Notes - SÃ¶k och Klunga</title>

    <!-- External dependencies -->
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>

    <!-- Application styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="toolbar">
        <!-- Mobile hamburger toggle (hidden on desktop) -->
        <button class="toolbar-btn mobile-only" id="mobileHamburgerBtn" onclick="toggleSimplifiedToolbar()" title="VÃ¤xla till mini-meny" style="display: none; padding: 8px 12px;">
            â˜°
        </button>

        <!-- Project Selector -->
        <div class="project-selector">
            <button class="project-button" id="projectButton" onclick="toggleProjectDropdown()">
                <span id="projectName">Nytt projekt</span>
                <span>â–¼</span>
            </button>
            <div class="project-dropdown" id="projectDropdown">
                <div class="project-dropdown-item" onclick="renameProject()">
                    <span>âœï¸</span>
                    <span>Byt namn pÃ¥ projekt</span>
                </div>
                <div class="project-dropdown-item" onclick="createNewProject()">
                    <span>â•</span>
                    <span>Nytt projekt</span>
                </div>
                <div class="project-dropdown-item" onclick="showProjectList()">
                    <span>ğŸ“‚</span>
                    <span>Ã–ppna projekt</span>
                </div>
                <div class="project-dropdown-item" onclick="manageProjects()">
                    <span>ğŸ—‚ï¸</span>
                    <span>Hantera projekt</span>
                </div>
            </div>
        </div>

        <div class="search-box">
            <input type="text" class="search-input" placeholder='SÃ¶k: "bias and social" OR "not psychology"' id="searchInput">
            <button class="search-select-btn toolbar-btn" id="searchSelectBtn" onclick="selectSearchResults()" style="display: none;">
                ğŸ“ Markera funna
            </button>
        </div>
        <div class="tag-filter-box">
            <input type="text" class="tag-filter-input" placeholder='Tags: tech AND psychology NOT done' id="tagFilterInput">
        </div>
        <button class="toolbar-btn" id="annotationToggleBtn" onclick="toggleAnnotationToolbar()" title="Aktivera/inaktivera annotation-verktyg" style="padding: 8px 16px;">
            â¬œâ†’â­•
        </button>
        <button class="toolbar-btn" id="imageUploadBtn" onclick="triggerImageUpload()" title="Tre bildval: Kamera, Galleri, FilvÃ¤ljare" style="padding: 8px 16px;">
            ğŸ“· Bilder
        </button>
        <button class="toolbar-btn" id="multiImportBtn" onclick="showMultiCardPasteDialog()" title="Skapa flera kort samtidigt (M)" style="padding: 8px 16px;">
            ğŸ“‹ Multi-import
        </button>
        <button class="toolbar-btn" id="aiAssistantBtn" onclick="toggleAIPanel()" title="Ã–ppna AI-assistent" style="padding: 8px 16px;">
            ğŸ¤– AI
        </button>
        <button class="toolbar-btn" id="viewToggleBtn" onclick="toggleView()" title="VÃ¤xla mellan brÃ¤dvy och kolumnvy" style="padding: 8px 16px;">
            ğŸ“‹ Kolumnvy
        </button>

        <!-- Mobile controls (hidden on desktop) -->
        <div class="mobile-controls">
            <button class="mobile-btn zoom-out-btn" onclick="zoomOutToCenter()" title="Zooma ut centralt">ğŸ”âˆ’</button>
            <button class="mobile-btn new-card-btn" onclick="addNewCard()" title="Tap: Nytt kort | LÃ¥ngtryck: Kamera/Bilder">â•</button>
        </div>
        <div class="menu-dropdown">
            <button class="menu-button toolbar-btn">
                âš™ï¸ Meny
                <span>â–¼</span>
            </button>
            <div class="dropdown-content">
                <button onclick="closeMenuDropdowns(); saveBoard()">ğŸ’¾ Spara (LocalStorage)</button>
                <button onclick="closeMenuDropdowns(); saveWithTimestamp()">ğŸ’¾ Spara fil</button>
                <button onclick="closeMenuDropdowns(); saveAs()">ğŸ’¾ Spara som...</button>
                <button onclick="closeMenuDropdowns(); loadBoard()">ğŸ“‚ Ladda fil</button>
                <button onclick="closeMenuDropdowns(); exportToJSON()">ğŸ“‹ Exportera JSON</button>
                <button onclick="closeMenuDropdowns(); importFromJSON()">ğŸ“ Importera JSON</button>
                <button onclick="closeMenuDropdowns(); importFromExtractor()">ğŸ“¥ FrÃ¥n PDF-Extractor</button>
                <button onclick="closeMenuDropdowns(); document.getElementById('zoteroHtmlInput').click()">ğŸ“š FrÃ¥n Zotero</button>
                <button onclick="closeMenuDropdowns(); toggleGoogleDriveAuth()" id="googleDriveBtn">ğŸ”— Google Drive</button>
                <button onclick="closeMenuDropdowns(); toggleMetadataView()" id="metadataBtn">ğŸ” Metadata</button>
                <button onclick="closeMenuDropdowns(); debugDumpPositions()">ğŸ› Debug Positioner</button>
                <button onclick="closeMenuDropdowns(); toggleDarkTheme()" id="themeBtn">ğŸŒ™ MÃ¶rkt Tema</button>
                <button onclick="closeMenuDropdowns(); clearBoard()">ğŸ—‘ï¸ Rensa</button>
            </div>
        </div>

        <!-- Keyboard commands dropdown -->
        <div class="menu-dropdown">
            <button class="menu-button toolbar-btn">
                âŒ¨ï¸
                <span>â–¼</span>
            </button>
            <div class="dropdown-content">
                <button onclick="closeMenuDropdowns(); executeCommand('H')">H</button>
                <button onclick="closeMenuDropdowns(); executeCommand('V')">V</button>
                <button onclick="closeMenuDropdowns(); executeCommand('G+V')">G+V</button>
                <button onclick="closeMenuDropdowns(); executeCommand('G+H')">G+H</button>
                <button onclick="closeMenuDropdowns(); executeCommand('G+T')">G+T</button>
                <button onclick="closeMenuDropdowns(); executeCommand('QQ')">QQ</button>
                <button onclick="closeMenuDropdowns(); executeCommand('Q')">Q</button>
                <button onclick="closeMenuDropdowns(); executeCommand('C')">C</button>
                <button onclick="closeMenuDropdowns(); executeCommand('T')">ğŸ¨ T</button>
                <button onclick="closeMenuDropdowns(); showSortMenu(event)">ğŸ“Š Sortera</button>
                <button onclick="closeMenuDropdowns(); executeCommand('Pin')">ğŸ“Œ Pin</button>
                <button onclick="closeMenuDropdowns(); executeCommand('Unpin')">ğŸ”“ Unpin</button>
                <button onclick="closeMenuDropdowns(); executeCommand('Delete')">ğŸ—‘ï¸ Delete</button>
                <button onclick="closeMenuDropdowns(); executeCommand('Ctrl+Z')">Ctrl+Z</button>
                <button onclick="closeMenuDropdowns(); executeCommand('Ctrl+Y')">Ctrl+Y</button>
                <button onclick="closeMenuDropdowns(); executeCommand('Ctrl+A')">Ctrl+A</button>
                <button onclick="closeMenuDropdowns(); executeCommand('Ctrl+S')">Ctrl+S</button>
            </div>
        </div>
    </div>

    <div class="search-results-info" id="searchInfo"></div>
    <div class="selection-info" id="selectionInfo"></div>

    <!-- The invisible ruler -->
    <div id="text-ruler"></div>

    <!-- Desktop zoom-out button -->
    <button class="desktop-zoom-btn" onclick="zoomOutToCenter()" title="Zooma ut fÃ¶r att visa alla kort">ğŸ”</button>

    <div id="cy"></div>

    <!-- Column view container -->
    <div id="columnView" class="column-view" style="display: none;">
        <div class="column-container" id="columnContainer">
            <!-- Column view cards will be rendered here -->
        </div>
    </div>

    <!-- Annotation Toolbar -->
    <div class="annotation-toolbar" id="annotationToolbar">
        <div class="annotation-tool-group">
            <div class="annotation-tool active" data-tool="select" title="VÃ¤lj och flytta">ğŸ” VÃ¤lj</div>
            <div class="annotation-separator"></div>
            <div class="annotation-tool" data-tool="rect" title="Rektangel">â¬œ</div>
            <div class="annotation-tool" data-tool="circle" title="Cirkel">â­•</div>
            <div class="annotation-tool" data-tool="triangle" title="Triangel">ğŸ”º</div>
            <div class="annotation-tool" data-tool="diamond" title="Diamant">â—†</div>
            <div class="annotation-tool" data-tool="star" title="StjÃ¤rna">â­</div>
            <div class="annotation-tool" data-tool="hexagon" title="Hexagon">â¬¢</div>
        </div>
        <div class="annotation-tool-group">
            <div class="annotation-tool" data-tool="text-small" title="Liten text">ğŸ…°ï¸ S</div>
            <div class="annotation-tool" data-tool="text-medium" title="Medium text">ğŸ…°ï¸ M</div>
            <div class="annotation-tool" data-tool="text-large" title="Stor text">ğŸ…°ï¸ L</div>
            <div class="annotation-separator"></div>
            <div class="annotation-tool" data-tool="arrow" title="Pil mellan objekt">â†’</div>
            <div class="annotation-tool" data-tool="line" title="Linje mellan objekt">â–</div>
            <div class="annotation-separator"></div>
            <div class="annotation-tool" data-tool="resize" title="Aktivera storleksÃ¤ndring (hÃ¶gerklick pÃ¥ figur)">â†—ï¸</div>
        </div>
        <div class="annotation-tool-group">
            <div class="annotation-tool" data-tool="color-red" title="RÃ¶d fÃ¤rg" style="background: #ff6b6b; color: white;">â—</div>
            <div class="annotation-tool" data-tool="color-blue" title="BlÃ¥ fÃ¤rg" style="background: #4ecdc4; color: white;">â—</div>
            <div class="annotation-tool" data-tool="color-green" title="GrÃ¶n fÃ¤rg" style="background: #45b7d1; color: white;">â—</div>
            <div class="annotation-tool" data-tool="color-yellow" title="Gul fÃ¤rg" style="background: #f9ca24; color: white;">â—</div>
            <div class="annotation-tool" data-tool="color-purple" title="Lila fÃ¤rg" style="background: #a55eea; color: white;">â—</div>
        </div>
    </div>

    <!-- Hidden file inputs for image upload -->
    <input type="file" id="hiddenCameraInput" accept="image/*" multiple capture="camera" style="display: none;">
    <input type="file" id="hiddenGalleryInput" accept="image/*" multiple style="display: none;">

    <!-- Hidden file input for Zotero HTML import -->
    <input type="file" id="zoteroHtmlInput" accept=".html" style="display: none;">

    <!-- AI Chat Panel -->
    <div class="ai-panel" id="aiPanel">
        <div class="ai-panel-header">
            <div class="ai-panel-title">ğŸ¤– AI-assistent</div>
            <button class="ai-panel-close" onclick="toggleAIPanel()">âœ•</button>
        </div>
        <div class="ai-panel-messages" id="aiMessages">
            <!-- Chat messages will appear here -->
        </div>
        <div class="ai-panel-input-area">
            <div class="ai-input-wrapper">
                <textarea class="ai-panel-input" id="aiPanelInput" placeholder="FrÃ¥ga AI om dina anteckningar...
Exempel: Visa alla kort om projektet, Sortera todos i veckogrid" rows="2"></textarea>
                <button class="ai-panel-send" id="aiPanelSend" onclick="sendAIMessage()">Skicka</button>
            </div>
        </div>
    </div>

    <!-- Application JavaScript modules (loaded in dependency order) -->
    <script src="js/config.js"></script>
    <script src="js/globals.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/image-handler.js"></script>
    <script src="js/annotations.js"></script>
    <script src="js/search.js"></script>
    <script src="js/card-operations.js"></script>
    <script src="js/layouts.js"></script>
    <script src="js/cytoscape-init.js"></script>
    <script src="js/ai-assistant.js"></script>
    <script src="js/google-drive.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
