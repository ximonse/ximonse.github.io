<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spatial Notes - Modular CSS Version</title>

    <!-- External Libraries -->
    <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
    <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

    <!-- CSS Modules -->
    <link rel="stylesheet" href="css/toolbar.css">
    <link rel="stylesheet" href="css/canvas.css">
    <link rel="stylesheet" href="css/cards-colors.css">
    <link rel="stylesheet" href="css/menus-mobile.css">
    <link rel="stylesheet" href="css/column-view.css">
    <link rel="stylesheet" href="css/ai-panel.css">
    <link rel="stylesheet" href="css/ai-assistant.css">
    <link rel="stylesheet" href="css/theme-dark.css">
    <link rel="stylesheet" href="css/theme-sepia.css">
    <link rel="stylesheet" href="css/theme-eink.css">
    <link rel="stylesheet" href="css/command-palette.css">
</head>
<body>
    <div class="toolbar">
        <!-- Mobile hamburger toggle (hidden on desktop) -->
        <button class="toolbar-btn mobile-only" id="mobileHamburgerBtn" onclick="toggleSimplifiedToolbar()" title="VÃ¤xla till mini-meny" style="display: none; padding: 8px 12px;">
            â˜°
        </button>
        
        <!-- Project Selector -->
        <div class="project-selector">
            <button class="project-button" id="projectButton" onclick="toggleProjectDropdown()">
                <span id="projectName">Nytt projekt</span>
                <span>â–¼</span>
            </button>
            <div class="project-dropdown" id="projectDropdown">
                <div class="project-dropdown-item" onclick="renameProject()">
                    <span>âœï¸</span>
                    <span>Byt namn pÃ¥ projekt</span>
                </div>
                <div class="project-dropdown-item" onclick="createNewProject()">
                    <span>â•</span>
                    <span>Nytt projekt</span>
                </div>
                <div class="project-dropdown-item" onclick="showProjectList()">
                    <span>ğŸ“‚</span>
                    <span>Ã–ppna projekt</span>
                </div>
                <div class="project-dropdown-item" onclick="manageProjects()">
                    <span>ğŸ—‚ï¸</span>
                    <span>Hantera projekt</span>
                </div>
            </div>
        </div>
        
        <div class="search-box">
            <input type="text" class="search-input" placeholder='SÃ¶k: "bias and social" OR "not psychology"' id="searchInput">
            <label style="font-size: 12px; margin-left: 8px; white-space: nowrap;">
                <input type="checkbox" id="searchInSelectedOnly" style="margin-right: 4px;">
                Endast markerade
            </label>
            <button class="search-select-btn toolbar-btn" id="searchSelectBtn" onclick="selectSearchResults()" style="display: none;">
                ğŸ“ Markera funna
            </button>
        </div>
        <div class="tag-filter-box">
            <input type="text" class="tag-filter-input" placeholder='Tags: tech AND psychology NOT done' id="tagFilterInput">
        </div>
        <button class="toolbar-btn" id="imageUploadBtn" onclick="triggerImageUpload()" title="Tre bildval: Kamera, Galleri, FilvÃ¤ljare" style="padding: 8px 16px;">
            ğŸ“· Bilder
        </button>
        <button class="toolbar-btn" id="commandPaletteBtn" onclick="showCommandPalette()" title="Visa kommandon (Ctrl+K)" style="padding: 8px 16px;">
            âš¡ Kommandon
        </button>
        <button class="toolbar-btn" id="helpBtn" onclick="showUserManual()" title="AnvÃ¤ndarmanual (Ctrl+H)" style="padding: 8px 16px;">
            â“ HjÃ¤lp
        </button>

        <!-- Mobile controls (hidden on desktop) -->
        <div class="mobile-controls">
            <button class="mobile-btn zoom-out-btn" onclick="zoomOutToCenter()" title="Zooma ut centralt">ğŸ”âˆ’</button>
            <button class="mobile-btn new-card-btn" onclick="addNewCard()" title="Tap: Nytt kort | LÃ¥ngtryck: Kamera/Bilder">â•</button>
        </div>
    </div>
    
    <div class="search-results-info" id="searchInfo"></div>
    <div class="selection-info" id="selectionInfo"></div>

    <div class="ai-assistant-panel hidden" id="aiAssistantPanel">
        <div class="ai-assistant-header">
            <div>
                <h3>ChatGPT HÃ¶gar</h3>
                <p>Skapa visuella hÃ¶gar av relaterade kort - AI:n grupperar och staplar dem Ã¥t dig.</p>
            </div>
            <button class="ai-assistant-close" onclick="toggleAiPanel(true)" title="StÃ¤ng">âœ•</button>
        </div>
        <div class="ai-assistant-body">
            <textarea class="ai-assistant-textarea" id="aiAssistantPrompt" placeholder="Exempel: Skapa hÃ¶gar baserat pÃ¥ Ã¤mne. Eller: Gruppera efter projektstatus. Eller: Dela upp i kategorierna forskning, planering och genomfÃ¶rande."></textarea>
            <div class="ai-assistant-controls">
                <button id="aiAssistantRunBtn" onclick="runAiSorting()">Skapa hÃ¶gar</button>
                <button id="aiAssistantVoiceBtn" class="ai-assistant-voice-btn" onclick="toggleAiVoiceInput()">ğŸ¤ RÃ¶st</button>
            </div>
            <div class="ai-api-key-row">
                <input type="password" id="aiAssistantApiKey" placeholder="OpenAI API-nyckel">
                <button onclick="saveAiApiKey()">Spara nyckel</button>
            </div>
            <p class="ai-assistant-info" id="aiAssistantSecurityNotice">
                <strong>SÃ¤kerhet:</strong> Nyckeln sparas bara i minnet och skickas direkt till OpenAI. Klicka pÃ¥ "Spara" endast pÃ¥ en privat enhet â€“ lÃ¤mna fÃ¤ltet tomt och tryck "Spara" fÃ¶r att ta bort en sparad nyckel.
            </p>
            <div class="ai-assistant-status" id="aiAssistantStatus">Beskriv hur du vill att korten ska grupperas i hÃ¶gar.</div>
            <div class="ai-assistant-groups" id="aiAssistantGroups"></div>
        </div>
    </div>

    <!-- The invisible ruler -->
    <div id="text-ruler"></div>
    
    <!-- Desktop zoom-out button -->
    <button class="desktop-zoom-btn" onclick="zoomOutToCenter()" title="Zooma ut fÃ¶r att visa alla kort">ğŸ”</button>
    
    <div id="cy"></div>
    
    <!-- Column view container -->
    <div id="columnView" class="column-view" style="display: none;">
        <div class="column-container" id="columnContainer">
            <!-- Column view cards will be rendered here -->
        </div>
    </div>

    <!-- Annotation Toolbar -->
    <div class="annotation-toolbar" id="annotationToolbar">
        <div class="annotation-tool-group">
            <div class="annotation-tool active" data-tool="select" title="VÃ¤lj och flytta">ğŸ” VÃ¤lj</div>
            <div class="annotation-separator"></div>
            <div class="annotation-tool" data-tool="rect" title="Rektangel">â¬œ</div>
            <div class="annotation-tool" data-tool="circle" title="Cirkel">â­•</div>
            <div class="annotation-tool" data-tool="triangle" title="Triangel">ğŸ”º</div>
            <div class="annotation-tool" data-tool="diamond" title="Diamant">â—†</div>
            <div class="annotation-tool" data-tool="star" title="StjÃ¤rna">â­</div>
            <div class="annotation-tool" data-tool="hexagon" title="Hexagon">â¬¢</div>
        </div>
        <div class="annotation-tool-group">
            <div class="annotation-tool" data-tool="text-small" title="Liten text">ğŸ…°ï¸ S</div>
            <div class="annotation-tool" data-tool="text-medium" title="Medium text">ğŸ…°ï¸ M</div>
            <div class="annotation-tool" data-tool="text-large" title="Stor text">ğŸ…°ï¸ L</div>
            <div class="annotation-separator"></div>
            <div class="annotation-tool" data-tool="arrow" title="Pil mellan objekt">â†’</div>
            <div class="annotation-tool" data-tool="line" title="Linje mellan objekt">â–</div>
            <div class="annotation-separator"></div>
            <div class="annotation-tool" data-tool="resize" title="Aktivera storleksÃ¤ndring (hÃ¶gerklick pÃ¥ figur)">â†—ï¸</div>
        </div>
        <div class="annotation-tool-group">
            <div class="annotation-tool" data-tool="color-red" title="RÃ¶d fÃ¤rg" style="background: #ff6b6b; color: white;">â—</div>
            <div class="annotation-tool" data-tool="color-blue" title="BlÃ¥ fÃ¤rg" style="background: #4ecdc4; color: white;">â—</div>
            <div class="annotation-tool" data-tool="color-green" title="GrÃ¶n fÃ¤rg" style="background: #45b7d1; color: white;">â—</div>
            <div class="annotation-tool" data-tool="color-yellow" title="Gul fÃ¤rg" style="background: #f9ca24; color: white;">â—</div>
            <div class="annotation-tool" data-tool="color-purple" title="Lila fÃ¤rg" style="background: #a55eea; color: white;">â—</div>
        </div>
    </div>

    <!-- Hidden file inputs for image upload -->
    <input type="file" id="hiddenCameraInput" accept="image/*" multiple capture="camera" style="display: none;">
    <input type="file" id="hiddenGalleryInput" accept="image/*,.pdf" multiple style="display: none;">

    <!-- Hidden file input for Zotero HTML import -->
    <input type="file" id="zoteroHtmlInput" accept=".html" style="display: none;">

    <!-- AI Chat Panel -->
    <div class="ai-panel" id="aiPanel">
        <div class="ai-panel-header">
            <div class="ai-panel-title">ğŸ¤– AI-assistent</div>
            <button class="ai-panel-close" onclick="toggleAIPanel()">âœ•</button>
        </div>
        <div class="ai-panel-messages" id="aiMessages">
            <!-- Chat messages will appear here -->
        </div>
        <div class="ai-panel-input-area">
            <div class="ai-input-wrapper">
                <textarea class="ai-panel-input" id="aiPanelInput" placeholder="FrÃ¥ga AI om dina anteckningar...
Exempel: Visa alla kort om projektet, Sortera todos i veckogrid" rows="2"></textarea>
                <button class="ai-panel-send" id="aiPanelSend" onclick="sendAIMessage()">Skicka</button>
            </div>
        </div>
    </div>


    <!-- JavaScript Modules - Phase 1 Integration -->
    <!-- Load order: text-measurement must be first (used by almost everything) -->
    <script src="js/text-measurement.js"></script>
    <script src="js/debug.js"></script>
    <script src="js/themes.js"></script>
    <script src="js/search.js"></script>
    
    <script src="js/image-handling.js"></script>
    <script src="js/card-editing.js"></script>
    <script src="js/cytoscape-init.js"></script>
    <script src="js/annotation.js"></script>
    <script src="js/dialogs.js"></script>
    <script src="js/sorting-temporal.js"></script>
    <script src="js/command-palette.js"></script>

    <!-- Main application (remaining functionality) -->
    <script src="js/main.js"></script>
</body>
</html>
